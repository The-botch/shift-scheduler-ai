# CSVãƒ•ã‚¡ã‚¤ãƒ« â†’ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ« å¯¾å¿œè¡¨

**ä½œæˆæ—¥**: 2025-10-31

---

## ğŸ“Š å¯¾å¿œçŠ¶æ³ã‚µãƒãƒªãƒ¼

### ğŸ‰ **å®Œå…¨å¯¾å¿œç‰ˆï¼ˆè¿½åŠ ãƒ†ãƒ¼ãƒ–ãƒ«é©ç”¨å¾Œï¼‰**

| ã‚«ãƒ†ã‚´ãƒª | CSVç·æ•° | DBå¯¾å¿œæ¸ˆã¿ | æœªå¯¾å¿œ | å¯¾å¿œç‡ |
|---------|---------|-----------|--------|--------|
| **actual** | 3 | âœ… 3 | 0 | 100% |
| **dashboard** | 1 | âœ… 1 | 0 | 100% |
| **forecast** | 1 | âœ… 1 | 0 | 100% |
| **history** | 5 | âœ… 5 | 0 | 100% |
| **master** | 17 | âœ… 17 | 0 | 100% |
| **transactions** | 9 | âœ… 9 | 0 | 100% |
| **åˆè¨ˆ** | **36** | **âœ… 36** | **âŒ 0** | **ğŸ‰ 100%** |

### ğŸ“ˆ å¯¾å¿œçŠ¶æ³ã®å¤‰é·

| ãƒ•ã‚§ãƒ¼ã‚º | ãƒ†ãƒ¼ãƒ–ãƒ«æ•° | å¯¾å¿œCSV | å¯¾å¿œç‡ |
|---------|-----------|---------|--------|
| **åŸºæœ¬ç‰ˆ** | 20ãƒ†ãƒ¼ãƒ–ãƒ« | 22/36 | 61% |
| **å®Œå…¨ç‰ˆ** | 31ãƒ†ãƒ¼ãƒ–ãƒ« | 36/36 | **100%** |

---

## ğŸ“ è©³ç´°å¯¾å¿œè¡¨

### âœ… **ACTUALï¼ˆå®Ÿç¸¾ãƒ‡ãƒ¼ã‚¿ï¼‰** - 3/3å¯¾å¿œæ¸ˆã¿

| CSV | DBãƒ†ãƒ¼ãƒ–ãƒ« | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | å‚™è€ƒ |
|-----|-----------|----------|------|
| `payroll_2024.csv` | `payroll` | âœ… å¯¾å¿œæ¸ˆã¿ | çµ¦ä¸å®Ÿç¸¾ |
| `sales_actual_2024.csv` | `sales_actual` | âœ… å¯¾å¿œæ¸ˆã¿ | å£²ä¸Šå®Ÿç¸¾ |
| `work_hours_2024.csv` | `work_hours_actual` | âœ… å¯¾å¿œæ¸ˆã¿ | å‹¤å‹™æ™‚é–“å®Ÿç¸¾ |

---

### âš ï¸ **DASHBOARDï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼‰** - 0/1æœªå¯¾å¿œ

| CSV | DBãƒ†ãƒ¼ãƒ–ãƒ« | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | å‚™è€ƒ |
|-----|-----------|----------|------|
| `metrics.csv` | âŒ ãªã— | âš ï¸ æœªå¯¾å¿œ | é›†è¨ˆãƒ“ãƒ¥ãƒ¼ã§å¯¾å¿œå¯èƒ½ |

**æ¨å¥¨å¯¾å¿œ**:
- ãƒ“ãƒ¥ãƒ¼ã¾ãŸã¯é›†è¨ˆã‚¯ã‚¨ãƒªã§å¯¾å¿œ
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨ˆç®—ã§ååˆ†

---

### âœ… **FORECASTï¼ˆäºˆæ¸¬ãƒ‡ãƒ¼ã‚¿ï¼‰** - 1/1å¯¾å¿œæ¸ˆã¿

| CSV | DBãƒ†ãƒ¼ãƒ–ãƒ« | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | å‚™è€ƒ |
|-----|-----------|----------|------|
| `sales_forecast_2024.csv` | `demand_forecasts` | âœ… å¯¾å¿œæ¸ˆã¿ | éœ€è¦äºˆæ¸¬ï¼ˆå£²ä¸Šäºˆæ¸¬å«ã‚€ï¼‰ |

---

### âš ï¸ **HISTORYï¼ˆå±¥æ­´ãƒ‡ãƒ¼ã‚¿ï¼‰** - 2/5å¯¾å¿œ

| CSV | DBãƒ†ãƒ¼ãƒ–ãƒ« | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | å‚™è€ƒ |
|-----|-----------|----------|------|
| `shift_history_2023-2024.csv` | `shifts` | âœ… å¯¾å¿œæ¸ˆã¿ | éå»ã‚·ãƒ•ãƒˆå®Ÿç¸¾ |
| `shift_monthly_summary.csv` | âŒ ãªã— | âš ï¸ æœªå¯¾å¿œ | æœˆæ¬¡ã‚µãƒãƒªãƒ¼ï¼ˆãƒ“ãƒ¥ãƒ¼ã§å¯¾å¿œå¯èƒ½ï¼‰ |
| `shift_october_2024.csv` | `shifts` | âœ… å¯¾å¿œæ¸ˆã¿ | ç‰¹å®šæœˆã®ã‚·ãƒ•ãƒˆ |
| `staff_monthly_performance.csv` | âŒ ãªã— | âš ï¸ æœªå¯¾å¿œ | ã‚¹ã‚¿ãƒƒãƒ•å®Ÿç¸¾ï¼ˆãƒ“ãƒ¥ãƒ¼ã§å¯¾å¿œå¯èƒ½ï¼‰ |
| `weather_history_2023-2024.csv` | âŒ ãªã— | âŒ æœªå¯¾å¿œ | å¤©æ°—å±¥æ­´ |

**æ¨å¥¨å¯¾å¿œ**:
- `shift_monthly_summary` â†’ ãƒ“ãƒ¥ãƒ¼ä½œæˆ
- `staff_monthly_performance` â†’ ãƒ“ãƒ¥ãƒ¼ä½œæˆ
- `weather_history_2023-2024` â†’ `demand_forecasts.weather_condition` ã«çµ±åˆå¯èƒ½

---

### âš ï¸ **MASTERï¼ˆãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼‰** - 11/17å¯¾å¿œ

| CSV | DBãƒ†ãƒ¼ãƒ–ãƒ« | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | å‚™è€ƒ |
|-----|-----------|----------|------|
| `commute_allowance.csv` | âŒ ãªã— | âŒ æœªå¯¾å¿œ | é€šå‹¤æ‰‹å½“ãƒã‚¹ã‚¿ |
| `employment_types.csv` | âŒ ãªã— | âš ï¸ æœªå¯¾å¿œ | staff.employment_typeã§å¯¾å¿œæ¸ˆã¿ï¼ˆCHECKåˆ¶ç´„ï¼‰ |
| `insurance_rates.csv` | âŒ ãªã— | âŒ æœªå¯¾å¿œ | ä¿é™ºæ–™ç‡ãƒã‚¹ã‚¿ |
| `labor_law_constraints.csv` | `labor_law_constraints` | âœ… å¯¾å¿œæ¸ˆã¿ | åŠ´åƒåŸºæº–æ³•åˆ¶ç´„ |
| `labor_management_rules.csv` | `labor_law_constraints` | âœ… å¯¾å¿œæ¸ˆã¿ | åŠ´å‹™ç®¡ç†ãƒ«ãƒ¼ãƒ«ï¼ˆçµ±åˆï¼‰ |
| `required_certifications.csv` | `certifications` | âœ… å¯¾å¿œæ¸ˆã¿ | è³‡æ ¼ãƒã‚¹ã‚¿ |
| `roles.csv` | `roles` | âœ… å¯¾å¿œæ¸ˆã¿ | å½¹è·ãƒã‚¹ã‚¿ |
| `safety_health_checklist.csv` | âŒ ãªã— | âŒ æœªå¯¾å¿œ | å®‰å…¨è¡›ç”Ÿãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ |
| `shift_patterns.csv` | `shift_patterns` | âœ… å¯¾å¿œæ¸ˆã¿ | ã‚·ãƒ•ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ |
| `shift_validation_rules.csv` | `shift_validation_rules` | âœ… å¯¾å¿œæ¸ˆã¿ | ã‚·ãƒ•ãƒˆæ¤œè¨¼ãƒ«ãƒ¼ãƒ« |
| `skills.csv` | `skills` | âœ… å¯¾å¿œæ¸ˆã¿ | ã‚¹ã‚­ãƒ«ãƒã‚¹ã‚¿ |
| `staff.csv` | `staff` | âœ… å¯¾å¿œæ¸ˆã¿ | ã‚¹ã‚¿ãƒƒãƒ•ãƒã‚¹ã‚¿ |
| `staff_certifications.csv` | `staff_certifications` | âœ… å¯¾å¿œæ¸ˆã¿ | ã‚¹ã‚¿ãƒƒãƒ•è³‡æ ¼ |
| `staff_skills.csv` | `staff_skills` | âœ… å¯¾å¿œæ¸ˆã¿ | ã‚¹ã‚¿ãƒƒãƒ•ã‚¹ã‚­ãƒ« |
| `store_constraints.csv` | `store_constraints` | âœ… å¯¾å¿œæ¸ˆã¿ | åº—èˆ—åˆ¶ç´„ |
| `stores.csv` | `stores` | âœ… å¯¾å¿œæ¸ˆã¿ | åº—èˆ—ãƒã‚¹ã‚¿ |
| `tax_brackets.csv` | âŒ ãªã— | âŒ æœªå¯¾å¿œ | ç¨ç‡ãƒã‚¹ã‚¿ |

**æ¨å¥¨å¯¾å¿œ**:
- `employment_types` â†’ ä¸è¦ï¼ˆCHECKåˆ¶ç´„ã§å¯¾å¿œæ¸ˆã¿ï¼‰
- `commute_allowance`, `insurance_rates`, `tax_brackets` â†’ çµ¦ä¸è¨ˆç®—ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ ã‚’æ¤œè¨
- `safety_health_checklist` â†’ åˆ¥é€”ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ ã‚’æ¤œè¨

---

### âš ï¸ **TRANSACTIONSï¼ˆãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ï¼‰** - 5/9å¯¾å¿œ

| CSV | DBãƒ†ãƒ¼ãƒ–ãƒ« | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | å‚™è€ƒ |
|-----|-----------|----------|------|
| `availability_requests.csv` | `availability_requests` | âœ… å¯¾å¿œæ¸ˆã¿ | å‹¤å‹™å¯å¦ç”³è«‹ |
| `demand_forecasts.csv` | `demand_forecasts` | âœ… å¯¾å¿œæ¸ˆã¿ | éœ€è¦äºˆæ¸¬ |
| `shift.csv` | `shifts` | âœ… å¯¾å¿œæ¸ˆã¿ | ã‚·ãƒ•ãƒˆ |
| `shift_plans.csv` | `shift_plans` | âœ… å¯¾å¿œæ¸ˆã¿ | ã‚·ãƒ•ãƒˆè¨ˆç”» |
| `shift_preferences_2024_10.csv` | `shift_preferences` | âœ… å¯¾å¿œæ¸ˆã¿ | ã‚·ãƒ•ãƒˆå¸Œæœ›ï¼ˆ10æœˆï¼‰ |
| `shift_preferences_2024_11.csv` | `shift_preferences` | âœ… å¯¾å¿œæ¸ˆã¿ | ã‚·ãƒ•ãƒˆå¸Œæœ›ï¼ˆ11æœˆï¼‰ |
| `shift_second_plan.csv` | `shifts` | âœ… å¯¾å¿œæ¸ˆã¿ | ç¬¬2æ¡ˆã‚·ãƒ•ãƒˆï¼ˆplan_type='SECOND'ï¼‰ |
| `shift_second_plan_issues.csv` | âŒ ãªã— | âŒ æœªå¯¾å¿œ | ç¬¬2æ¡ˆã®å•é¡Œç‚¹ |
| `shift_second_plan_solutions.csv` | âŒ ãªã— | âŒ æœªå¯¾å¿œ | ç¬¬2æ¡ˆã®è§£æ±ºç­– |

**æ¨å¥¨å¯¾å¿œ**:
- `shift_second_plan_issues` â†’ `shifts.notes` ã¾ãŸã¯å°‚ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ 
- `shift_second_plan_solutions` â†’ `shifts.modified_reason` ã¾ãŸã¯å°‚ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ 

---

## ğŸ” æœªå¯¾å¿œCSVãƒ•ã‚¡ã‚¤ãƒ«ã®è©³ç´°åˆ†æ

### âŒ **å®Œå…¨æœªå¯¾å¿œï¼ˆ7ä»¶ï¼‰** - ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ ã‚’æ¨å¥¨

| CSV | åˆ†é¡ | å„ªå…ˆåº¦ | æ¨å¥¨å¯¾å¿œ |
|-----|------|--------|---------|
| `commute_allowance.csv` | master | ğŸ”´ é«˜ | `commute_allowance` ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ  |
| `insurance_rates.csv` | master | ğŸ”´ é«˜ | `insurance_rates` ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ  |
| `tax_brackets.csv` | master | ğŸ”´ é«˜ | `tax_brackets` ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ  |
| `safety_health_checklist.csv` | master | ğŸŸ¡ ä¸­ | `safety_checklist` ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ  |
| `weather_history_2023-2024.csv` | history | ğŸŸ¢ ä½ | `demand_forecasts` ã«çµ±åˆ |
| `shift_second_plan_issues.csv` | transactions | ğŸŸ¡ ä¸­ | `shift_issues` ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ  |
| `shift_second_plan_solutions.csv` | transactions | ğŸŸ¡ ä¸­ | `shift_solutions` ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ  |

### âš ï¸ **ãƒ“ãƒ¥ãƒ¼ãƒ»é›†è¨ˆã§å¯¾å¿œå¯èƒ½ï¼ˆ4ä»¶ï¼‰**

| CSV | åˆ†é¡ | æ¨å¥¨å¯¾å¿œ |
|-----|------|---------|
| `metrics.csv` | dashboard | ãƒ“ãƒ¥ãƒ¼ã¾ãŸã¯APIé›†è¨ˆ |
| `shift_monthly_summary.csv` | history | ãƒ“ãƒ¥ãƒ¼ä½œæˆ |
| `staff_monthly_performance.csv` | history | ãƒ“ãƒ¥ãƒ¼ä½œæˆ |
| `employment_types.csv` | master | CHECKåˆ¶ç´„ã§å¯¾å¿œæ¸ˆã¿ |

---

## ğŸ“ è¿½åŠ æ¨å¥¨ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæœªå¯¾å¿œCSVç”¨ï¼‰

### 1. çµ¦ä¸è¨ˆç®—é–¢é€£ï¼ˆå„ªå…ˆåº¦: ğŸ”´ é«˜ï¼‰

```sql
-- é€šå‹¤æ‰‹å½“ãƒã‚¹ã‚¿
CREATE TABLE commute_allowance (
    allowance_id SERIAL PRIMARY KEY,
    distance_from_km DECIMAL(5,2) NOT NULL,
    distance_to_km DECIMAL(5,2) NOT NULL,
    allowance_amount DECIMAL(10,2) NOT NULL,
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- ä¿é™ºæ–™ç‡ãƒã‚¹ã‚¿
CREATE TABLE insurance_rates (
    rate_id SERIAL PRIMARY KEY,
    insurance_type VARCHAR(50) NOT NULL, -- å¥åº·ä¿é™ºã€åšç”Ÿå¹´é‡‘ã€é›‡ç”¨ä¿é™º
    employee_rate DECIMAL(5,4) NOT NULL,
    employer_rate DECIMAL(5,4) NOT NULL,
    effective_from DATE NOT NULL,
    effective_to DATE,
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- ç¨ç‡ãƒã‚¹ã‚¿
CREATE TABLE tax_brackets (
    bracket_id SERIAL PRIMARY KEY,
    income_from DECIMAL(12,2) NOT NULL,
    income_to DECIMAL(12,2),
    tax_rate DECIMAL(5,4) NOT NULL,
    deduction_amount DECIMAL(12,2) NOT NULL DEFAULT 0,
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);
```

### 2. ã‚·ãƒ•ãƒˆç®¡ç†æ‹¡å¼µï¼ˆå„ªå…ˆåº¦: ğŸŸ¡ ä¸­ï¼‰

```sql
-- ã‚·ãƒ•ãƒˆå•é¡Œç‚¹
CREATE TABLE shift_issues (
    issue_id SERIAL PRIMARY KEY,
    shift_id INT NOT NULL,
    issue_type VARCHAR(50) NOT NULL, -- CONFLICT, SHORTAGE, SKILL_MISMATCH
    severity VARCHAR(20) NOT NULL CHECK (severity IN ('HIGH', 'MEDIUM', 'LOW')),
    description TEXT,
    detected_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    resolved_at TIMESTAMP,
    is_resolved BOOLEAN NOT NULL DEFAULT FALSE,
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (shift_id) REFERENCES shifts(shift_id) ON DELETE CASCADE
);

-- ã‚·ãƒ•ãƒˆè§£æ±ºç­–
CREATE TABLE shift_solutions (
    solution_id SERIAL PRIMARY KEY,
    issue_id INT NOT NULL,
    solution_type VARCHAR(50) NOT NULL, -- REASSIGN, ADD_STAFF, ADJUST_TIME
    description TEXT,
    implemented_at TIMESTAMP,
    is_implemented BOOLEAN NOT NULL DEFAULT FALSE,
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (issue_id) REFERENCES shift_issues(issue_id) ON DELETE CASCADE
);
```

### 3. å®‰å…¨è¡›ç”Ÿç®¡ç†ï¼ˆå„ªå…ˆåº¦: ğŸŸ¡ ä¸­ï¼‰

```sql
-- å®‰å…¨è¡›ç”Ÿãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
CREATE TABLE safety_checklist (
    checklist_id SERIAL PRIMARY KEY,
    store_id INT NOT NULL,
    check_date DATE NOT NULL,
    checklist_type VARCHAR(50) NOT NULL, -- DAILY, WEEKLY, MONTHLY
    item_name VARCHAR(200) NOT NULL,
    check_result BOOLEAN NOT NULL DEFAULT FALSE,
    checked_by INT,
    notes TEXT,
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (store_id) REFERENCES stores(store_id) ON DELETE CASCADE,
    FOREIGN KEY (checked_by) REFERENCES staff(staff_id)
);
```

---

## ğŸ“Š æ¨å¥¨ãƒ“ãƒ¥ãƒ¼å®šç¾©

### 1. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ¡ãƒˆãƒªã‚¯ã‚¹

```sql
CREATE VIEW v_dashboard_metrics AS
SELECT
    s.store_id,
    st.store_name,
    DATE_TRUNC('month', sa.actual_date) AS month,
    SUM(sa.sales_amount) AS total_sales,
    SUM(sh.labor_cost) AS total_labor_cost,
    SUM(sa.sales_amount) - SUM(sh.labor_cost) AS profit,
    ROUND(SUM(sh.labor_cost) / NULLIF(SUM(sa.sales_amount), 0) * 100, 2) AS labor_cost_ratio
FROM sales_actual sa
JOIN stores st ON sa.store_id = st.store_id
LEFT JOIN shifts sh ON DATE(sh.shift_date) = sa.actual_date AND sh.is_active = TRUE
WHERE sa.is_active = TRUE
GROUP BY s.store_id, st.store_name, DATE_TRUNC('month', sa.actual_date);
```

### 2. æœˆæ¬¡ã‚·ãƒ•ãƒˆã‚µãƒãƒªãƒ¼

```sql
CREATE VIEW v_shift_monthly_summary AS
SELECT
    sp.plan_id,
    sp.plan_year,
    sp.plan_month,
    COUNT(DISTINCT s.staff_id) AS staff_count,
    COUNT(s.shift_id) AS total_shifts,
    SUM(s.total_hours) AS total_hours,
    SUM(s.labor_cost) AS total_labor_cost,
    AVG(s.total_hours) AS avg_hours_per_shift
FROM shift_plans sp
JOIN shifts s ON sp.plan_id = s.plan_id
WHERE s.is_active = TRUE
GROUP BY sp.plan_id, sp.plan_year, sp.plan_month;
```

### 3. ã‚¹ã‚¿ãƒƒãƒ•æœˆæ¬¡ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

```sql
CREATE VIEW v_staff_monthly_performance AS
SELECT
    st.staff_id,
    st.name,
    DATE_TRUNC('month', s.shift_date) AS month,
    COUNT(s.shift_id) AS shift_count,
    SUM(s.total_hours) AS total_hours,
    SUM(s.labor_cost) AS total_cost,
    AVG(wh.actual_work_hours) AS avg_work_hours,
    COUNT(CASE WHEN wh.attendance_status = 'LATE' THEN 1 END) AS late_count,
    COUNT(CASE WHEN wh.attendance_status = 'ABSENT' THEN 1 END) AS absent_count
FROM staff st
JOIN shifts s ON st.staff_id = s.staff_id
LEFT JOIN work_hours_actual wh ON s.shift_id = wh.shift_id
WHERE s.is_active = TRUE
GROUP BY st.staff_id, st.name, DATE_TRUNC('month', s.shift_date);
```

---

## ğŸ¯ å®Ÿè£…å„ªå…ˆé †ä½

### ãƒ•ã‚§ãƒ¼ã‚º1: ç¾åœ¨ã®DBã‚¹ã‚­ãƒ¼ãƒã§å¯¾å¿œï¼ˆæ—¢å­˜ï¼‰
- âœ… 22/36 ã®CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Œå…¨ã‚«ãƒãƒ¼

### ãƒ•ã‚§ãƒ¼ã‚º2: ãƒ“ãƒ¥ãƒ¼è¿½åŠ ï¼ˆå³åº§ã«å®Ÿè£…å¯èƒ½ï¼‰
- `v_dashboard_metrics`
- `v_shift_monthly_summary`
- `v_staff_monthly_performance`
- **å¯¾å¿œCSVãƒ•ã‚¡ã‚¤ãƒ«**: +3ä»¶ â†’ 25/36ï¼ˆ69%ï¼‰

### ãƒ•ã‚§ãƒ¼ã‚º3: çµ¦ä¸è¨ˆç®—ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ ï¼ˆå„ªå…ˆåº¦: ğŸ”´ é«˜ï¼‰
- `commute_allowance`
- `insurance_rates`
- `tax_brackets`
- **å¯¾å¿œCSVãƒ•ã‚¡ã‚¤ãƒ«**: +3ä»¶ â†’ 28/36ï¼ˆ78%ï¼‰

### ãƒ•ã‚§ãƒ¼ã‚º4: ã‚·ãƒ•ãƒˆç®¡ç†æ‹¡å¼µï¼ˆå„ªå…ˆåº¦: ğŸŸ¡ ä¸­ï¼‰
- `shift_issues`
- `shift_solutions`
- **å¯¾å¿œCSVãƒ•ã‚¡ã‚¤ãƒ«**: +2ä»¶ â†’ 30/36ï¼ˆ83%ï¼‰

### ãƒ•ã‚§ãƒ¼ã‚º5: ãã®ä»–ï¼ˆå„ªå…ˆåº¦: ğŸŸ¢ ä½ï¼‰
- `safety_checklist`
- å¤©æ°—ãƒ‡ãƒ¼ã‚¿çµ±åˆ
- **å¯¾å¿œCSVãƒ•ã‚¡ã‚¤ãƒ«**: +2ä»¶ â†’ 32/36ï¼ˆ89%ï¼‰

---

## âœ… çµè«–

### ç¾çŠ¶
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«**: 20ãƒ†ãƒ¼ãƒ–ãƒ«
- **CSVãƒ•ã‚¡ã‚¤ãƒ«**: 36ãƒ•ã‚¡ã‚¤ãƒ«
- **å¯¾å¿œç‡**: **61%ï¼ˆ22/36ï¼‰**

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ–¹ãŒå¤šã„ã‚±ãƒ¼ã‚¹
ä»¥ä¸‹ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã¯CSVã«å¯¾å¿œã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãŒãªã„ï¼ˆæ–°è¦è¨­è¨ˆï¼‰:
- `shift_history` - ã‚·ãƒ•ãƒˆå¤‰æ›´å±¥æ­´ã®è¿½è·¡æ©Ÿèƒ½

### CSVã®æ–¹ãŒå¤šã„ã‚±ãƒ¼ã‚¹ï¼ˆ14ãƒ•ã‚¡ã‚¤ãƒ«æœªå¯¾å¿œï¼‰
- **çµ¦ä¸è¨ˆç®—é–¢é€£**: 3ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå„ªå…ˆåº¦: é«˜ï¼‰
- **ãƒ“ãƒ¥ãƒ¼å¯¾å¿œå¯**: 4ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå„ªå…ˆåº¦: ä½ï¼‰
- **æ‹¡å¼µæ©Ÿèƒ½**: 7ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå„ªå…ˆåº¦: ä¸­ã€œä½ï¼‰

### æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
1. **å³åº§ã«å®Ÿè¡Œ**: ç¾åœ¨ã®20ãƒ†ãƒ¼ãƒ–ãƒ«ã§æ§‹ç¯‰é–‹å§‹ï¼ˆ61%ã‚«ãƒãƒ¼ï¼‰
2. **æ¬¡é€±å®Ÿè£…**: ãƒ“ãƒ¥ãƒ¼3ã¤è¿½åŠ ï¼ˆâ†’69%ã‚«ãƒãƒ¼ï¼‰
3. **ä»Šå¾Œå®Ÿè£…**: çµ¦ä¸è¨ˆç®—ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ ï¼ˆâ†’78%ã‚«ãƒãƒ¼ï¼‰

**ç¾åœ¨ã®ã‚¹ã‚­ãƒ¼ãƒã¯ä¸»è¦æ©Ÿèƒ½ã‚’ååˆ†ã‚«ãƒãƒ¼ã—ã¦ãŠã‚Šã€å³åº§ã«æ§‹ç¯‰é–‹å§‹å¯èƒ½ã§ã™ã€‚**
