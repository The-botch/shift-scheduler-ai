<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€€è·è€…ç®¡ç† - å…¨ä½“è¨­è¨ˆæ›¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 8px;
        }

        h1 {
            color: #2c3e50;
            border-bottom: 4px solid #9b59b6;
            padding-bottom: 15px;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        h2 {
            color: #2c3e50;
            margin-top: 40px;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-left: 5px solid #9b59b6;
            padding-left: 15px;
        }

        h3 {
            color: #34495e;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .overview-box {
            background: #f3e5f5;
            border-left: 4px solid #9b59b6;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .phase-box {
            background: white;
            border: 2px solid #9b59b6;
            border-radius: 8px;
            padding: 25px;
            margin: 25px 0;
        }

        .phase-header {
            background: #9b59b6;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 15px;
        }

        .phase-status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 3px;
            font-size: 0.85em;
            font-weight: bold;
            margin-left: 10px;
        }

        .phase-status.completed {
            background: #28a745;
            color: white;
        }

        .phase-status.in-progress {
            background: #ffc107;
            color: #333;
        }

        .phase-status.pending {
            background: #6c757d;
            color: white;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        table th {
            background: #9b59b6;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }

        table td {
            padding: 12px 15px;
            border-bottom: 1px solid #dee2e6;
        }

        table tr:hover {
            background: #f8f9fa;
        }

        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .code-block pre {
            margin: 0;
        }

        ul, ol {
            margin-left: 30px;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        li {
            margin: 8px 0;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .diagram {
            background: #f8f9fa;
            border: 2px solid #9b59b6;
            border-radius: 8px;
            padding: 30px;
            margin: 25px 0;
            text-align: center;
        }

        .flow-item {
            display: inline-block;
            background: white;
            border: 2px solid #9b59b6;
            border-radius: 8px;
            padding: 15px 25px;
            margin: 10px;
            font-weight: bold;
        }

        .arrow {
            display: inline-block;
            font-size: 2em;
            color: #9b59b6;
            margin: 0 10px;
        }

        .db-table {
            background: #263238;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
        }

        .db-column {
            padding: 5px 0;
            border-bottom: 1px solid #546e7a;
        }

        .db-column:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ‘‹ é€€è·è€…ç®¡ç† - å…¨ä½“è¨­è¨ˆæ›¸</h1>

        <div class="overview-box">
            <h3>ğŸ“‹ è¨­è¨ˆã®ç›®çš„</h3>
            <p>ã‚¹ã‚¿ãƒƒãƒ•ã®é€€è·ã«é–¢é€£ã™ã‚‹ã™ã¹ã¦ã®æ©Ÿèƒ½ã‚’åŒ…æ‹¬çš„ã«è¨­è¨ˆã—ã€ä¸€è²«æ€§ã®ã‚ã‚‹é€€è·è€…ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã™ã‚‹ã€‚</p>

            <p style="margin-top: 15px;"><strong>å¯¾è±¡ç¯„å›²ï¼š</strong></p>
            <ul>
                <li>é€€è·åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯</li>
                <li>é€€è·å‡¦ç†ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼</li>
                <li>ã‚·ãƒ•ãƒˆè¡¨ç¤ºã¨ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½</li>
                <li>ã‚¹ã‚¿ãƒƒãƒ•é¸æŠè‚¢ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°</li>
                <li>ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ»æ¨©é™ç®¡ç†</li>
                <li>ãƒ¬ãƒãƒ¼ãƒˆãƒ»é›†è¨ˆ</li>
            </ul>
        </div>

        <h2>1. ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ </h2>

        <div class="db-table">
<pre>CREATE TABLE hr.staff (
    staff_id SERIAL PRIMARY KEY,
    tenant_id INTEGER NOT NULL,
    division_id INTEGER,
    store_id INTEGER NOT NULL,
    role_id INTEGER NOT NULL,
    staff_code VARCHAR(50) NOT NULL,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(200),
    phone_number VARCHAR(20),
    employment_type VARCHAR(50) NOT NULL,
    hire_date DATE NOT NULL,
    <strong style="color: #ffc107;">resignation_date DATE,</strong>           -- é€€è·æ—¥ï¼ˆæ—¢å­˜ï¼‰
    monthly_salary NUMERIC(10,2),
    hourly_rate NUMERIC(8,2),
    commute_distance_km NUMERIC(5,2),
    has_social_insurance BOOLEAN DEFAULT false,
    <strong style="color: #ffc107;">is_active BOOLEAN DEFAULT true,</strong>   -- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ•ãƒ©ã‚°ï¼ˆæ—¢å­˜ï¼‰
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);</pre>
        </div>

        <div class="success-box">
            <p><strong>âœ… æ—¢å­˜ã®ã‚«ãƒ©ãƒ :</strong></p>
            <ul>
                <li><code>resignation_date</code> - é€€è·æ—¥ï¼ˆDATEå‹ã€NULLABLEï¼‰</li>
                <li><code>is_active</code> - ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ•ãƒ©ã‚°ï¼ˆBOOLEANå‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ trueï¼‰</li>
            </ul>
            <p style="margin-top: 10px;">åŸºæœ¬çš„ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¯æ—¢ã«æ•´ã£ã¦ã„ã‚‹ã€‚è¿½åŠ ã®ã‚«ãƒ©ãƒ ã¯ä¸è¦ã€‚</p>
        </div>

        <h2>2. å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚ºã®å…¨ä½“åƒ</h2>

        <div class="diagram">
            <h3>å®Ÿè£…ã®æµã‚Œ</h3>
            <div style="margin: 30px 0;">
                <div class="flow-item">Phase 1<br>é€€è·åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯</div>
                <span class="arrow">â†’</span>
                <div class="flow-item">Phase 2<br>é€€è·å‡¦ç†UI</div>
                <span class="arrow">â†’</span>
                <div class="flow-item">Phase 3<br>ã‚·ãƒ•ãƒˆè¡¨ç¤º</div>
                <span class="arrow">â†’</span>
                <div class="flow-item">Phase 4<br>ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°</div>
                <span class="arrow">â†’</span>
                <div class="flow-item">Phase 5<br>æ¨©é™ç®¡ç†</div>
                <span class="arrow">â†’</span>
                <div class="flow-item">Phase 6<br>ãƒ¬ãƒãƒ¼ãƒˆ</div>
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Phase</th>
                    <th>å†…å®¹</th>
                    <th>å„ªå…ˆåº¦</th>
                    <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Phase 1</strong></td>
                    <td>é€€è·åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã®çµ±ä¸€</td>
                    <td>é«˜</td>
                    <td><span class="phase-status pending">æœªç€æ‰‹</span></td>
                </tr>
                <tr>
                    <td><strong>Phase 2</strong></td>
                    <td>é€€è·å‡¦ç†ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆUI/ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰</td>
                    <td>é«˜</td>
                    <td><span class="phase-status pending">æœªç€æ‰‹</span></td>
                </tr>
                <tr>
                    <td><strong>Phase 3</strong></td>
                    <td>é€€è·è€…è¡¨ç¤ºã¨ã‚·ãƒ•ãƒˆã‚³ãƒ”ãƒ¼</td>
                    <td>é«˜</td>
                    <td><span class="phase-status completed">è¨­è¨ˆå®Œäº†</span></td>
                </tr>
                <tr>
                    <td><strong>Phase 4</strong></td>
                    <td>ã‚¹ã‚¿ãƒƒãƒ•é¸æŠè‚¢ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°</td>
                    <td>ä¸­</td>
                    <td><span class="phase-status pending">æœªç€æ‰‹</span></td>
                </tr>
                <tr>
                    <td><strong>Phase 5</strong></td>
                    <td>ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ»æ¨©é™ç®¡ç†</td>
                    <td>ä¸­</td>
                    <td><span class="phase-status pending">æœªç€æ‰‹</span></td>
                </tr>
                <tr>
                    <td><strong>Phase 6</strong></td>
                    <td>ãƒ¬ãƒãƒ¼ãƒˆãƒ»é›†è¨ˆã§ã®é€€è·è€…ã®æ‰±ã„</td>
                    <td>ä½</td>
                    <td><span class="phase-status pending">æœªç€æ‰‹</span></td>
                </tr>
            </tbody>
        </table>

        <h2>Phase 1: é€€è·åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã®çµ±ä¸€</h2>

        <div class="phase-box">
            <div class="phase-header">
                Phase 1: é€€è·åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
                <span class="phase-status pending">æœªç€æ‰‹</span>
            </div>

            <h3>ç›®çš„</h3>
            <p>ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã§ä¸€è²«ã—ãŸé€€è·åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã‚’ç¢ºç«‹ã™ã‚‹ã€‚</p>

            <h3>æ¤œè¨äº‹é …</h3>

            <table>
                <thead>
                    <tr>
                        <th>é …ç›®</th>
                        <th>é¸æŠè‚¢</th>
                        <th>æ¨å¥¨</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>åˆ¤å®šæ–¹æ³•</strong></td>
                        <td>
                            1. <code>is_active</code> ã®ã¿ã§åˆ¤å®š<br>
                            2. <code>resignation_date</code> ã®ã¿ã§åˆ¤å®š<br>
                            3. ä¸¡æ–¹ã‚’çµ„ã¿åˆã‚ã›
                        </td>
                        <td><strong>3. ä¸¡æ–¹ã‚’çµ„ã¿åˆã‚ã›</strong></td>
                    </tr>
                    <tr>
                        <td><strong>é€€è·æ—¥ã®æ‰±ã„</strong></td>
                        <td>
                            1. é€€è·æ—¥å½“æ—¥ã¯ã€Œåœ¨ç±ä¸­ã€<br>
                            2. é€€è·æ—¥å½“æ—¥ã¯ã€Œé€€è·æ¸ˆã¿ã€
                        </td>
                        <td><strong>1. é€€è·æ—¥å½“æ—¥ã¯åœ¨ç±ä¸­</strong><br>ï¼ˆç¿Œæ—¥ã‹ã‚‰é€€è·æ‰±ã„ï¼‰</td>
                    </tr>
                </tbody>
            </table>

            <h3>æ¨å¥¨ãƒ­ã‚¸ãƒƒã‚¯</h3>

            <div class="code-block">
<pre>/**
 * ã‚¹ã‚¿ãƒƒãƒ•ãŒé€€è·æ¸ˆã¿ã‹ã©ã†ã‹ã‚’åˆ¤å®š
 * @param {Object} staff - ã‚¹ã‚¿ãƒƒãƒ•ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
 * @param {Date} referenceDate - åŸºæº–æ—¥ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ä»Šæ—¥ï¼‰
 * @returns {boolean} é€€è·æ¸ˆã¿ã®å ´åˆ true
 */
function isRetired(staff, referenceDate = new Date()) {
  // 1. is_active ãŒ false ã®å ´åˆã¯é€€è·æ¸ˆã¿
  if (!staff.is_active) {
    return true
  }

  // 2. resignation_date ãŒè¨­å®šã•ã‚Œã¦ãŠã‚Šã€åŸºæº–æ—¥ã‚ˆã‚Šå‰ã®å ´åˆã¯é€€è·æ¸ˆã¿
  if (staff.resignation_date) {
    const resignationDate = new Date(staff.resignation_date)
    // é€€è·æ—¥ã®ç¿Œæ—¥ã‹ã‚‰é€€è·æ‰±ã„
    const nextDay = new Date(resignationDate)
    nextDay.setDate(nextDay.getDate() + 1)

    if (referenceDate >= nextDay) {
      return true
    }
  }

  // ãã‚Œä»¥å¤–ã¯åœ¨ç±ä¸­
  return false
}

/**
 * ã‚¹ã‚¿ãƒƒãƒ•ãŒé€€è·äºˆå®šã‹ã©ã†ã‹ã‚’åˆ¤å®š
 * @param {Object} staff - ã‚¹ã‚¿ãƒƒãƒ•ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
 * @returns {boolean} é€€è·äºˆå®šã®å ´åˆ true
 */
function isPendingRetirement(staff) {
  if (!staff.is_active) return false
  if (!staff.resignation_date) return false

  const resignationDate = new Date(staff.resignation_date)
  const today = new Date()

  // é€€è·æ—¥ãŒæœªæ¥ã®å ´åˆã¯é€€è·äºˆå®š
  return resignationDate > today
}

/**
 * ã‚¹ã‚¿ãƒƒãƒ•ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å–å¾—
 * @param {Object} staff - ã‚¹ã‚¿ãƒƒãƒ•ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
 * @returns {string} 'active' | 'pending_retirement' | 'retired'
 */
function getStaffStatus(staff) {
  if (isRetired(staff)) {
    return 'retired'
  }
  if (isPendingRetirement(staff)) {
    return 'pending_retirement'
  }
  return 'active'
}
</pre>
            </div>

            <h3>å®Ÿè£…ã‚¿ã‚¹ã‚¯</h3>
            <ul>
                <li>å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã®ä½œæˆï¼ˆä¸Šè¨˜ã®ãƒ­ã‚¸ãƒƒã‚¯ï¼‰</li>
                <li>æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®ç½®ãæ›ãˆï¼ˆã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã§çµ±ä¸€ï¼‰</li>
                <li>ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®ä½œæˆ</li>
            </ul>
        </div>

        <h2>Phase 2: é€€è·å‡¦ç†ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼</h2>

        <div class="phase-box">
            <div class="phase-header">
                Phase 2: é€€è·å‡¦ç†ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
                <span class="phase-status pending">æœªç€æ‰‹</span>
            </div>

            <h3>ç›®çš„</h3>
            <p>ã‚¹ã‚¿ãƒƒãƒ•ã‚’é€€è·ã•ã›ã‚‹æ“ä½œã®UI/UXã¨ã€é€€è·æ—¥ä»¥é™ã®ã‚·ãƒ•ãƒˆã«å¯¾ã™ã‚‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã™ã‚‹ã€‚</p>

            <h3>2-1. é€€è·å‡¦ç†UI</h3>

            <p><strong>ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†ç”»é¢ã«è¿½åŠ :</strong></p>
            <ul>
                <li>ã€Œé€€è·å‡¦ç†ã€ãƒœã‚¿ãƒ³</li>
                <li>é€€è·æ—¥ã®å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ </li>
                <li>ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°</li>
            </ul>

            <h3>2-2. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³</h3>

            <div class="warning-box">
                <p><strong>âš ï¸ é€€è·æ—¥è¨­å®šæ™‚ã®ãƒã‚§ãƒƒã‚¯é …ç›®:</strong></p>
                <ol>
                    <li><strong>æœªæ¥ã®ã‚·ãƒ•ãƒˆãƒã‚§ãƒƒã‚¯:</strong> é€€è·æ—¥ä»¥é™ã®ã‚·ãƒ•ãƒˆãŒå­˜åœ¨ã™ã‚‹ã‹ï¼Ÿ</li>
                    <li><strong>è­¦å‘Šè¡¨ç¤º:</strong> ã€Œã“ã®ã‚¹ã‚¿ãƒƒãƒ•ã¯â—‹æœˆã®ã‚·ãƒ•ãƒˆã«â—‹ä»¶å«ã¾ã‚Œã¦ã„ã¾ã™ã€</li>
                    <li><strong>å¯¾å¿œé¸æŠ:</strong>
                        <ul>
                            <li>ãã®ã¾ã¾é€€è·å‡¦ç†ã‚’å®Ÿè¡Œï¼ˆæ‰‹å‹•ã§å¾Œã‹ã‚‰ä¿®æ­£ï¼‰</li>
                            <li>ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¦ã‚·ãƒ•ãƒˆã‚’ä¿®æ­£ã—ã¦ã‹ã‚‰å†å®Ÿè¡Œ</li>
                        </ul>
                    </li>
                </ol>
            </div>

            <div class="code-block">
<pre>/**
 * é€€è·æ—¥è¨­å®šæ™‚ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
 */
async function validateRetirement(staffId, resignationDate) {
  // é€€è·æ—¥ä»¥é™ã®ã‚·ãƒ•ãƒˆã‚’æ¤œç´¢
  const futureShifts = await getShiftsAfterDate(staffId, resignationDate)

  if (futureShifts.length > 0) {
    // æœˆã”ã¨ã«é›†è¨ˆ
    const shiftsByMonth = groupShiftsByMonth(futureShifts)

    return {
      valid: false,
      warning: true,
      message: `ã“ã®ã‚¹ã‚¿ãƒƒãƒ•ã¯é€€è·æ—¥ä»¥é™ã®ã‚·ãƒ•ãƒˆã«${futureShifts.length}ä»¶å«ã¾ã‚Œã¦ã„ã¾ã™`,
      details: shiftsByMonth.map(({ month, count }) =>
        `${month}æœˆ: ${count}ä»¶`
      ).join('\n')
    }
  }

  return { valid: true }
}

/**
 * é€€è·å‡¦ç†ã®å®Ÿè¡Œ
 */
async function executeRetirement(staffId, resignationDate, options = {}) {
  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  const validation = await validateRetirement(staffId, resignationDate)

  if (validation.warning && !options.confirmed) {
    throw new Error('æœªæ¥ã®ã‚·ãƒ•ãƒˆãŒå­˜åœ¨ã—ã¾ã™ã€‚ç¢ºèªãŒå¿…è¦ã§ã™ã€‚')
  }

  // é€€è·æ—¥ã‚’è¨­å®š
  await updateStaff(staffId, {
    resignation_date: resignationDate
  })

  // ã‚ªãƒ—ã‚·ãƒ§ãƒ³: é€€è·æ—¥ä»¥é™ã®ã‚·ãƒ•ãƒˆã‚’è‡ªå‹•å‰Šé™¤
  if (options.autoDeleteFutureShifts) {
    await deleteShiftsAfterDate(staffId, resignationDate)
  }
}
</pre>
            </div>

            <h3>å®Ÿè£…ã‚¿ã‚¹ã‚¯</h3>
            <ul>
                <li>ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†ç”»é¢ã«ã€Œé€€è·å‡¦ç†ã€æ©Ÿèƒ½ã‚’è¿½åŠ </li>
                <li>é€€è·æ—¥å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ </li>
                <li>æœªæ¥ã®ã‚·ãƒ•ãƒˆãƒã‚§ãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯</li>
                <li>è­¦å‘Šãƒ€ã‚¤ã‚¢ãƒ­ã‚°</li>
                <li>é€€è·å‡¦ç†API</li>
            </ul>
        </div>

        <h2>Phase 3: é€€è·è€…è¡¨ç¤ºã¨ã‚·ãƒ•ãƒˆã‚³ãƒ”ãƒ¼</h2>

        <div class="phase-box">
            <div class="phase-header">
                Phase 3: é€€è·è€…è¡¨ç¤ºã¨ã‚·ãƒ•ãƒˆã‚³ãƒ”ãƒ¼
                <span class="phase-status completed">è¨­è¨ˆå®Œäº†</span>
            </div>

            <h3>è¨­è¨ˆå®Œäº†</h3>
            <p>è©³ç´°è¨­è¨ˆã¯ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼š</p>
            <ul>
                <li>ğŸ“„ <a href="RETIRED_STAFF_DISPLAY.html">é€€è·è€…è¡¨ç¤ºã¨ã‚·ãƒ•ãƒˆã‚³ãƒ”ãƒ¼ã®è¨­è¨ˆæ›¸</a></li>
                <li>ğŸ“ Commit: <code>3eb4362</code> - docs: é€€è·è€…è¡¨ç¤ºã¨ã‚·ãƒ•ãƒˆã‚³ãƒ”ãƒ¼ã®è¨­è¨ˆæ›¸ã‚’ä½œæˆ</li>
            </ul>

            <h3>æ¦‚è¦</h3>
            <ul>
                <li><strong>ã‚¹ã‚¿ãƒƒãƒ•ãƒ“ãƒ¥ãƒ¼:</strong> ãã®æœˆã®ã‚·ãƒ•ãƒˆã«å«ã¾ã‚Œã‚‹é€€è·è€…ã®ã¿è¡¨ç¤ºï¼ˆã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆï¼‰</li>
                <li><strong>ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼:</strong> é€€è·è€…ã‚’å«ã‚€æ—¥ã‚’è‰²åˆ†ã‘è¡¨ç¤ºï¼ˆã‚ªãƒ¬ãƒ³ã‚¸è‰² + âš ï¸ï¼‰</li>
                <li><strong>ã‚·ãƒ•ãƒˆã‚³ãƒ”ãƒ¼:</strong> é€€è·è€…ã‚‚å«ã‚ã¦ã‚³ãƒ”ãƒ¼ï¼ˆè¦–è¦šçš„ã«æ˜ç¤ºã€æ‰‹å‹•ã§å¯¾å¿œï¼‰</li>
            </ul>

            <h3>å®Ÿè£…ã‚¿ã‚¹ã‚¯</h3>
            <ul>
                <li><code>getVisibleStaffForMonth()</code> é–¢æ•°ã®å®Ÿè£…</li>
                <li>ã‚¹ã‚¿ãƒƒãƒ•ãƒ“ãƒ¥ãƒ¼ã§é€€è·è€…åˆ—ã®ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆè¡¨ç¤º</li>
                <li>ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼ã§é€€è·è€…ã‚’å«ã‚€æ—¥ã®è‰²åˆ†ã‘</li>
                <li>ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã§é€€è·è€…ã®è©³ç´°ã‚’è¡¨ç¤º</li>
            </ul>
        </div>

        <h2>Phase 4: ã‚¹ã‚¿ãƒƒãƒ•é¸æŠè‚¢ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°</h2>

        <div class="phase-box">
            <div class="phase-header">
                Phase 4: ã‚¹ã‚¿ãƒƒãƒ•é¸æŠè‚¢ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
                <span class="phase-status pending">æœªç€æ‰‹</span>
            </div>

            <h3>ç›®çš„</h3>
            <p>æ–°è¦ã‚·ãƒ•ãƒˆä½œæˆæ™‚ã‚„ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§ç”»é¢ã§ã€é€€è·è€…ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’é©åˆ‡ã«åˆ¶å¾¡ã™ã‚‹ã€‚</p>

            <h3>4-1. æ–°è¦ã‚·ãƒ•ãƒˆä½œæˆæ™‚</h3>

            <table>
                <thead>
                    <tr>
                        <th>ç”»é¢</th>
                        <th>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡¨ç¤º</th>
                        <th>ã‚ªãƒ—ã‚·ãƒ§ãƒ³</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>ã‚¹ã‚¿ãƒƒãƒ•é¸æŠãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³</strong></td>
                        <td>åœ¨ç±è€…ã®ã¿</td>
                        <td>â˜‘ é€€è·è€…ã‚‚è¡¨ç¤º</td>
                    </tr>
                    <tr>
                        <td><strong>ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§</strong></td>
                        <td>åœ¨ç±è€…ã®ã¿</td>
                        <td>ãƒ•ã‚£ãƒ«ã‚¿: å…¨ã¦ / åœ¨ç±ä¸­ / é€€è·æ¸ˆã¿</td>
                    </tr>
                </tbody>
            </table>

            <h3>4-2. é€€è·è€…ã¸ã®ã‚·ãƒ•ãƒˆå‰²ã‚Šå½“ã¦é˜²æ­¢</h3>

            <div class="code-block">
<pre>/**
 * ã‚·ãƒ•ãƒˆå‰²ã‚Šå½“ã¦æ™‚ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
 */
function validateShiftAssignment(staffId, shiftDate) {
  const staff = getStaff(staffId)

  // é€€è·è€…ãƒã‚§ãƒƒã‚¯
  if (isRetired(staff, shiftDate)) {
    return {
      valid: false,
      error: `${staff.name} ã¯ ${shiftDate} æ™‚ç‚¹ã§é€€è·æ¸ˆã¿ã§ã™ã€‚`
    }
  }

  // é€€è·äºˆå®šè€…ã®è­¦å‘Š
  if (isPendingRetirement(staff)) {
    const resignationDate = new Date(staff.resignation_date)
    if (shiftDate > resignationDate) {
      return {
        valid: false,
        warning: `${staff.name} ã¯ ${formatDate(resignationDate)} ã«é€€è·äºˆå®šã§ã™ã€‚`,
        canOverride: true
      }
    }
  }

  return { valid: true }
}
</pre>
            </div>

            <h3>å®Ÿè£…ã‚¿ã‚¹ã‚¯</h3>
            <ul>
                <li>ã‚¹ã‚¿ãƒƒãƒ•é¸æŠãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°</li>
                <li>ã€Œé€€è·è€…ã‚‚è¡¨ç¤ºã€ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹</li>
                <li>ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§ã®ãƒ•ã‚£ãƒ«ã‚¿æ©Ÿèƒ½</li>
                <li>ã‚·ãƒ•ãƒˆå‰²ã‚Šå½“ã¦æ™‚ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³</li>
                <li>è­¦å‘Šãƒ€ã‚¤ã‚¢ãƒ­ã‚°</li>
            </ul>
        </div>

        <h2>Phase 5: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ»æ¨©é™ç®¡ç†</h2>

        <div class="phase-box">
            <div class="phase-header">
                Phase 5: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ»æ¨©é™ç®¡ç†
                <span class="phase-status pending">æœªç€æ‰‹</span>
            </div>

            <h3>ç›®çš„</h3>
            <p>é€€è·è€…ã®ãƒ­ã‚°ã‚¤ãƒ³ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨æ¨©é™ã‚’é©åˆ‡ã«ç®¡ç†ã™ã‚‹ã€‚</p>

            <h3>5-1. ãƒ­ã‚°ã‚¤ãƒ³åˆ¶å¾¡</h3>

            <table>
                <thead>
                    <tr>
                        <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                        <th>ãƒ­ã‚°ã‚¤ãƒ³å¯å¦</th>
                        <th>æ¨©é™</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>åœ¨ç±ä¸­</strong></td>
                        <td>âœ… å¯èƒ½</td>
                        <td>é€šå¸¸æ¨©é™</td>
                    </tr>
                    <tr>
                        <td><strong>é€€è·äºˆå®š</strong></td>
                        <td>âœ… å¯èƒ½ï¼ˆé€€è·æ—¥ã¾ã§ï¼‰</td>
                        <td>é€šå¸¸æ¨©é™</td>
                    </tr>
                    <tr>
                        <td><strong>é€€è·æ¸ˆã¿</strong></td>
                        <td>âŒ ä¸å¯</td>
                        <td>ãªã—</td>
                    </tr>
                </tbody>
            </table>

            <h3>5-2. å®Ÿè£…</h3>

            <div class="code-block">
<pre>/**
 * ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®ãƒã‚§ãƒƒã‚¯
 */
async function authenticateStaff(staffCode, password) {
  const staff = await findStaffByCode(staffCode)

  if (!staff) {
    throw new Error('ã‚¹ã‚¿ãƒƒãƒ•ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“')
  }

  // é€€è·è€…ã¯ãƒ­ã‚°ã‚¤ãƒ³ä¸å¯
  if (isRetired(staff)) {
    throw new Error('ã“ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã¾ã™')
  }

  // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼
  const valid = await verifyPassword(password, staff.password_hash)
  if (!valid) {
    throw new Error('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“')
  }

  return staff
}
</pre>
            </div>

            <h3>å®Ÿè£…ã‚¿ã‚¹ã‚¯</h3>
            <ul>
                <li>ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®é€€è·è€…ãƒã‚§ãƒƒã‚¯</li>
                <li>ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤º</li>
                <li>ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®æ›´æ–°</li>
            </ul>
        </div>

        <h2>Phase 6: ãƒ¬ãƒãƒ¼ãƒˆãƒ»é›†è¨ˆ</h2>

        <div class="phase-box">
            <div class="phase-header">
                Phase 6: ãƒ¬ãƒãƒ¼ãƒˆãƒ»é›†è¨ˆ
                <span class="phase-status pending">æœªç€æ‰‹</span>
            </div>

            <h3>ç›®çš„</h3>
            <p>å‹¤å‹™å®Ÿç¸¾ãƒ¬ãƒãƒ¼ãƒˆã‚„çµ¦ä¸è¨ˆç®—ã§ã€é€€è·è€…ã‚’é©åˆ‡ã«æ‰±ã†ã€‚</p>

            <h3>6-1. ãƒ•ã‚£ãƒ«ã‚¿ã‚ªãƒ—ã‚·ãƒ§ãƒ³</h3>

            <p><strong>ãƒ¬ãƒãƒ¼ãƒˆç”»é¢ã«è¿½åŠ :</strong></p>
            <ul>
                <li>â˜‘ é€€è·è€…ã‚’å«ã‚ã‚‹</li>
                <li>æœŸé–“æŒ‡å®š: ãã®æœŸé–“ä¸­ã«åœ¨ç±ã—ã¦ã„ãŸã‚¹ã‚¿ãƒƒãƒ•ã®ã¿</li>
            </ul>

            <h3>6-2. å®Ÿè£…ä¾‹</h3>

            <div class="code-block">
<pre>/**
 * å‹¤å‹™å®Ÿç¸¾ãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ
 */
async function generateWorkReport(startDate, endDate, options = {}) {
  let staff = await getAllStaff()

  // é€€è·è€…ã‚’é™¤å¤–ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³
  if (!options.includeRetired) {
    staff = staff.filter(s => !isRetired(s, endDate))
  }

  // ãã®æœŸé–“ä¸­ã«åœ¨ç±ã—ã¦ã„ãŸã‚¹ã‚¿ãƒƒãƒ•ã®ã¿
  if (options.activeDuringPeriod) {
    staff = staff.filter(s => {
      // å…¥ç¤¾æ—¥ãŒæœŸé–“çµ‚äº†å‰
      if (new Date(s.hire_date) > endDate) return false

      // é€€è·æ—¥ãŒæœŸé–“é–‹å§‹å¾Œï¼ˆã¾ãŸã¯æœªè¨­å®šï¼‰
      if (s.resignation_date && new Date(s.resignation_date) < startDate) {
        return false
      }

      return true
    })
  }

  // ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
  return generateReport(staff, startDate, endDate)
}
</pre>
            </div>

            <h3>å®Ÿè£…ã‚¿ã‚¹ã‚¯</h3>
            <ul>
                <li>ãƒ¬ãƒãƒ¼ãƒˆç”»é¢ã«ãƒ•ã‚£ãƒ«ã‚¿ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¿½åŠ </li>
                <li>é€€è·è€…ã‚’å«ã‚ã‚‹/é™¤å¤–ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯</li>
                <li>æœŸé–“ä¸­ã®åœ¨ç±è€…ãƒ•ã‚£ãƒ«ã‚¿</li>
                <li>çµ¦ä¸è¨ˆç®—ã§ã®é€€è·è€…ã®æ‰±ã„</li>
            </ul>
        </div>

        <h2>å®Ÿè£…ã®å„ªå…ˆé †ä½</h2>

        <table>
            <thead>
                <tr>
                    <th>Phase</th>
                    <th>å†…å®¹</th>
                    <th>ä¾å­˜é–¢ä¿‚</th>
                    <th>æ¨å¥¨å®Ÿè£…é †</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Phase 1</strong></td>
                    <td>é€€è·åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯</td>
                    <td>-</td>
                    <td>1ç•ªç›®ï¼ˆåŸºç›¤ï¼‰</td>
                </tr>
                <tr>
                    <td><strong>Phase 3</strong></td>
                    <td>é€€è·è€…è¡¨ç¤ºã¨ã‚·ãƒ•ãƒˆã‚³ãƒ”ãƒ¼</td>
                    <td>Phase 1</td>
                    <td>2ç•ªç›®ï¼ˆé‡è¦ï¼‰</td>
                </tr>
                <tr>
                    <td><strong>Phase 2</strong></td>
                    <td>é€€è·å‡¦ç†ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼</td>
                    <td>Phase 1, 3</td>
                    <td>3ç•ªç›®</td>
                </tr>
                <tr>
                    <td><strong>Phase 4</strong></td>
                    <td>ã‚¹ã‚¿ãƒƒãƒ•é¸æŠè‚¢ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°</td>
                    <td>Phase 1</td>
                    <td>4ç•ªç›®</td>
                </tr>
                <tr>
                    <td><strong>Phase 5</strong></td>
                    <td>ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ»æ¨©é™ç®¡ç†</td>
                    <td>Phase 1</td>
                    <td>5ç•ªç›®</td>
                </tr>
                <tr>
                    <td><strong>Phase 6</strong></td>
                    <td>ãƒ¬ãƒãƒ¼ãƒˆãƒ»é›†è¨ˆ</td>
                    <td>Phase 1</td>
                    <td>6ç•ªç›®ï¼ˆä½å„ªå…ˆï¼‰</td>
                </tr>
            </tbody>
        </table>

        <h2>ã¾ã¨ã‚</h2>

        <div class="success-box">
            <h3>âœ… å…¨ä½“è¨­è¨ˆã®ãƒ¡ãƒªãƒƒãƒˆ</h3>
            <ul>
                <li><strong>ä¸€è²«æ€§:</strong> ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã§çµ±ä¸€ã•ã‚ŒãŸé€€è·è€…ã®æ‰±ã„</li>
                <li><strong>æ®µéšçš„å®Ÿè£…:</strong> Phaseå˜ä½ã§æ®µéšçš„ã«å®Ÿè£…å¯èƒ½</li>
                <li><strong>ä¿å®ˆæ€§:</strong> å…±é€šãƒ­ã‚¸ãƒƒã‚¯ã‚’å†åˆ©ç”¨ã—ã€ä¿å®ˆãŒå®¹æ˜“</li>
                <li><strong>æ‹¡å¼µæ€§:</strong> å°†æ¥çš„ãªæ©Ÿèƒ½è¿½åŠ ã«å¯¾å¿œã—ã‚„ã™ã„</li>
            </ul>

            <p style="margin-top: 20px;"><strong>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:</strong></p>
            <ol>
                <li>Phase 1ï¼ˆé€€è·åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ï¼‰ã®å®Ÿè£…</li>
                <li>Phase 3ï¼ˆé€€è·è€…è¡¨ç¤ºï¼‰ã®å®Ÿè£…</li>
                <li>Phase 2ï¼ˆé€€è·å‡¦ç†UIï¼‰ã®å®Ÿè£…</li>
            </ol>
        </div>
    </div>
</body>
</html>