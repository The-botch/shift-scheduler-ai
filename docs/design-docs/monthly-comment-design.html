<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚¹ã‚¿ãƒƒãƒ•æœˆæ¬¡æå‡ºæ©Ÿèƒ½ è¨­è¨ˆæ›¸</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Hiragino Sans', sans-serif;
      background: #f8f9fa;
      color: #333;
      line-height: 1.7;
      padding: 40px 20px;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
    }
    h1 {
      color: #2196f3;
      font-size: 1.8rem;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 3px solid #2196f3;
    }
    .meta {
      color: #666;
      font-size: 0.9rem;
      margin-bottom: 30px;
    }
    h2 {
      color: #333;
      font-size: 1.4rem;
      margin-top: 40px;
      margin-bottom: 15px;
      padding-left: 10px;
      border-left: 4px solid #2196f3;
    }
    h3 {
      color: #555;
      font-size: 1.1rem;
      margin-top: 25px;
      margin-bottom: 10px;
    }
    p {
      margin-bottom: 15px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
      font-size: 0.9rem;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px 12px;
      text-align: left;
    }
    th {
      background: #f0f0f0;
      font-weight: bold;
    }
    tr:nth-child(even) {
      background: #fafafa;
    }
    code {
      background: #f4f4f4;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
    }
    pre {
      background: #2d2d2d;
      color: #f8f8f2;
      padding: 15px;
      border-radius: 8px;
      overflow-x: auto;
      margin: 15px 0;
      font-size: 0.85rem;
    }
    .card {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    .badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: bold;
    }
    .badge-new {
      background: #ff6b6b;
      color: white;
    }
    .badge-modify {
      background: #ffa726;
      color: white;
    }
    ul {
      margin: 10px 0 15px 20px;
    }
    li {
      margin-bottom: 5px;
    }
    .usecase {
      background: #e3f2fd;
      border: 1px solid #90caf9;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    .usecase h3 {
      color: #1565c0;
      margin-top: 0;
    }
    .impact-section {
      background: #fff8e1;
      border: 2px solid #ffb300;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    .impact-section h3 {
      color: #ff8f00;
      margin-top: 0;
    }
    .file-tree {
      background: #263238;
      color: #aed581;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 0.85rem;
      margin: 15px 0;
    }
    .file-tree .new {
      color: #ff6b6b;
    }
    .file-tree .modify {
      color: #ffa726;
    }
    .file-tree .existing {
      color: #aed581;
    }
    .flow-diagram {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      margin: 15px 0;
    }
    .flow-step {
      display: inline-block;
      background: #e3f2fd;
      border: 1px solid #90caf9;
      border-radius: 4px;
      padding: 8px 15px;
      margin: 5px;
    }
    .flow-arrow {
      display: inline-block;
      color: #666;
      margin: 0 5px;
    }
    .mockup {
      background: #fff;
      border: 2px solid #ddd;
      border-radius: 12px;
      padding: 20px;
      margin: 15px 0;
      max-width: 350px;
    }
    .mockup-header {
      background: #06c755;
      color: white;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 15px;
      text-align: center;
      font-weight: bold;
    }
    .mockup-textarea {
      width: 100%;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      min-height: 80px;
      font-size: 0.9rem;
      resize: none;
    }
    .mockup-label {
      font-size: 0.85rem;
      color: #666;
      margin-bottom: 5px;
    }
    .mockup-hint {
      font-size: 0.75rem;
      color: #999;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ã‚¹ã‚¿ãƒƒãƒ•æœˆæ¬¡æå‡ºæ©Ÿèƒ½ è¨­è¨ˆæ›¸</h1>
    <div class="meta">
      ä½œæˆæ—¥: 2025-12-03 | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ãƒ‰ãƒ©ãƒ•ãƒˆ
    </div>

    <!-- æ¦‚è¦ -->
    <h2>1. æ¦‚è¦</h2>
    <p>
      ã‚¹ã‚¿ãƒƒãƒ•ãŒLIFFç”»é¢ã‹ã‚‰æœˆã”ã¨ã«ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆå‚™è€ƒãƒ»é€£çµ¡äº‹é …ï¼‰ã‚’å…¥åŠ›ã§ãã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹ã€‚
      å…¥åŠ›ã•ã‚ŒãŸã‚³ãƒ¡ãƒ³ãƒˆã¯ã‚ªãƒ¼ãƒŠãƒ¼/ç®¡ç†è€…ãŒã‚·ãƒ•ãƒˆä½œæˆæ™‚ã«å‚è€ƒã«ã§ãã‚‹ã€‚
    </p>

    <!-- ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ -->
    <div class="usecase">
      <h3>ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ä¾‹</h3>
      <ul>
        <li>ã€Œæ¥æœˆã¯è³‡æ ¼è©¦é¨“ãŒã‚ã‚‹ãŸã‚ã€åœŸæ—¥ã¯å‡ºå‹¤ã§ãã¾ã›ã‚“ã€</li>
        <li>ã€Œ12æœˆã¯å¸°çœã™ã‚‹ã®ã§ã€å¹´æœ«å¹´å§‹ã¯ä¼‘ã¿å¸Œæœ›ã§ã™ã€</li>
        <li>ã€Œä»Šæœˆã‹ã‚‰é€±3æ—¥å‹¤å‹™ã«å¤‰æ›´ã—ãŸã„ã§ã™ã€</li>
        <li>ã€Œã€‡ã€‡åº—èˆ—ã®ãƒ˜ãƒ«ãƒ—ã‚‚å¯èƒ½ã§ã™ã€</li>
      </ul>
    </div>

    <!-- æ±ºå®šäº‹é … -->
    <h2>2. æ±ºå®šäº‹é …</h2>

    <div class="card">
      <h3 style="color: #4caf50; margin-bottom: 15px;">æ±ºå®šæ¸ˆã¿ä»•æ§˜</h3>
      <table>
        <tr>
          <th style="width: 200px;">é …ç›®</th>
          <th>æ±ºå®šå†…å®¹</th>
        </tr>
        <tr>
          <td><strong>Q1: ã‚³ãƒ¡ãƒ³ãƒˆã®ç²’åº¦</strong></td>
          <td><span class="badge badge-new">æ¡ˆA: æœˆå˜ä½ã®ã¿</span><br>ã‚·ãƒ³ãƒ—ãƒ«ã«1ãƒ†ãƒ¼ãƒ–ãƒ«ã§å®Œçµ</td>
        </tr>
        <tr>
          <td><strong>Q2: æ–‡å­—æ•°åˆ¶é™</strong></td>
          <td><strong>500æ–‡å­—</strong></td>
        </tr>
        <tr>
          <td><strong>Q3: é–²è¦§æ¨©é™</strong></td>
          <td>ä¸€æ—¦è€ƒæ…®ã—ãªã„ï¼ˆshift-scheduler-aiå´ã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§é–²è¦§å¯èƒ½ï¼‰</td>
        </tr>
        <tr>
          <td><strong>Q4: ç®¡ç†ç”»é¢ã§ã®è¡¨ç¤º</strong></td>
          <td>
            <strong>ã‚·ãƒ•ãƒˆè¡¨ã«ãƒ›ãƒãƒ¼è¡¨ç¤º</strong><br>
            ã‚¹ã‚¿ãƒƒãƒ•åã®ä¸Šã«ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¤ã‚³ãƒ³ã‚’è¡¨ç¤ºã—ã€ã‚¯ãƒªãƒƒã‚¯ã§å†…å®¹è¡¨ç¤º
          </td>
        </tr>
      </table>
    </div>

    <!-- æ©Ÿèƒ½è¦ä»¶ -->
    <h2>3. æ©Ÿèƒ½è¦ä»¶</h2>

    <h3>3.1 LIFFå´ï¼ˆã‚¹ã‚¿ãƒƒãƒ•å‘ã‘ï¼‰</h3>
    <table>
      <tr>
        <th>æ©Ÿèƒ½</th>
        <th>èª¬æ˜</th>
      </tr>
      <tr>
        <td>ã‚³ãƒ¡ãƒ³ãƒˆå…¥åŠ›</td>
        <td>é¸æŠã—ãŸæœˆã«å¯¾ã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›ã§ãã‚‹</td>
      </tr>
      <tr>
        <td>ã‚³ãƒ¡ãƒ³ãƒˆè¡¨ç¤º</td>
        <td>æ—¢ã«å…¥åŠ›æ¸ˆã¿ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¡¨ç¤º</td>
      </tr>
      <tr>
        <td>ã‚³ãƒ¡ãƒ³ãƒˆç·¨é›†</td>
        <td>å…¥åŠ›æ¸ˆã¿ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç·¨é›†ã§ãã‚‹</td>
      </tr>
      <tr>
        <td>ã‚³ãƒ¡ãƒ³ãƒˆå‰Šé™¤</td>
        <td>å…¥åŠ›æ¸ˆã¿ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’å‰Šé™¤ã§ãã‚‹ï¼ˆç©ºã«ã™ã‚‹ï¼‰</td>
      </tr>
    </table>

    <h3>3.2 ç®¡ç†ç”»é¢å´ï¼ˆã‚ªãƒ¼ãƒŠãƒ¼å‘ã‘ï¼‰</h3>
    <table>
      <tr>
        <th>æ©Ÿèƒ½</th>
        <th>èª¬æ˜</th>
      </tr>
      <tr>
        <td>ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§è¡¨ç¤º</td>
        <td>æŒ‡å®šæœˆã®ã‚¹ã‚¿ãƒƒãƒ•ã‚³ãƒ¡ãƒ³ãƒˆã‚’ä¸€è¦§è¡¨ç¤º</td>
      </tr>
      <tr>
        <td>ã‚³ãƒ¡ãƒ³ãƒˆãƒ•ã‚£ãƒ«ã‚¿</td>
        <td>åº—èˆ—ãƒ»æœˆã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°</td>
      </tr>
    </table>

    <!-- UIãƒ¢ãƒƒã‚¯ã‚¢ãƒƒãƒ— -->
    <h2>4. UIãƒ¢ãƒƒã‚¯ã‚¢ãƒƒãƒ—</h2>

    <h3>4.1 LIFFç”»é¢ï¼ˆã‚¹ã‚¿ãƒƒãƒ•å…¥åŠ›ï¼‰</h3>
    <div class="mockup">
      <div class="mockup-header">12æœˆã®ã‚·ãƒ•ãƒˆå¸Œæœ›å…¥åŠ›</div>
      <div class="mockup-label">ã‚³ãƒ¡ãƒ³ãƒˆãƒ»é€£çµ¡äº‹é …ï¼ˆä»»æ„ï¼‰</div>
      <textarea class="mockup-textarea" placeholder="ã‚·ãƒ•ãƒˆã«é–¢ã™ã‚‹è£œè¶³ã‚„é€£çµ¡äº‹é …ãŒã‚ã‚Œã°å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
      <div class="mockup-hint">â€» 500æ–‡å­—ã¾ã§å…¥åŠ›ã§ãã¾ã™</div>
    </div>

    <p>ã‚·ãƒ•ãƒˆå¸Œæœ›å…¥åŠ›ç”»é¢ã®ä¸‹éƒ¨ã«ã€ã‚³ãƒ¡ãƒ³ãƒˆå…¥åŠ›ã‚¨ãƒªã‚¢ã‚’è¿½åŠ ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã€‚</p>

    <h3>4.2 ç®¡ç†ç”»é¢ï¼ˆã‚ªãƒ¼ãƒŠãƒ¼é–²è¦§ï¼‰</h3>
    <div class="card" style="background: #f5f5f5;">
      <p><strong>ã‚·ãƒ•ãƒˆè¡¨ã®ã‚¹ã‚¿ãƒƒãƒ•åè¡¨ç¤ºéƒ¨åˆ†ï¼š</strong></p>
      <div style="display: flex; align-items: center; gap: 10px; margin: 15px 0; padding: 10px; background: white; border-radius: 4px;">
        <span style="background: #e3f2fd; padding: 5px 10px; border-radius: 4px; font-size: 0.9rem;">
          <span style="color: #1976d2; cursor: pointer;" title="ã‚³ãƒ¡ãƒ³ãƒˆã‚ã‚Š">ğŸ’¬</span>
          æ¾æœ¬ä½³å¥ˆ
        </span>
        <span style="color: #666; font-size: 0.8rem;">â† ã‚³ãƒ¡ãƒ³ãƒˆãŒã‚ã‚‹ã‚¹ã‚¿ãƒƒãƒ•ã«ã¯ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º</span>
      </div>
      <p><strong>ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ãƒãƒƒãƒ—ã‚ªãƒ¼ãƒãƒ¼/ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼š</strong></p>
      <div style="background: white; border: 1px solid #ddd; border-radius: 8px; padding: 15px; max-width: 300px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
        <div style="font-weight: bold; margin-bottom: 10px; color: #333;">
          ğŸ’¬ æ¾æœ¬ä½³å¥ˆã•ã‚“ã®ã‚³ãƒ¡ãƒ³ãƒˆ
          <span style="font-size: 0.75rem; color: #999; font-weight: normal;">ï¼ˆ2025å¹´12æœˆï¼‰</span>
        </div>
        <div style="font-size: 0.9rem; color: #555; line-height: 1.5;">
          å¹´æœ«ã¯å¸°çœã™ã‚‹ãŸã‚ã€12/28ã€œ1/3ã¯å‡ºå‹¤ã§ãã¾ã›ã‚“ã€‚<br>
          ãã‚Œä»¥å¤–ã®æ—¥ç¨‹ã¯èª¿æ•´å¯èƒ½ã§ã™ã€‚
        </div>
        <div style="font-size: 0.75rem; color: #999; margin-top: 10px; text-align: right;">
          æ›´æ–°: 2025/11/25 14:30
        </div>
      </div>
    </div>

    <!-- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ -->
    <h2>5. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ</h2>

    <h3>5.1 ã‚«ãƒ©ãƒ å®šç¾©</h3>
    <table>
      <tr>
        <th>ã‚«ãƒ©ãƒ å</th>
        <th>å‹</th>
        <th>NULL</th>
        <th>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ</th>
        <th>èª¬æ˜</th>
      </tr>
      <tr>
        <td><code>submission_id</code></td>
        <td>SERIAL</td>
        <td>NO</td>
        <td>-</td>
        <td>PRIMARY KEY</td>
      </tr>
      <tr>
        <td><code>tenant_id</code></td>
        <td>INTEGER</td>
        <td>NO</td>
        <td>-</td>
        <td>ãƒ†ãƒŠãƒ³ãƒˆID (FK: core.tenants)</td>
      </tr>
      <tr>
        <td><code>staff_id</code></td>
        <td>INTEGER</td>
        <td>NO</td>
        <td>-</td>
        <td>ã‚¹ã‚¿ãƒƒãƒ•ID (FK: hr.staff)</td>
      </tr>
      <tr>
        <td><code>year</code></td>
        <td>INTEGER</td>
        <td>NO</td>
        <td>-</td>
        <td>å¯¾è±¡å¹´ï¼ˆä¾‹: 2025ï¼‰<br><span style="color:#666; font-size:0.85em;">â€» ops.shift_plansã®plan_yearã¨åŒæ§˜</span></td>
      </tr>
      <tr>
        <td><code>month</code></td>
        <td>INTEGER</td>
        <td>NO</td>
        <td>-</td>
        <td>å¯¾è±¡æœˆï¼ˆ1-12ï¼‰<br><span style="color:#666; font-size:0.85em;">â€» ops.shift_plansã®plan_monthã¨åŒæ§˜</span></td>
      </tr>
      <tr>
        <td><code>comment</code></td>
        <td>VARCHAR(500)</td>
        <td>YES</td>
        <td>NULL</td>
        <td>ã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡ï¼ˆæœ€å¤§500æ–‡å­—ï¼‰</td>
      </tr>
      <tr>
        <td><code>submission_status</code></td>
        <td>VARCHAR(20)</td>
        <td>YES</td>
        <td>NULL</td>
        <td>ã‚·ãƒ•ãƒˆæå‡ºã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆå°†æ¥ç”¨ï¼‰<br><span style="color:#666; font-size:0.85em;">â€» ä¾‹: 'NOT_SUBMITTED', 'SUBMITTED', 'CONFIRMED'</span></td>
      </tr>
      <tr>
        <td><code>created_at</code></td>
        <td>TIMESTAMP</td>
        <td>NO</td>
        <td>CURRENT_TIMESTAMP</td>
        <td>ä½œæˆæ—¥æ™‚</td>
      </tr>
      <tr>
        <td><code>updated_at</code></td>
        <td>TIMESTAMP</td>
        <td>NO</td>
        <td>CURRENT_TIMESTAMP</td>
        <td>æ›´æ–°æ—¥æ™‚ï¼ˆãƒˆãƒªã‚¬ãƒ¼ã§è‡ªå‹•æ›´æ–°ï¼‰</td>
      </tr>
    </table>

    <div class="card" style="background: #e8f5e9; border: 1px solid #a5d6a7;">
      <h4 style="color: #2e7d32; margin: 0 0 10px 0;">è¨­è¨ˆãƒã‚¤ãƒ³ãƒˆ</h4>
      <ul style="margin: 0; padding-left: 20px;">
        <li><code>year</code> + <code>month</code> ã§ <code>ops.shift_plans</code> ã¨åŒã˜å½¢å¼ã«çµ±ä¸€</li>
        <li><code>submission_status</code> ã‚’è¿½åŠ ï¼ˆå°†æ¥ã®ã‚·ãƒ•ãƒˆæå‡ºç®¡ç†ç”¨ã€åˆæœŸã¯NULLï¼‰</li>
      </ul>
    </div>

    <h3>5.2 DDLï¼ˆæ—¢å­˜ãƒ«ãƒ¼ãƒ«æº–æ‹ ï¼‰</h3>
    <pre>
-- ============================================
-- ops.staff_monthly_submissionsï¼ˆã‚¹ã‚¿ãƒƒãƒ•æœˆæ¬¡æå‡ºï¼‰
-- è¿½åŠ å…ˆ: scripts/database/ddl/schema.sql ã® PART 5 ã«è¿½è¨˜
-- ============================================

-- ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
CREATE TABLE IF NOT EXISTS ops.staff_monthly_submissions (
    submission_id SERIAL PRIMARY KEY,
    tenant_id INTEGER NOT NULL,
    staff_id INTEGER NOT NULL,
    year INTEGER NOT NULL,                   -- å¯¾è±¡å¹´ï¼ˆä¾‹: 2025ï¼‰
    month INTEGER NOT NULL CHECK (month BETWEEN 1 AND 12),  -- å¯¾è±¡æœˆï¼ˆ1-12ï¼‰
    comment VARCHAR(500),                    -- ã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡ï¼ˆæœ€å¤§500æ–‡å­—ï¼‰
    submission_status VARCHAR(20),           -- ã‚·ãƒ•ãƒˆæå‡ºã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆå°†æ¥ç”¨ã€åˆæœŸNULLï¼‰
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    -- åˆ¶ç´„
    CONSTRAINT uq_staff_monthly_submissions_staff_period
        UNIQUE (tenant_id, staff_id, year, month),
    CONSTRAINT fk_staff_monthly_submissions_tenant
        FOREIGN KEY (tenant_id) REFERENCES core.tenants(tenant_id) ON DELETE CASCADE,
    CONSTRAINT fk_staff_monthly_submissions_staff
        FOREIGN KEY (staff_id) REFERENCES hr.staff(staff_id) ON DELETE CASCADE
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX IF NOT EXISTS idx_staff_monthly_submissions_tenant
    ON ops.staff_monthly_submissions(tenant_id);
CREATE INDEX IF NOT EXISTS idx_staff_monthly_submissions_staff
    ON ops.staff_monthly_submissions(staff_id);
CREATE INDEX IF NOT EXISTS idx_staff_monthly_submissions_period
    ON ops.staff_monthly_submissions(year, month);

-- ã‚³ãƒ¡ãƒ³ãƒˆ
COMMENT ON TABLE ops.staff_monthly_submissions IS 'ã‚¹ã‚¿ãƒƒãƒ•æœˆæ¬¡æå‡ºãƒ»ã‚³ãƒ¡ãƒ³ãƒˆç®¡ç†ï¼ˆLIFFã‹ã‚‰å…¥åŠ›ï¼‰';
COMMENT ON COLUMN ops.staff_monthly_submissions.submission_id IS 'æå‡ºIDï¼ˆPKï¼‰';
COMMENT ON COLUMN ops.staff_monthly_submissions.tenant_id IS 'ãƒ†ãƒŠãƒ³ãƒˆID';
COMMENT ON COLUMN ops.staff_monthly_submissions.staff_id IS 'ã‚¹ã‚¿ãƒƒãƒ•ID';
COMMENT ON COLUMN ops.staff_monthly_submissions.year IS 'å¯¾è±¡å¹´';
COMMENT ON COLUMN ops.staff_monthly_submissions.month IS 'å¯¾è±¡æœˆï¼ˆ1-12ï¼‰';
COMMENT ON COLUMN ops.staff_monthly_submissions.comment IS 'ã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡ï¼ˆæœ€å¤§500æ–‡å­—ï¼‰';
COMMENT ON COLUMN ops.staff_monthly_submissions.submission_status IS 'ã‚·ãƒ•ãƒˆæå‡ºã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆå°†æ¥ç”¨: NOT_SUBMITTED/SUBMITTED/CONFIRMEDï¼‰';

-- ãƒˆãƒªã‚¬ãƒ¼ï¼ˆupdated_atè‡ªå‹•æ›´æ–°ï¼‰
CREATE TRIGGER trg_staff_monthly_submissions_updated_at
    BEFORE UPDATE ON ops.staff_monthly_submissions
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();</pre>

    <h3>5.3 ã‚¹ã‚­ãƒ¼ãƒé¸å®šç†ç”±</h3>
    <table>
      <tr>
        <th>ã‚¹ã‚­ãƒ¼ãƒ</th>
        <th>ç†ç”±</th>
      </tr>
      <tr>
        <td><code>ops</code></td>
        <td>ã‚·ãƒ•ãƒˆé‹ç”¨ã«é–¢é€£ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã€‚shifts, shift_preferences, shift_plansã¨åŒã˜ã‚¹ã‚­ãƒ¼ãƒã€‚</td>
      </tr>
    </table>

    <!-- å½±éŸ¿ç¯„å›² -->
    <h2>6. å½±éŸ¿ç¯„å›²</h2>

    <div class="impact-section">
      <h3>å„ã‚·ã‚¹ãƒ†ãƒ ã¸ã®å½±éŸ¿</h3>
      <table>
        <tr>
          <th>ã‚·ã‚¹ãƒ†ãƒ </th>
          <th>ç¨®é¡</th>
          <th>ä½œæ¥­å†…å®¹</th>
        </tr>
        <tr>
          <td><strong>shift-scheduler-ai</strong><br>DB</td>
          <td><span class="badge badge-new">æ–°è¦</span></td>
          <td>ops.staff_monthly_submissions ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ</td>
        </tr>
        <tr>
          <td><strong>shift-scheduler-ai</strong><br>backend</td>
          <td><span class="badge badge-new">æ–°è¦</span></td>
          <td>æå‡º/ã‚³ãƒ¡ãƒ³ãƒˆ CRUD APIè¿½åŠ </td>
        </tr>
        <tr>
          <td><strong>shift-scheduler-ai</strong><br>frontend</td>
          <td><span class="badge badge-modify">ä¿®æ­£</span></td>
          <td>ã‚·ãƒ•ãƒˆç®¡ç†ç”»é¢ã«ã‚³ãƒ¡ãƒ³ãƒˆè¡¨ç¤ºè¿½åŠ </td>
        </tr>
        <tr>
          <td><strong>shift-scheduler-ai-liff</strong><br>backend</td>
          <td><span class="badge badge-new">æ–°è¦</span></td>
          <td>ã‚³ãƒ¡ãƒ³ãƒˆç™»éŒ²/å–å¾—APIè¿½åŠ </td>
        </tr>
        <tr>
          <td><strong>shift-scheduler-ai-liff</strong><br>frontend</td>
          <td><span class="badge badge-modify">ä¿®æ­£</span></td>
          <td>ã‚³ãƒ¡ãƒ³ãƒˆå…¥åŠ›UIã‚’è¿½åŠ </td>
        </tr>
      </table>
    </div>

    <!-- ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ -->
    <h2>7. æ–°è¦ä½œæˆãƒ»ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«</h2>

    <h3>7.1 shift-scheduler-aiï¼ˆæœ¬ä½“ï¼‰</h3>
    <div class="file-tree">
<span class="existing">shift-scheduler-ai/</span>
<span class="existing">â”œâ”€â”€ scripts/database/</span>
<span class="existing">â”‚   â”œâ”€â”€ ddl/</span>
<span class="new">â”‚   â”‚   â””â”€â”€ staff_monthly_submissions.sql  # ã€æ–°è¦ã€‘ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©</span>
<span class="existing">â”œâ”€â”€ backend/src/</span>
<span class="existing">â”‚   â””â”€â”€ routes/</span>
<span class="new">â”‚       â””â”€â”€ staffSubmissions.js             # ã€æ–°è¦ã€‘æå‡ºAPI</span>
<span class="existing">â””â”€â”€ frontend/src/</span>
<span class="modify">    â””â”€â”€ components/ShiftTable.jsx           # ã€ä¿®æ­£ã€‘ã‚³ãƒ¡ãƒ³ãƒˆè¡¨ç¤ºè¿½åŠ </span>
    </div>

    <h3>7.2 shift-scheduler-ai-liff</h3>
    <div class="file-tree">
<span class="existing">shift-scheduler-ai-liff/</span>
<span class="existing">â”œâ”€â”€ backend/src/</span>
<span class="existing">â”‚   â””â”€â”€ routes/</span>
<span class="new">â”‚       â””â”€â”€ submission.js                   # ã€æ–°è¦ã€‘æå‡ºAPI</span>
<span class="modify">â””â”€â”€ index.html                              # ã€ä¿®æ­£ã€‘ã‚³ãƒ¡ãƒ³ãƒˆå…¥åŠ›UIè¿½åŠ </span>
    </div>

    <!-- APIè¨­è¨ˆ -->
    <h2>8. APIè¨­è¨ˆ</h2>

    <h3>8.1 LIFF backend API</h3>
    <table>
      <tr>
        <th>ãƒ¡ã‚½ãƒƒãƒ‰</th>
        <th>ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ</th>
        <th>èª¬æ˜</th>
      </tr>
      <tr>
        <td>GET</td>
        <td><code>/api/liff/submission?year=2025&month=12</code></td>
        <td>æŒ‡å®šæœˆã®æå‡ºæƒ…å ±ã‚’å–å¾—</td>
      </tr>
      <tr>
        <td>POST</td>
        <td><code>/api/liff/submission</code></td>
        <td>æå‡ºæƒ…å ±ã‚’ç™»éŒ²/æ›´æ–°ï¼ˆUPSERTï¼‰</td>
      </tr>
    </table>

    <h3>8.2 ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹</h3>
    <pre>
// POST /api/liff/submission
// Request
{
  "year": 2025,
  "month": 12,
  "comment": "å¹´æœ«ã¯å¸°çœã™ã‚‹ãŸã‚ã€12/28-1/3ã¯å‡ºå‹¤ã§ãã¾ã›ã‚“ã€‚"
}

// Response
{
  "success": true,
  "data": {
    "submission_id": 123,
    "year": 2025,
    "month": 12,
    "comment": "å¹´æœ«ã¯å¸°çœã™ã‚‹ãŸã‚ã€12/28-1/3ã¯å‡ºå‹¤ã§ãã¾ã›ã‚“ã€‚",
    "submission_status": null,
    "updated_at": "2025-12-03T10:30:00Z"
  }
}</pre>

    <h3>8.3 ç®¡ç†ç”»é¢ APIï¼ˆshift-scheduler-aiï¼‰</h3>
    <table>
      <tr>
        <th>ãƒ¡ã‚½ãƒƒãƒ‰</th>
        <th>ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ</th>
        <th>èª¬æ˜</th>
      </tr>
      <tr>
        <td>GET</td>
        <td><code>/api/staff-submissions?store_id=1&year=2025&month=12</code></td>
        <td>æŒ‡å®šåº—èˆ—ãƒ»æœˆã®ã‚¹ã‚¿ãƒƒãƒ•æå‡ºä¸€è¦§ã‚’å–å¾—</td>
      </tr>
    </table>

    <!-- ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ -->
    <h2>9. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼</h2>

    <h3>9.1 ã‚³ãƒ¡ãƒ³ãƒˆç™»éŒ²ãƒ•ãƒ­ãƒ¼</h3>
    <div class="flow-diagram">
      <div class="flow-step">ã‚¹ã‚¿ãƒƒãƒ•ãŒ<br>ã‚³ãƒ¡ãƒ³ãƒˆå…¥åŠ›</div>
      <span class="flow-arrow">â†’</span>
      <div class="flow-step">LIFF frontend</div>
      <span class="flow-arrow">â†’</span>
      <div class="flow-step">LIFF backend<br>/api/liff/submission</div>
      <span class="flow-arrow">â†’</span>
      <div class="flow-step">DB<br>ops.staff_monthly_submissions</div>
    </div>

    <h3>9.2 ã‚³ãƒ¡ãƒ³ãƒˆé–²è¦§ãƒ•ãƒ­ãƒ¼ï¼ˆç®¡ç†ç”»é¢ï¼‰</h3>
    <div class="flow-diagram">
      <div class="flow-step">ã‚ªãƒ¼ãƒŠãƒ¼ãŒ<br>ã‚·ãƒ•ãƒˆè¡¨ã‚’é–‹ã</div>
      <span class="flow-arrow">â†’</span>
      <div class="flow-step">ç®¡ç†ç”»é¢ frontend</div>
      <span class="flow-arrow">â†’</span>
      <div class="flow-step">shift-scheduler-ai<br>backend API</div>
      <span class="flow-arrow">â†’</span>
      <div class="flow-step">DB</div>
    </div>

    <!-- å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ— -->
    <h2>10. å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—</h2>
    <table>
      <tr>
        <th>Step</th>
        <th>å†…å®¹</th>
        <th>å¯¾è±¡</th>
        <th>çŠ¶æ…‹</th>
      </tr>
      <tr>
        <td>1</td>
        <td>ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆï¼ˆDDLï¼‰</td>
        <td>shift-scheduler-ai DB</td>
        <td><span class="badge badge-new">å¯¾è±¡</span></td>
      </tr>
      <tr>
        <td>2</td>
        <td>LIFF backend APIå®Ÿè£…</td>
        <td>shift-scheduler-ai-liff</td>
        <td><span class="badge badge-new">å¯¾è±¡</span></td>
      </tr>
      <tr>
        <td>3</td>
        <td>ç®¡ç†ç”»é¢ APIå®Ÿè£…</td>
        <td>shift-scheduler-ai</td>
        <td><span class="badge badge-new">å¯¾è±¡</span></td>
      </tr>
      <tr>
        <td>4</td>
        <td>LIFF frontend UIè¿½åŠ </td>
        <td>shift-scheduler-ai-liff</td>
        <td><span class="badge badge-new">å¯¾è±¡</span></td>
      </tr>
      <tr style="background: #f5f5f5; color: #999;">
        <td>5</td>
        <td>ç®¡ç†ç”»é¢ UIè¿½åŠ </td>
        <td>shift-scheduler-ai</td>
        <td><span style="background:#e0e0e0; color:#666; padding:3px 8px; border-radius:4px; font-size:0.8rem;">ã‚¹ã‚³ãƒ¼ãƒ—å¤–</span></td>
      </tr>
    </table>

    <!-- ä»Šå¾Œã®æ‹¡å¼µ -->
    <h2>11. ä»Šå¾Œã®æ‹¡å¼µï¼ˆå°†æ¥æ¤œè¨ï¼‰</h2>
    <ul>
      <li>æ—¥å˜ä½ã®ã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½</li>
      <li>ã‚³ãƒ¡ãƒ³ãƒˆã¸ã®è¿”ä¿¡æ©Ÿèƒ½ï¼ˆã‚ªãƒ¼ãƒŠãƒ¼ â†’ ã‚¹ã‚¿ãƒƒãƒ•ï¼‰</li>
      <li>ã‚³ãƒ¡ãƒ³ãƒˆé€šçŸ¥ï¼ˆæ–°è¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã‚ªãƒ¼ãƒŠãƒ¼ã«é€šçŸ¥ï¼‰</li>
      <li>ã‚³ãƒ¡ãƒ³ãƒˆå±¥æ­´ã®ä¿å­˜</li>
      <li>æå‡ºã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ´»ç”¨ï¼ˆæå‡ºå®Œäº†é€šçŸ¥ãªã©ï¼‰</li>
    </ul>

    <div class="card" style="margin-top: 40px; text-align: center; color: #666;">
      <p>End of Document</p>
    </div>
  </div>
</body>
</html>
