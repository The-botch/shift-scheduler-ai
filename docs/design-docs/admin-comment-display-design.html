<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¨­è¨ˆæ›¸: ç®¡ç†ç”»é¢ã‚³ãƒ¡ãƒ³ãƒˆè¡¨ç¤ºæ©Ÿèƒ½</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Hiragino Sans', sans-serif;
      background: #f5f7fa;
      color: #1a1a2e;
      line-height: 1.7;
      padding: 40px 20px;
    }
    .container { max-width: 1000px; margin: 0 auto; }
    h1 {
      font-size: 1.8rem;
      color: #2563eb;
      border-bottom: 3px solid #2563eb;
      padding-bottom: 10px;
      margin-bottom: 30px;
    }
    h2 {
      font-size: 1.3rem;
      color: #1e40af;
      margin: 30px 0 15px;
      padding-left: 10px;
      border-left: 4px solid #3b82f6;
    }
    h3 {
      font-size: 1.1rem;
      color: #374151;
      margin: 20px 0 10px;
    }
    .card {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      margin: 15px 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    .info-box {
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
    }
    .warning-box {
      background: #fef3c7;
      border: 1px solid #fcd34d;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }
    th, td {
      border: 1px solid #e5e7eb;
      padding: 10px 12px;
      text-align: left;
    }
    th { background: #f3f4f6; font-weight: 600; }
    code {
      background: #f1f5f9;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 0.9em;
    }
    pre {
      background: #1e293b;
      color: #e2e8f0;
      padding: 15px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 0.85rem;
      line-height: 1.5;
    }
    .screen-mock {
      background: #fff;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      padding: 20px;
      margin: 15px 0;
    }
    .mock-header {
      background: #3b82f6;
      color: #fff;
      padding: 10px 15px;
      border-radius: 6px 6px 0 0;
      margin: -20px -20px 15px;
      font-weight: 600;
    }
    .staff-name {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      background: #dbeafe;
      border-radius: 4px;
      font-size: 0.9rem;
    }
    .comment-icon {
      cursor: pointer;
      font-size: 0.8rem;
    }
    .tooltip {
      background: #1f2937;
      color: #fff;
      padding: 10px 12px;
      border-radius: 6px;
      font-size: 0.85rem;
      max-width: 300px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    .flow-diagram {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      padding: 15px;
      background: #f8fafc;
      border-radius: 8px;
    }
    .flow-box {
      background: #fff;
      border: 2px solid #3b82f6;
      border-radius: 8px;
      padding: 10px 15px;
      font-size: 0.9rem;
    }
    .flow-arrow { color: #6b7280; font-size: 1.2rem; }
    ul, ol { padding-left: 25px; margin: 10px 0; }
    li { margin: 5px 0; }
  </style>
</head>
<body>
  <div class="container">
    <h1>è¨­è¨ˆæ›¸: ç®¡ç†ç”»é¢ã‚³ãƒ¡ãƒ³ãƒˆè¡¨ç¤ºæ©Ÿèƒ½</h1>

    <div class="info-box">
      <strong>æ¦‚è¦:</strong> LIFFã‹ã‚‰å…¥åŠ›ã•ã‚ŒãŸã‚¹ã‚¿ãƒƒãƒ•æœˆæ¬¡ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç®¡ç†ç”»é¢ï¼ˆãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ãƒ»ç¬¬2æ¡ˆï¼‰ã§è¡¨ç¤ºã™ã‚‹æ©Ÿèƒ½
    </div>

    <h2>1. æ©Ÿèƒ½è¦ä»¶</h2>

    <div class="card">
      <h3>1.1 ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ç”»é¢</h3>
      <table>
        <tr>
          <th>é …ç›®</th>
          <th>å†…å®¹</th>
        </tr>
        <tr>
          <td>è¡¨ç¤ºå ´æ‰€</td>
          <td>ã‚¹ã‚¿ãƒƒãƒ•åã‚¯ãƒªãƒƒã‚¯æ™‚ã®å¸Œæœ›ã‚·ãƒ•ãƒˆãƒ›ãƒãƒ¼å†…</td>
        </tr>
        <tr>
          <td>è¡¨ç¤ºå½¢å¼</td>
          <td>ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ä¸‹éƒ¨ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚¨ãƒªã‚¢è¿½åŠ </td>
        </tr>
        <tr>
          <td>è¡¨ç¤ºæ¡ä»¶</td>
          <td>ã‚³ãƒ¡ãƒ³ãƒˆãŒã‚ã‚‹å ´åˆã®ã¿è¡¨ç¤º</td>
        </tr>
      </table>

      <h4>UIãƒ¢ãƒƒã‚¯ã‚¢ãƒƒãƒ—</h4>
      <div class="screen-mock">
        <div class="mock-header">ã‚¢ãƒ«ãƒã‚¤ãƒˆã‚‚ã‚Šã‚„STGã®å¸Œæœ›ã‚·ãƒ•ãƒˆ</div>
        <p style="color:#6b7280;font-size:0.9rem;">æå‡ºæ—¥æ™‚: 11/27 16:34</p>
        <div style="background:#f0fdf4;border:1px solid #86efac;padding:10px;margin:10px 0;border-radius:6px;">
          [ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºã‚¨ãƒªã‚¢]
        </div>
        <div style="background:#fef3c7;border:1px solid #fcd34d;padding:10px;border-radius:6px;">
          <strong>ğŸ’¬ ã‚³ãƒ¡ãƒ³ãƒˆ:</strong><br>
          åœŸæ—¥ã¯åˆå¾Œå‡ºå‹¤å¸Œæœ›ã§ã™ã€‚æ¥æœˆã¯è©¦é¨“æœŸé–“ã®ãŸã‚å°‘ãªã‚ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚
        </div>
      </div>
    </div>

    <div class="card">
      <h3>1.2 ç¬¬2æ¡ˆç”»é¢</h3>
      <table>
        <tr>
          <th>é …ç›®</th>
          <th>å†…å®¹</th>
        </tr>
        <tr>
          <td>è¡¨ç¤ºå ´æ‰€</td>
          <td>ã‚·ãƒ•ãƒˆè¡¨ãƒ˜ãƒƒãƒ€ãƒ¼ã®ã‚¹ã‚¿ãƒƒãƒ•åæ¨ª</td>
        </tr>
        <tr>
          <td>è¡¨ç¤ºå½¢å¼</td>
          <td>ğŸ’¬ã‚¢ã‚¤ã‚³ãƒ³ â†’ ã‚¯ãƒªãƒƒã‚¯ã§ãƒãƒƒãƒ—ã‚ªãƒ¼ãƒãƒ¼</td>
        </tr>
        <tr>
          <td>è¡¨ç¤ºæ¡ä»¶</td>
          <td>ã‚³ãƒ¡ãƒ³ãƒˆãŒã‚ã‚‹ã‚¹ã‚¿ãƒƒãƒ•ã®ã¿ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º</td>
        </tr>
      </table>

      <h4>UIãƒ¢ãƒƒã‚¯ã‚¢ãƒƒãƒ—</h4>
      <div class="screen-mock">
        <div style="display:flex;gap:20px;padding:10px;background:#f8fafc;border-radius:6px;">
          <div class="staff-name">
            æ¾æœ¬ä½³å¥ˆ<br><span style="font-size:0.75rem;color:#6b7280;">ã‚¢ãƒ«ãƒã‚¤ãƒˆ</span>
          </div>
          <div class="staff-name">
            å‰ç”°çŸ¥ä¸– <span class="comment-icon">ğŸ’¬</span><br>
            <span style="font-size:0.75rem;color:#6b7280;">ã‚¢ãƒ«ãƒã‚¤ãƒˆ</span>
          </div>
          <div class="staff-name">
            æ­¦æ ¹å¤ªä¸€<br><span style="font-size:0.75rem;color:#6b7280;">ç¤¾å“¡</span>
          </div>
        </div>
        <div style="margin-top:10px;">
          <strong>ğŸ’¬ã‚¯ãƒªãƒƒã‚¯æ™‚:</strong>
          <div class="tooltip" style="display:inline-block;margin-left:10px;">
            åœŸæ—¥ã¯åˆå¾Œå‡ºå‹¤å¸Œæœ›ã§ã™ã€‚
          </div>
        </div>
      </div>
    </div>

    <h2>2. APIè¨­è¨ˆ</h2>

    <div class="card">
      <h3>GET /api/shifts/monthly-comments</h3>

      <h4>ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</h4>
      <table>
        <tr>
          <th>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</th>
          <th>å‹</th>
          <th>å¿…é ˆ</th>
          <th>èª¬æ˜</th>
        </tr>
        <tr>
          <td>tenant_id</td>
          <td>integer</td>
          <td>â—‹</td>
          <td>ãƒ†ãƒŠãƒ³ãƒˆID</td>
        </tr>
        <tr>
          <td>year</td>
          <td>integer</td>
          <td>â—‹</td>
          <td>å¯¾è±¡å¹´</td>
        </tr>
        <tr>
          <td>month</td>
          <td>integer</td>
          <td>â—‹</td>
          <td>å¯¾è±¡æœˆï¼ˆ1-12ï¼‰</td>
        </tr>
        <tr>
          <td>store_id</td>
          <td>integer</td>
          <td></td>
          <td>åº—èˆ—IDï¼ˆæŒ‡å®šæ™‚ã¯è©²å½“åº—èˆ—ã®ã‚¹ã‚¿ãƒƒãƒ•ã®ã¿ï¼‰</td>
        </tr>
      </table>

      <h4>ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹</h4>
      <pre>{
  "success": true,
  "data": [
    {
      "staff_id": 15,
      "staff_name": "å‰ç”°çŸ¥ä¸–",
      "store_id": 1,
      "year": 2025,
      "month": 12,
      "comment": "åœŸæ—¥ã¯åˆå¾Œå‡ºå‹¤å¸Œæœ›ã§ã™ã€‚",
      "submission_status": null,
      "updated_at": "2025-12-01T10:30:00Z"
    },
    {
      "staff_id": 18,
      "staff_name": "ã‚°ã‚¨ãƒ³",
      "store_id": 1,
      "year": 2025,
      "month": 12,
      "comment": "12/20-25ã¯å¸°çœã®ãŸã‚å‡ºå‹¤ä¸å¯",
      "submission_status": null,
      "updated_at": "2025-12-02T14:15:00Z"
    }
  ],
  "count": 2
}</pre>
    </div>

    <h2>3. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼</h2>

    <div class="card">
      <h3>3.1 ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ç”»é¢</h3>
      <div class="flow-diagram">
        <div class="flow-box">Monitoring.jsx<br>ç”»é¢èª­ã¿è¾¼ã¿</div>
        <span class="flow-arrow">â†’</span>
        <div class="flow-box">ShiftRepository<br>.getMonthlyComments()</div>
        <span class="flow-arrow">â†’</span>
        <div class="flow-box">API<br>/monthly-comments</div>
        <span class="flow-arrow">â†’</span>
        <div class="flow-box">commentsMap<br>staff_id â†’ comment</div>
        <span class="flow-arrow">â†’</span>
        <div class="flow-box">ãƒ›ãƒãƒ¼å†…ã«<br>ã‚³ãƒ¡ãƒ³ãƒˆè¡¨ç¤º</div>
      </div>

      <h3>3.2 ç¬¬2æ¡ˆç”»é¢</h3>
      <div class="flow-diagram">
        <div class="flow-box">SecondPlanEditor.jsx<br>ç”»é¢èª­ã¿è¾¼ã¿</div>
        <span class="flow-arrow">â†’</span>
        <div class="flow-box">ShiftRepository<br>.getMonthlyComments()</div>
        <span class="flow-arrow">â†’</span>
        <div class="flow-box">commentsMap<br>propsæ¸¡ã—</div>
        <span class="flow-arrow">â†’</span>
        <div class="flow-box">MultiStoreShiftTable<br>ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º</div>
        <span class="flow-arrow">â†’</span>
        <div class="flow-box">ã‚¯ãƒªãƒƒã‚¯æ™‚<br>Popoverè¡¨ç¤º</div>
      </div>
    </div>

    <h2>4. ä¿®æ­£å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«</h2>

    <div class="card">
      <table>
        <tr>
          <th>å±¤</th>
          <th>ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹</th>
          <th>ä¿®æ­£å†…å®¹</th>
        </tr>
        <tr>
          <td>API</td>
          <td><code>backend/src/routes/shifts.js</code></td>
          <td>GET /monthly-comments ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¿½åŠ </td>
        </tr>
        <tr>
          <td>Repository</td>
          <td><code>frontend/src/infrastructure/repositories/ShiftRepository.js</code></td>
          <td>getMonthlyComments() ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ </td>
        </tr>
        <tr>
          <td>ç”»é¢</td>
          <td><code>frontend/src/components/screens/shift/Monitoring.jsx</code></td>
          <td>ã‚³ãƒ¡ãƒ³ãƒˆå–å¾—ãƒ»ãƒ›ãƒãƒ¼å†…è¡¨ç¤º</td>
        </tr>
        <tr>
          <td>ç”»é¢</td>
          <td><code>frontend/src/components/screens/shift/SecondPlanEditor.jsx</code></td>
          <td>ã‚³ãƒ¡ãƒ³ãƒˆå–å¾—ãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«ã«propsæ¸¡ã—</td>
        </tr>
        <tr>
          <td>ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ</td>
          <td><code>frontend/src/components/shared/MultiStoreShiftTable.jsx</code></td>
          <td>ã‚¹ã‚¿ãƒƒãƒ•åæ¨ªã«ã‚¢ã‚¤ã‚³ãƒ³ãƒ»Popoverè¿½åŠ </td>
        </tr>
      </table>
    </div>

    <h2>5. å®Ÿè£…è©³ç´°</h2>

    <div class="card">
      <h3>5.1 APIå®Ÿè£…ï¼ˆshifts.jsï¼‰</h3>
      <pre>/**
 * æœˆæ¬¡ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§å–å¾—
 * GET /api/shifts/monthly-comments?tenant_id=3&year=2025&month=12
 */
router.get('/monthly-comments', async (req, res) => {
  const { tenant_id, year, month, store_id } = req.query;

  let query = `
    SELECT
      sms.staff_id,
      s.name as staff_name,
      s.store_id,
      sms.year,
      sms.month,
      sms.comment,
      sms.submission_status,
      sms.updated_at
    FROM ops.staff_monthly_submissions sms
    JOIN hr.staff s ON sms.staff_id = s.staff_id
    WHERE sms.tenant_id = $1
      AND sms.year = $2
      AND sms.month = $3
      AND sms.comment IS NOT NULL
  `;

  const params = [tenant_id, year, month];

  if (store_id) {
    query += ` AND s.store_id = $4`;
    params.push(store_id);
  }

  const result = await pool.query(query, params);

  res.json({
    success: true,
    data: result.rows,
    count: result.rows.length
  });
});</pre>
    </div>

    <div class="card">
      <h3>5.2 ShiftRepository.js</h3>
      <pre>/**
 * æœˆæ¬¡ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§å–å¾—
 */
async getMonthlyComments({ tenantId, year, month, storeId }) {
  const params = new URLSearchParams({
    tenant_id: tenantId,
    year,
    month,
  });
  if (storeId) params.append('store_id', storeId);

  const response = await fetch(
    `${API_BASE}/api/shifts/monthly-comments?${params}`
  );
  return response.json();
}</pre>
    </div>

    <div class="card">
      <h3>5.3 ã‚³ãƒ¡ãƒ³ãƒˆMapç”Ÿæˆï¼ˆç”»é¢å´ï¼‰</h3>
      <pre>// ã‚³ãƒ¡ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’Mapã«å¤‰æ›ï¼ˆO(1)æ¤œç´¢ç”¨ï¼‰
const commentsMap = useMemo(() => {
  const map = new Map();
  monthlyComments.forEach(item => {
    map.set(item.staff_id, item.comment);
  });
  return map;
}, [monthlyComments]);</pre>
    </div>

    <div class="card">
      <h3>5.4 Popoverã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆç¬¬2æ¡ˆï¼‰</h3>
      <pre>// ã‚¹ã‚¿ãƒƒãƒ•åæ¨ªã®ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¤ã‚³ãƒ³
{commentsMap.has(staffId) && (
  &lt;Popover&gt;
    &lt;PopoverTrigger&gt;
      &lt;span className="cursor-pointer text-sm"&gt;ğŸ’¬&lt;/span&gt;
    &lt;/PopoverTrigger&gt;
    &lt;PopoverContent className="w-72 p-3"&gt;
      &lt;div className="text-sm"&gt;
        &lt;strong&gt;ã‚³ãƒ¡ãƒ³ãƒˆ:&lt;/strong&gt;
        &lt;p className="mt-1 text-gray-600"&gt;
          {commentsMap.get(staffId)}
        &lt;/p&gt;
      &lt;/div&gt;
    &lt;/PopoverContent&gt;
  &lt;/Popover&gt;
)}</pre>
    </div>

    <h2>6. å®Ÿè£…é †åº</h2>

    <div class="card">
      <ol>
        <li><strong>Step 1:</strong> APIè¿½åŠ ï¼ˆbackend/src/routes/shifts.jsï¼‰</li>
        <li><strong>Step 2:</strong> ShiftRepository.js ã«ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ </li>
        <li><strong>Step 3:</strong> Monitoring.jsx - ã‚³ãƒ¡ãƒ³ãƒˆå–å¾—ãƒ»ãƒ›ãƒãƒ¼å†…è¡¨ç¤º</li>
        <li><strong>Step 4:</strong> SecondPlanEditor.jsx - ã‚³ãƒ¡ãƒ³ãƒˆå–å¾—</li>
        <li><strong>Step 5:</strong> MultiStoreShiftTable.jsx - ã‚¢ã‚¤ã‚³ãƒ³ãƒ»Popoverè¿½åŠ </li>
        <li><strong>Step 6:</strong> å‹•ä½œç¢ºèªãƒ»ãƒ†ã‚¹ãƒˆ</li>
      </ol>
    </div>

    <h2>7. ãƒªã‚¹ã‚¯åˆ†æã¨å¯¾ç­–</h2>

    <div class="card">
      <h3>7.1 æ—¢å­˜æ©Ÿèƒ½ã¸ã®å½±éŸ¿</h3>
      <table>
        <tr>
          <th>ä¿®æ­£ç®‡æ‰€</th>
          <th>ãƒªã‚¹ã‚¯</th>
          <th>å½±éŸ¿åº¦</th>
          <th>å¯¾ç­–</th>
        </tr>
        <tr>
          <td>APIè¿½åŠ </td>
          <td>ãªã—</td>
          <td style="color:#16a34a;">ä½</td>
          <td>æ–°è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãŸã‚æ—¢å­˜ã«å½±éŸ¿ãªã—</td>
        </tr>
        <tr>
          <td>ShiftRepository.js</td>
          <td>ãªã—</td>
          <td style="color:#16a34a;">ä½</td>
          <td>æ–°è¦ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ ã®ã¿</td>
        </tr>
        <tr>
          <td>Monitoring.jsx</td>
          <td>ãƒ›ãƒãƒ¼è¡¨ç¤ºã®å¤‰æ›´</td>
          <td style="color:#16a34a;">ä½</td>
          <td>æ—¢å­˜ã®ãƒ›ãƒãƒ¼å†…ã«è¿½è¨˜ã®ã¿ã€æ¡ä»¶ä»˜ãè¡¨ç¤º</td>
        </tr>
        <tr>
          <td>SecondPlanEditor.jsx</td>
          <td>ãƒ‡ãƒ¼ã‚¿å–å¾—è¿½åŠ </td>
          <td style="color:#16a34a;">ä½</td>
          <td>æ—¢å­˜å‡¦ç†ã«ä¸¦è¡Œã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆå–å¾—</td>
        </tr>
        <tr>
          <td>MultiStoreShiftTable.jsx</td>
          <td>ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå´©ã‚Œ</td>
          <td style="color:#ea580c;">ä¸­</td>
          <td>ã‚¢ã‚¤ã‚³ãƒ³ã¯å°ã•ãã€ã‚³ãƒ¡ãƒ³ãƒˆã‚ã‚Šã®å ´åˆã®ã¿è¡¨ç¤º</td>
        </tr>
      </table>
    </div>

    <div class="card">
      <h3>7.2 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°</h3>
      <p>APIå¤±æ•—æ™‚ã‚‚æ—¢å­˜æ©Ÿèƒ½ã¯ç¶™ç¶šå‹•ä½œã•ã›ã‚‹</p>
      <pre>// ã‚³ãƒ¡ãƒ³ãƒˆå–å¾—ï¼ˆå¤±æ•—ã—ã¦ã‚‚æ—¢å­˜æ©Ÿèƒ½ã«å½±éŸ¿ãªã—ï¼‰
const [monthlyComments, setMonthlyComments] = useState([]);

const loadMonthlyComments = async () => {
  try {
    const result = await shiftRepository.getMonthlyComments({
      tenantId, year, month
    });
    if (result.success) {
      setMonthlyComments(result.data);
    }
  } catch (error) {
    console.error('æœˆæ¬¡ã‚³ãƒ¡ãƒ³ãƒˆå–å¾—å¤±æ•—:', error);
    // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ç©ºé…åˆ—ã®ã¾ã¾ â†’ ã‚³ãƒ¡ãƒ³ãƒˆéè¡¨ç¤ºã§ç¶™ç¶š
  }
};

// ã‚³ãƒ¡ãƒ³ãƒˆMapï¼ˆç©ºã§ã‚‚å‹•ä½œï¼‰
const commentsMap = useMemo(() => {
  const map = new Map();
  monthlyComments.forEach(item => {
    map.set(item.staff_id, item.comment);
  });
  return map;
}, [monthlyComments]);</pre>
    </div>

    <div class="card">
      <h3>7.3 è¡¨ç¤ºã®å®‰å…¨æ€§</h3>
      <pre>// ã‚³ãƒ¡ãƒ³ãƒˆãŒã‚ã‚‹å ´åˆã®ã¿ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤ºï¼ˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå½±éŸ¿æœ€å°åŒ–ï¼‰
{commentsMap.has(staffId) && (
  &lt;Popover&gt;
    &lt;PopoverTrigger asChild&gt;
      &lt;span className="ml-1 cursor-pointer text-xs opacity-70 hover:opacity-100"&gt;
        ğŸ’¬
      &lt;/span&gt;
    &lt;/PopoverTrigger&gt;
    &lt;PopoverContent className="w-72 p-3"&gt;
      &lt;p className="text-sm text-gray-600"&gt;
        {commentsMap.get(staffId)}
      &lt;/p&gt;
    &lt;/PopoverContent&gt;
  &lt;/Popover&gt;
)}</pre>
    </div>

    <h2>8. æ³¨æ„äº‹é …</h2>

    <div class="warning-box">
      <ul>
        <li>ã‚³ãƒ¡ãƒ³ãƒˆãŒnullã¾ãŸã¯ç©ºæ–‡å­—ã®ã‚¹ã‚¿ãƒƒãƒ•ã¯APIã§é™¤å¤–ã•ã‚Œã‚‹</li>
        <li>æœˆã‚’è·¨ã„ã å ´åˆã€ã‚³ãƒ¡ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã‚‚å†å–å¾—ãŒå¿…è¦ï¼ˆå¹´æœˆå¤‰æ›´æ™‚ã®useEffectå†…ã§å‘¼ã³å‡ºã—ï¼‰</li>
        <li>Popoverã¯shadcn/uiã®æ—¢å­˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨ï¼ˆè¦ã‚¤ãƒ³ãƒãƒ¼ãƒˆç¢ºèªï¼‰</li>
        <li>APIå¤±æ•—æ™‚ã¯ãƒ­ã‚°å‡ºåŠ›ã®ã¿ã€UIã«ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã—ãªã„ï¼ˆUXç¶­æŒï¼‰</li>
      </ul>
    </div>

    <div style="margin-top:40px;padding-top:20px;border-top:1px solid #e5e7eb;color:#6b7280;font-size:0.85rem;">
      <p>ä½œæˆæ—¥: 2025-12-03</p>
      <p>é–¢é€£: PR #182ï¼ˆã‚¹ã‚¿ãƒƒãƒ•æœˆæ¬¡æå‡ºæ©Ÿèƒ½ï¼‰</p>
    </div>
  </div>
</body>
</html>
