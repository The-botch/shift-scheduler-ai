<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>シフト表 色分けデザイン設計書</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        .color-sample {
            width: 60px;
            height: 40px;
            border-radius: 6px;
            display: inline-block;
            vertical-align: middle;
        }
        .section {
            margin-bottom: 3rem;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #e5e7eb;
        }
        th {
            background-color: #f9fafb;
            font-weight: 600;
        }
        .comparison-box {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .comparison-box h4 {
            margin-top: 0;
            color: #374151;
        }
        .issue {
            background-color: #fee2e2;
            padding: 4px 8px;
            border-radius: 4px;
            color: #991b1b;
            font-size: 0.875rem;
        }
        .improvement {
            background-color: #d1fae5;
            padding: 4px 8px;
            border-radius: 4px;
            color: #065f46;
            font-size: 0.875rem;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="max-w-6xl mx-auto p-8 bg-white shadow-lg my-8 rounded-lg">
        <!-- ヘッダー -->
        <header class="mb-8 pb-6 border-b-2 border-gray-200">
            <h1 class="text-4xl font-bold text-gray-900 mb-2">シフト表 色分けデザイン設計書</h1>
            <p class="text-gray-600">バージョン 4.1 | 作成日: 2025-01-16 | 更新日: 2025-01-19</p>
            <div class="mt-4 bg-yellow-50 border-l-4 border-yellow-500 p-4">
                <p class="text-sm font-semibold text-yellow-800">📌 v4.1 重要な修正</p>
                <p class="text-sm text-yellow-700 mt-1">staffMapにemployment_typeフィールドが必須。雇用形態別のロジックが正しく動作するために必要。</p>
            </div>
        </header>

        <!-- 1. 目的・背景 -->
        <section class="section">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 flex items-center">
                <span class="text-blue-600 mr-2">📋</span> 1. 目的・背景
            </h2>

            <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-4">
                <h3 class="text-xl font-semibold text-red-800 mb-3">現状の課題</h3>
                <ul class="list-disc list-inside space-y-2 text-gray-700">
                    <li>セルの緑色（希望日）とシフトカードの緑色（午前）が混同しやすい</li>
                    <li>セルの赤色（NG日）とシフトカードの赤色（希望不一致）が混同しやすい</li>
                    <li>時間帯情報と希望状態が同じ色レイヤーで表現され、優先度が不明確</li>
                    <li>ユーザーが「どの情報が重要か」を直感的に判断しにくい</li>
                    <li><strong>「通常日」という概念が不明確</strong> - 正社員の「希望外だが勤務可能」とアルバイトの「実質NG」が同じ扱い</li>
                </ul>
            </div>

            <div class="bg-green-50 border-l-4 border-green-500 p-4">
                <h3 class="text-xl font-semibold text-green-800 mb-3">改善の目的</h3>
                <ul class="list-disc list-inside space-y-2 text-gray-700">
                    <li><strong>情報の階層化:</strong> セル背景、シフトカード、補助情報を明確に分離</li>
                    <li><strong>視覚的な優先順位:</strong> 重要な情報（希望との整合性）を強調</li>
                    <li><strong>一貫性のある色の意味:</strong> 赤=警告、緑=良好、黄=注意といった直感的な色使い</li>
                    <li><strong>拡張性の確保:</strong> 将来的な機能追加に対応できる設計</li>
                </ul>
            </div>
        </section>

        <!-- 2. デザイン原則 -->
        <section class="section">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 flex items-center">
                <span class="text-blue-600 mr-2">🎨</span> 2. デザイン原則
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div class="bg-blue-50 p-6 rounded-lg border border-blue-200">
                    <h3 class="text-lg font-bold text-blue-900 mb-3">原則1: 情報の階層化</h3>
                    <div class="text-sm text-gray-700 space-y-2">
                        <div class="pl-4 border-l-2 border-blue-400">
                            <strong>レイヤー1</strong><br>
                            セル背景: スタッフの希望状態
                        </div>
                        <div class="pl-4 border-l-2 border-blue-400">
                            <strong>レイヤー2</strong><br>
                            シフトカード: 配置されたシフトの状態
                        </div>
                        <div class="pl-4 border-l-2 border-blue-400">
                            <strong>レイヤー3</strong><br>
                            アイコン/バッジ: 補助情報（時間帯など）
                        </div>
                    </div>
                </div>

                <div class="bg-purple-50 p-6 rounded-lg border border-purple-200">
                    <h3 class="text-lg font-bold text-purple-900 mb-3">原則2: 色の意味を統一</h3>
                    <div class="text-sm text-gray-700 space-y-2">
                        <div class="flex items-center gap-2">
                            <span class="text-2xl">🔴</span>
                            <span><strong>赤系:</strong> 警告・要注意</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-2xl">🟢</span>
                            <span><strong>緑系:</strong> 良好・推奨</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-2xl">🟡</span>
                            <span><strong>黄系:</strong> 注意喚起</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-2xl">⚪</span>
                            <span><strong>グレー系:</strong> 中立・通常</span>
                        </div>
                    </div>
                </div>

                <div class="bg-amber-50 p-6 rounded-lg border border-amber-200">
                    <h3 class="text-lg font-bold text-amber-900 mb-3">原則3: 濃淡で視覚的階層</h3>
                    <div class="text-sm text-gray-700 space-y-3">
                        <div>
                            <div class="font-semibold mb-1">セル背景色</div>
                            <div class="bg-green-50 h-6 rounded flex items-center px-2 text-xs">50番台（最も淡い）</div>
                        </div>
                        <div>
                            <div class="font-semibold mb-1">シフトカード本体</div>
                            <div class="bg-green-100 h-6 rounded flex items-center px-2 text-xs">100番台（やや濃い）</div>
                        </div>
                        <div>
                            <div class="font-semibold mb-1">枠線・アクセント</div>
                            <div class="bg-green-500 h-6 rounded flex items-center px-2 text-xs text-white">400-500番台（濃い）</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. 色分けルール仕様 -->
        <section class="section">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 flex items-center">
                <span class="text-blue-600 mr-2">🎯</span> 3. 色分けルール仕様
            </h2>

            <!-- 3.1 セル背景色 -->
            <h3 class="text-2xl font-semibold text-gray-700 mb-3">3.1 セル背景色（レイヤー1）</h3>
            <p class="text-gray-600 mb-4">スタッフの希望状態を表現</p>

            <table class="mb-6">
                <thead>
                    <tr>
                        <th>状態</th>
                        <th>色サンプル</th>
                        <th>Tailwind クラス</th>
                        <th>説明</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>✅ 希望日</td>
                        <td><div class="color-sample bg-green-50 border border-green-300"></div></td>
                        <td><code class="bg-gray-100 px-2 py-1 rounded">bg-green-50</code></td>
                        <td>スタッフが勤務を希望している日（積極的に勤務したい）</td>
                    </tr>
                    <tr>
                        <td>❌ NG日</td>
                        <td><div class="color-sample bg-gray-100 border border-gray-400"></div></td>
                        <td><code class="bg-gray-100 px-2 py-1 rounded">bg-gray-100</code></td>
                        <td>スタッフが勤務NGとした日（勤務不可）</td>
                    </tr>
                    <tr>
                        <td>⚪ 希望登録なし</td>
                        <td><div class="color-sample bg-white border border-gray-300"></div></td>
                        <td><code class="bg-gray-100 px-2 py-1 rounded">bg-white</code></td>
                        <td>希望登録のない日（正社員=勤務可能、アルバイト=実質NG）</td>
                    </tr>
                </tbody>
            </table>

            <div class="bg-blue-50 border border-blue-200 p-4 rounded-lg mb-6">
                <h4 class="font-semibold text-blue-900 mb-2">🤔 勤務可否のロジック</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                    <div>
                        <h5 class="font-semibold text-blue-800 mb-2">正社員の場合:</h5>
                        <ul class="space-y-1 text-gray-700">
                            <li>• <strong>希望日</strong>: 積極的に勤務したい</li>
                            <li>• <strong>NG日</strong>: 絶対に勤務できない</li>
                            <li>• <strong>その他</strong>: 希望していないが勤務できる</li>
                        </ul>
                    </div>
                    <div>
                        <h5 class="font-semibold text-blue-800 mb-2">アルバイトの場合:</h5>
                        <ul class="space-y-1 text-gray-700">
                            <li>• <strong>希望日</strong>: 勤務できる日（これだけ）</li>
                            <li>• <strong>希望日以外</strong>: すべて実質NG（勤務不可）</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- 3.2 シフトカード -->
            <h3 class="text-2xl font-semibold text-gray-700 mb-3">3.2 シフトカード（レイヤー2）</h3>
            <p class="text-gray-600 mb-4">配置されたシフトの適切性を表現</p>

            <h4 class="text-xl font-semibold text-gray-600 mb-3">A. 配置の適切性による色分け</h4>
            <table class="mb-6">
                <thead>
                    <tr>
                        <th>状態</th>
                        <th>色サンプル</th>
                        <th>Tailwind クラス</th>
                        <th>説明</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>🟢 問題なし</td>
                        <td><div class="color-sample bg-green-100 border border-green-400"></div></td>
                        <td><code class="bg-gray-100 px-2 py-1 rounded text-xs">bg-green-100</code></td>
                        <td>NG日以外に配置されたシフト（問題なし）</td>
                    </tr>
                    <tr>
                        <td>🔴 要修正</td>
                        <td><div class="color-sample bg-red-200 border border-red-500"></div></td>
                        <td><code class="bg-gray-100 px-2 py-1 rounded text-xs">bg-red-200</code></td>
                        <td>NG日への配置（要修正）</td>
                    </tr>
                </tbody>
            </table>

            <div class="bg-blue-50 border border-blue-300 p-4 rounded-lg mb-6">
                <h4 class="font-semibold text-blue-900 mb-2">💡 判定ロジック（雇用形態別）</h4>
                <pre class="bg-white p-3 rounded text-xs overflow-x-auto"><code>const getShiftCardColor = (date, staffId) => {
  const staff = staffMap[staffId]
  const employmentType = staff?.employment_type || ''
  const isNg = isNgDay(date, staffId)
  const isPreferred = isPreferredDay(date, staffId)

  // 【PART_TIMEの場合】アルバイト・パートは希望日のみ勤務可能
  if (employmentType === 'PART_TIME') {
    if (isPreferred) {
      // 希望日に配置 → 緑色（OK）
      return 'bg-green-100 border border-green-400'
    } else {
      // 希望日以外に配置 → 赤色（要修正）
      return 'bg-red-200 border border-red-500'
    }
  }

  // 【FULL_TIMEの場合】正社員はNG日以外なら勤務可能
  if (isNg) {
    // NG日に配置 → 赤色（要修正）
    return 'bg-red-200 border border-red-500'
  } else {
    // NG日以外に配置 → 緑色（OK）
    return 'bg-green-100 border border-green-400'
  }
}</code></pre>
                <p class="text-sm text-blue-800 mt-3"><strong>注:</strong> データベースの雇用形態は 'PART_TIME' または 'FULL_TIME' の値を使用します。</p>
            </div>

            <div class="bg-red-50 border border-red-300 p-4 rounded-lg mb-6">
                <h4 class="font-semibold text-red-900 mb-2">⚠️ 重要: データ要件</h4>
                <p class="text-sm text-red-800 mb-2">このロジックが正しく動作するには、<code class="bg-white px-2 py-1 rounded">staffMap</code>に以下のフィールドが必要です：</p>
                <pre class="bg-white p-3 rounded text-xs overflow-x-auto"><code>staffMap[staffId] = {
  name: staff.name,
  role_id: staff.role_id,
  role_name: rolesMapping[staff.role_id] || 'スタッフ',
  is_active: staff.is_active,
  store_id: staff.store_id,
  employment_type: staff.employment_type,  // 🔴 必須！
}</code></pre>
                <p class="text-sm text-red-800 mt-2">
                    <strong>バグ修正 (v4.1):</strong> <code class="bg-white px-1 rounded">useShiftEditorBase.js</code>でstaffMappingを作成する際、
                    <code class="bg-white px-1 rounded">employment_type</code>フィールドが欠落していました。
                    これにより雇用形態の判定ができず、全てのスタッフがFULL_TIMEのロジックで処理されていました。
                </p>
            </div>

            <h4 class="text-xl font-semibold text-gray-600 mb-3">B. 修正状態のマーキング</h4>
            <table class="mb-6">
                <thead>
                    <tr>
                        <th>状態</th>
                        <th>色サンプル</th>
                        <th>Tailwind クラス</th>
                        <th>説明</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>⚠️ 修正済み</td>
                        <td><div class="color-sample bg-green-100 border border-green-400 relative">
                            <span class="absolute top-0 right-0 text-xs bg-yellow-500 text-white rounded-full w-4 h-4 flex items-center justify-center">!</span>
                        </div></td>
                        <td><code class="bg-gray-100 px-2 py-1 rounded text-xs">右上に⚠️バッジ</code></td>
                        <td>手動で編集されたシフト（ベース色に追加）</td>
                    </tr>
                </tbody>
            </table>

            <div class="bg-blue-50 border border-blue-200 p-4 rounded-lg">
                <h4 class="font-semibold text-blue-900 mb-2">組み合わせ例:</h4>
                <ul class="space-y-2 text-sm text-gray-700">
                    <li>• 問題なし＋修正済み: <code class="bg-white px-2 py-1 rounded">bg-green-100</code> + 右上⚠️バッジ</li>
                    <li>• 要修正＋修正済み: <code class="bg-white px-2 py-1 rounded">bg-red-200</code> + 右上⚠️バッジ</li>
                </ul>
            </div>

            <!-- 3.3 時間帯情報 -->
            <h3 class="text-2xl font-semibold text-gray-700 mt-8 mb-3">3.3 時間帯情報（レイヤー3）</h3>
            <p class="text-gray-600 mb-4">シフトカード内に補助情報として表示</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="border border-gray-200 p-4 rounded-lg">
                    <h4 class="font-semibold mb-3">オプション1: アイコン表示（推奨）</h4>
                    <div class="space-y-2 text-sm">
                        <div class="flex items-center gap-2">
                            <span class="text-2xl">🌅</span>
                            <span>早朝 (開始 &lt; 9:00)</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-2xl">☀️</span>
                            <span>午前 (9:00 ≤ 開始 &lt; 12:00)</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-2xl">🌆</span>
                            <span>午後 (12:00 ≤ 開始)</span>
                        </div>
                    </div>
                </div>

                <div class="border border-gray-200 p-4 rounded-lg">
                    <h4 class="font-semibold mb-3">オプション2: 左側カラーバー</h4>
                    <div class="space-y-2 text-sm">
                        <div class="flex items-center gap-2">
                            <div class="w-1 h-6 bg-blue-500"></div>
                            <span>早朝: <code class="bg-gray-100 px-1 rounded text-xs">border-l-4 border-l-blue-500</code></span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-1 h-6 bg-amber-500"></div>
                            <span>午前: <code class="bg-gray-100 px-1 rounded text-xs">border-l-4 border-l-amber-500</code></span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-1 h-6 bg-orange-500"></div>
                            <span>午後: <code class="bg-gray-100 px-1 rounded text-xs">border-l-4 border-l-orange-500</code></span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 4. 凡例の表示内容 -->
        <section class="section">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 flex items-center">
                <span class="text-blue-600 mr-2">📖</span> 4. 凡例の表示内容
            </h2>

            <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <h4 class="font-semibold mb-3 text-gray-700">セクション1: セル背景色</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex items-center gap-2">
                                <div class="w-4 h-4 bg-green-50 border border-green-300 rounded"></div>
                                <span>希望日</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-4 h-4 bg-gray-100 border border-gray-400 rounded"></div>
                                <span>NG日</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-4 h-4 bg-white border border-gray-300 rounded"></div>
                                <span>希望登録なし</span>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h4 class="font-semibold mb-3 text-gray-700">セクション2: シフトカードの色</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex items-center gap-2">
                                <div class="w-4 h-4 bg-green-100 border border-green-400 rounded"></div>
                                <span>問題なし（NG日以外）</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-4 h-4 bg-red-200 border border-red-500 rounded"></div>
                                <span>要修正（NG日配置）</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-lg">⚠️</span>
                                <span>修正済み（右上バッジ）</span>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h4 class="font-semibold mb-3 text-gray-700">セクション3: 時間帯（オプション）</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex items-center gap-2">
                                <span>🌅</span>
                                <span>早朝 (9時前)</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span>☀️</span>
                                <span>午前 (9-12時)</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span>🌆</span>
                                <span>午後 (12時～)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 6. Before / After 比較 -->
        <section class="section">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 flex items-center">
                <span class="text-blue-600 mr-2">🔄</span> 6. Before / After 比較
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="comparison-box bg-red-50">
                    <h4 class="text-xl font-bold text-red-800 mb-4">❌ Before（現状）</h4>

                    <div class="mb-4">
                        <h5 class="font-semibold mb-2">セル背景:</h5>
                        <ul class="text-sm space-y-1">
                            <li>• bg-green-100: 希望日</li>
                            <li>• bg-red-200: NG日</li>
                        </ul>
                    </div>

                    <div class="mb-4">
                        <h5 class="font-semibold mb-2">シフトカード:</h5>
                        <ul class="text-sm space-y-1">
                            <li>• bg-blue-50: 早朝シフト</li>
                            <li>• bg-green-50: 午前シフト</li>
                            <li>• bg-orange-50: 午後シフト</li>
                            <li>• bg-red-100 border-red-400: 希望不一致</li>
                            <li>• ring-1 ring-yellow-400: 修正済み</li>
                        </ul>
                    </div>

                    <div class="bg-white border border-red-300 p-3 rounded">
                        <h5 class="font-semibold text-red-700 mb-2">問題点:</h5>
                        <ul class="text-sm space-y-1">
                            <li><span class="issue">重複</span> セルとカードで緑色が重複</li>
                            <li><span class="issue">重複</span> セルとカードで赤色が重複</li>
                            <li><span class="issue">混在</span> 時間帯と状態が同じレイヤー</li>
                        </ul>
                    </div>
                </div>

                <div class="comparison-box bg-green-50">
                    <h4 class="text-xl font-bold text-green-800 mb-4">✅ After（新設計 v4.0）</h4>

                    <div class="mb-4">
                        <h5 class="font-semibold mb-2">セル背景:</h5>
                        <ul class="text-sm space-y-1">
                            <li>• bg-green-50: 希望日</li>
                            <li>• bg-gray-100: NG日</li>
                            <li>• bg-white: 希望登録なし</li>
                        </ul>
                    </div>

                    <div class="mb-4">
                        <h5 class="font-semibold mb-2">シフトカード（雇用形態別判定）:</h5>
                        <ul class="text-sm space-y-1">
                            <li>• <strong>正社員:</strong> NG日以外→緑、NG日→赤</li>
                            <li>• <strong>アルバイト・パート:</strong> 希望日→緑、希望日以外→赤</li>
                            <li>+ 右上⚠️バッジ: 修正済み</li>
                        </ul>
                    </div>

                    <div class="mb-4">
                        <h5 class="font-semibold mb-2">時間帯（補助情報）:</h5>
                        <ul class="text-sm space-y-1">
                            <li>• 🌅 早朝 / border-l-4 border-l-blue-500</li>
                            <li>• ☀️ 午前 / border-l-4 border-l-amber-500</li>
                            <li>• 🌆 午後 / border-l-4 border-l-orange-500</li>
                        </ul>
                    </div>

                    <div class="bg-white border border-green-300 p-3 rounded">
                        <h5 class="font-semibold text-green-700 mb-2">改善点:</h5>
                        <ul class="text-sm space-y-1">
                            <li><span class="improvement">分離</span> セルとカードの色が明確に分離</li>
                            <li><span class="improvement">形態別</span> 雇用形態に応じた適切な判定ロジック</li>
                            <li><span class="improvement">補助</span> 時間帯情報は補助的に表示</li>
                            <li><span class="improvement">シンプル</span> 2色のみで直感的（緑=OK、赤=NG）</li>
                            <li><span class="improvement">明確</span> 問題のある配置は即座に判別可能</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- 5. 具体例で見る設計 -->
        <section class="section">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 flex items-center">
                <span class="text-blue-600 mr-2">📊</span> 5. 具体例で見る設計
            </h2>

            <div class="space-y-6">
                <!-- 正社員の例 -->
                <div class="bg-blue-50 border border-blue-200 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-blue-900 mb-4">正社員の田中さん（希望日: 1日,3日,5日 / NG日: 10日）</h3>
                    <table class="w-full">
                        <thead>
                            <tr class="bg-blue-100">
                                <th class="p-2">日付</th>
                                <th class="p-2">セル背景</th>
                                <th class="p-2">シフト配置</th>
                                <th class="p-2">カード色</th>
                                <th class="p-2">意味</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-t">
                                <td class="p-2">1日</td>
                                <td class="p-2"><span class="inline-block w-16 h-6 bg-green-50 border border-green-300 rounded"></span></td>
                                <td class="p-2">あり</td>
                                <td class="p-2"><span class="inline-block w-16 h-6 bg-green-100 border border-green-400 rounded"></span></td>
                                <td class="p-2 text-sm">✅ 問題なし（希望日）</td>
                            </tr>
                            <tr class="border-t">
                                <td class="p-2">2日</td>
                                <td class="p-2"><span class="inline-block w-16 h-6 bg-white border border-gray-300 rounded"></span></td>
                                <td class="p-2">あり</td>
                                <td class="p-2"><span class="inline-block w-16 h-6 bg-green-100 border border-green-400 rounded"></span></td>
                                <td class="p-2 text-sm">✅ 問題なし（希望登録なし）</td>
                            </tr>
                            <tr class="border-t bg-red-50">
                                <td class="p-2">10日</td>
                                <td class="p-2"><span class="inline-block w-16 h-6 bg-gray-100 border border-gray-400 rounded"></span></td>
                                <td class="p-2">あり</td>
                                <td class="p-2"><span class="inline-block w-16 h-6 bg-red-200 border border-red-500 rounded"></span></td>
                                <td class="p-2 text-sm">❌ NG日に配置（要修正！）</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- アルバイトの例 -->
                <div class="bg-purple-50 border border-purple-200 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-purple-900 mb-4">アルバイトの佐藤さん（希望日: 土日のみ）</h3>
                    <table class="w-full">
                        <thead>
                            <tr class="bg-purple-100">
                                <th class="p-2">日付</th>
                                <th class="p-2">セル背景</th>
                                <th class="p-2">シフト配置</th>
                                <th class="p-2">カード色</th>
                                <th class="p-2">意味</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-t">
                                <td class="p-2">土曜</td>
                                <td class="p-2"><span class="inline-block w-16 h-6 bg-green-50 border border-green-300 rounded"></span></td>
                                <td class="p-2">あり</td>
                                <td class="p-2"><span class="inline-block w-16 h-6 bg-green-100 border border-green-400 rounded"></span></td>
                                <td class="p-2 text-sm">✅ 問題なし（希望日）</td>
                            </tr>
                            <tr class="border-t bg-red-50">
                                <td class="p-2">月曜</td>
                                <td class="p-2"><span class="inline-block w-16 h-6 bg-white border border-gray-300 rounded"></span></td>
                                <td class="p-2">あり</td>
                                <td class="p-2"><span class="inline-block w-16 h-6 bg-red-200 border border-red-500 rounded"></span></td>
                                <td class="p-2 text-sm">❌ 希望日以外への配置（要修正）</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="mt-4 text-sm text-purple-800 bg-purple-100 p-3 rounded">
                        <strong>注意:</strong> アルバイト・パートは希望日のみ勤務可能なため、希望日以外への配置は赤色で表示されます
                    </div>
                </div>
            </div>
        </section>

        <!-- 7. 実装手順 -->
        <section class="section">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 flex items-center">
                <span class="text-blue-600 mr-2">🚀</span> 7. 実装手順
            </h2>

            <div class="space-y-6">
                <div class="border-l-4 border-red-500 pl-4 py-2 bg-red-50">
                    <h3 class="text-xl font-bold text-red-900 mb-2">Phase 0: useShiftEditorBase.js の修正（必須）</h3>
                    <ol class="list-decimal list-inside space-y-2 text-gray-700">
                        <li><code>loadMasterData()</code> 関数内のstaffMappingオブジェクトに<code>employment_type</code>を追加
                            <ul class="list-disc list-inside ml-6 text-sm mt-1">
                                <li>修正前: name, role_id, role_name, is_active, store_id のみ</li>
                                <li>修正後: <strong>employment_type</strong> を追加</li>
                            </ul>
                        </li>
                        <li>ファイル: <code>frontend/src/hooks/useShiftEditorBase.js</code> (行51付近)</li>
                    </ol>
                </div>

                <div class="border-l-4 border-blue-500 pl-4 py-2">
                    <h3 class="text-xl font-bold text-blue-900 mb-2">Phase 1: MultiStoreShiftTable.jsx の更新</h3>
                    <ol class="list-decimal list-inside space-y-2 text-gray-700">
                        <li><code>getCellBackgroundColor()</code> を修正
                            <ul class="list-disc list-inside ml-6 text-sm mt-1">
                                <li>bg-red-200 → bg-gray-100（NG日）</li>
                                <li>bg-green-100 → bg-green-50（希望日）</li>
                            </ul>
                        </li>
                        <li><code>getShiftCardColor()</code> を雇用形態別ロジックに変更
                            <ul class="list-disc list-inside ml-6 text-sm mt-1">
                                <li>PART_TIME: 希望日のみ緑、それ以外は赤</li>
                                <li>FULL_TIME: NG日のみ赤、それ以外は緑</li>
                            </ul>
                        </li>
                        <li>修正済みバッジ（⚠️）を右上に表示する機能を追加</li>
                    </ol>
                </div>

                <div class="border-l-4 border-green-500 pl-4 py-2">
                    <h3 class="text-xl font-bold text-green-900 mb-2">Phase 2: SecondPlanEditor.jsx の凡例更新</h3>
                    <ol class="list-decimal list-inside space-y-2 text-gray-700">
                        <li>凡例の表示内容を新設計（v2.0）に合わせて更新</li>
                        <li>時間帯凡例を追加（左側カラーバーの説明）</li>
                    </ol>
                </div>

                <div class="border-l-4 border-amber-500 pl-4 py-2">
                    <h3 class="text-xl font-bold text-amber-900 mb-2">Phase 3: 動作確認</h3>
                    <ol class="list-decimal list-inside space-y-2 text-gray-700">
                        <li>希望日のシフトが青色（bg-blue-100）で表示されることを確認</li>
                        <li>希望外配置が赤色（bg-red-100）で表示されることを確認</li>
                        <li>修正済みシフトに⚠️バッジが表示されることを確認</li>
                        <li>時間帯の左側カラーバーが正しく表示されることを確認</li>
                    </ol>
                </div>

                <div class="border-l-4 border-purple-500 pl-4 py-2">
                    <h3 class="text-xl font-bold text-purple-900 mb-2">Phase 4: FirstPlanEditor.jsx への展開（オプション）</h3>
                    <ol class="list-decimal list-inside space-y-2 text-gray-700">
                        <li>SecondPlanEditorと同様の変更を適用</li>
                    </ol>
                </div>
            </div>
        </section>

        <!-- フッター -->
        <footer class="mt-12 pt-6 border-t-2 border-gray-200 text-center text-gray-600 text-sm">
            <p>© 2025 Shift Scheduler AI - Design Documentation</p>
            <p class="mt-2">バージョン 4.1 | 最終更新: 2025-01-19</p>
            <div class="mt-4 bg-blue-50 border border-blue-200 rounded p-4 text-left max-w-2xl mx-auto">
                <h4 class="font-semibold text-blue-900 mb-2">📝 変更履歴</h4>
                <ul class="text-xs space-y-1">
                    <li><strong>v4.1 (2025-01-19):</strong> 🐛 バグ修正 - useShiftEditorBase.jsのstaffMappingにemployment_typeフィールドを追加（必須）。これがないと雇用形態の判定が動作しない</li>
                    <li><strong>v4.0 (2025-01-17):</strong> 雇用形態別ロジックに変更 - 正社員: NG日以外は緑、アルバイト・パート: 希望日のみ緑。データベースの雇用形態値をPART_TIME/FULL_TIMEに修正</li>
                    <li><strong>v3.0 (2025-01-17):</strong> NG日判定ベースに変更 - シフトカードを2色のみ（緑=NG日以外、赤=NG日配置）に統一</li>
                    <li><strong>v2.0 (2025-01-16):</strong> シンプル設計に変更 - シフトカードを2色のみ（青=希望通り、赤=希望不一致）に統一</li>
                    <li><strong>v1.0 (2025-01-16):</strong> 初版作成</li>
                </ul>
            </div>
        </footer>
    </div>
</body>
</html>
