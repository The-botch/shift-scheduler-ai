<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚·ãƒ•ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³æ´»ç”¨ã«ã‚ˆã‚‹ pattern_id ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰å•é¡Œã®è§£æ±º</title>
  <style>
    body {
      font-family: 'Segoe UI', Meiryo, sans-serif;
      line-height: 1.8;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .container {
      background-color: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 {
      color: #2c3e50;
      border-bottom: 3px solid #3498db;
      padding-bottom: 10px;
    }
    h2 {
      color: #34495e;
      border-left: 4px solid #3498db;
      padding-left: 10px;
      margin-top: 30px;
    }
    h3 {
      color: #555;
      margin-top: 20px;
    }
    .section {
      margin: 20px 0;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 5px;
    }
    .problem {
      background-color: #fee;
      border-left: 4px solid #e74c3c;
      padding: 15px;
      margin: 10px 0;
    }
    .solution {
      background-color: #efe;
      border-left: 4px solid #27ae60;
      padding: 15px;
      margin: 10px 0;
    }
    .warning {
      background-color: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 15px;
      margin: 10px 0;
    }
    .info {
      background-color: #e7f3ff;
      border-left: 4px solid #2196F3;
      padding: 15px;
      margin: 10px 0;
    }
    pre {
      background-color: #f4f4f4;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
      border: 1px solid #ddd;
    }
    code {
      font-family: 'Courier New', monospace;
      background-color: #f4f4f4;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 0.9em;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: left;
    }
    th {
      background-color: #3498db;
      color: white;
    }
    tr:nth-child(even) {
      background-color: #f8f9fa;
    }
    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 3px;
      font-size: 0.85em;
      font-weight: bold;
    }
    .badge-red { background-color: #e74c3c; color: white; }
    .badge-green { background-color: #27ae60; color: white; }
    .badge-blue { background-color: #3498db; color: white; }
    .badge-yellow { background-color: #f39c12; color: white; }
    ul {
      padding-left: 25px;
    }
    li {
      margin: 8px 0;
    }
    .flow-diagram {
      background-color: #fff;
      border: 2px solid #3498db;
      padding: 20px;
      margin: 20px 0;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”§ ã‚·ãƒ•ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³æ´»ç”¨ã«ã‚ˆã‚‹ pattern_id ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰å•é¡Œã®è§£æ±º</h1>

    <div class="section">
      <p><strong>ä½œæˆæ—¥:</strong> 2025å¹´11æœˆ25æ—¥</p>
      <p><strong>ä½œæˆè€…:</strong> Claude (with User)</p>
      <p><strong>å¯¾è±¡Issue:</strong> #71 Stagingç’°å¢ƒå¯¾å¿œ / pattern_id ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰å•é¡Œ</p>
    </div>

    <!-- ========================================
         1. å•é¡Œã®èƒŒæ™¯
    ======================================== -->
    <h2>1. å•é¡Œã®èƒŒæ™¯</h2>

    <div class="problem">
      <h3>ğŸš¨ ç™ºç”Ÿã—ãŸå•é¡Œ</h3>
      <p>STGç’°å¢ƒï¼ˆãƒ†ãƒŠãƒ³ãƒˆ3ï¼‰ã§ã‚·ãƒ•ãƒˆä½œæˆæ™‚ã«ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿï¼š</p>
      <pre>error: insert or update on table "shifts" violates foreign key constraint "shifts_pattern_id_fkey"
detail: 'Key (pattern_id)=(1) is not present in table "shift_patterns".'</pre>
      <p><strong>ã‚¨ãƒ©ãƒ¼ç®‡æ‰€:</strong> SecondPlanEditor.jsx:1196, FirstPlanEditor.jsx:703</p>
    </div>

    <h3>1.1 æ ¹æœ¬åŸå› </h3>
    <div class="warning">
      <p><strong>pattern_id=1 ãŒãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹</strong></p>
      <pre>// SecondPlanEditor.jsx:1196
pattern_id: 1, // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆé€šå¸¸å‹¤å‹™ï¼‰

// FirstPlanEditor.jsx:703
pattern_id: defaultPatternId || 1, // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¨ã—ã¦1ã‚’ä½¿ç”¨</pre>
    </div>

    <h3>1.2 ç’°å¢ƒã”ã¨ã®ãƒ‡ãƒ¼ã‚¿çŠ¶æ³</h3>
    <table>
      <thead>
        <tr>
          <th>ç’°å¢ƒ</th>
          <th>ãƒ†ãƒŠãƒ³ãƒˆID</th>
          <th>pattern_id ç¯„å›²</th>
          <th>å‹•ä½œçŠ¶æ³</th>
          <th>ç†ç”±</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><span class="badge badge-green">PRD</span></td>
          <td>1</td>
          <td>1, 2, 3, 4</td>
          <td>âœ… æ­£å¸¸å‹•ä½œ</td>
          <td>pattern_id=1 ãŒå­˜åœ¨ã™ã‚‹</td>
        </tr>
        <tr>
          <td><span class="badge badge-yellow">STG</span></td>
          <td>3</td>
          <td>5, 6, 7, 8</td>
          <td>âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ</td>
          <td>pattern_id=1 ãŒå­˜åœ¨ã—ãªã„</td>
        </tr>
      </tbody>
    </table>

    <h3>1.3 ãªãœ pattern_id ãŒç•°ãªã‚‹ã®ã‹</h3>
    <div class="info">
      <p><strong>PostgreSQL ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹è‡ªå‹•æ¡ç•ªãŒåŸå› </strong></p>
      <p>DMLãƒ•ã‚¡ã‚¤ãƒ«ã§ pattern_id ã‚’æ˜ç¤ºçš„ã«æŒ‡å®šã—ã¦ã„ãªã„ãŸã‚ã€æŒ¿å…¥é †åºã«å¿œã˜ã¦è‡ªå‹•æ¡ç•ªã•ã‚Œã‚‹ï¼š</p>
      <pre>-- ãƒ†ãƒŠãƒ³ãƒˆ1ã®ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ï¼ˆæœ€åˆï¼‰
INSERT INTO core.shift_patterns (tenant_id, pattern_code, pattern_name, ...)
VALUES (1, 'EARLY', 'æ—©ç•ª', ...);  -- pattern_id=1 (è‡ªå‹•æ¡ç•ª)

-- ãƒ†ãƒŠãƒ³ãƒˆ3ã®ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ï¼ˆå¾Œã‹ã‚‰ï¼‰
INSERT INTO core.shift_patterns (tenant_id, pattern_code, pattern_name, ...)
VALUES (3, 'EARLY', 'æ—©ç•ª', ...);  -- pattern_id=5 (è‡ªå‹•æ¡ç•ªãƒ»ç¶šãã‹ã‚‰)</pre>
    </div>

    <h3>1.4 ç¾çŠ¶ã®å•é¡Œç‚¹</h3>
    <ul>
      <li>âŒ <strong>ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œãŒä¸å®Œå…¨</strong>: ãƒ†ãƒŠãƒ³ãƒˆ1ä»¥å¤–ã§å‹•ä½œã—ãªã„</li>
      <li>âŒ <strong>æ–°è¦ãƒ†ãƒŠãƒ³ãƒˆè¿½åŠ ä¸å¯</strong>: ãƒ†ãƒŠãƒ³ãƒˆè¿½åŠ æ™‚ã«å¿…ãšã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ</li>
      <li>âŒ <strong>STGç’°å¢ƒã§ãƒ†ã‚¹ãƒˆä¸å¯</strong>: é–‹ç™ºãƒ»æ¤œè¨¼ç’°å¢ƒã§å‹•ä½œã—ãªã„</li>
      <li>âŒ <strong>pattern ã®å®šç¾©ãŒæœªæ´»ç”¨</strong>: pattern_id ã¯æŒ‡å®šã™ã‚‹ãŒã€start_time/end_time ã¯ä½¿ã‚ãªã„çŸ›ç›¾</li>
    </ul>

    <!-- ========================================
         2. ç¾çŠ¶ã®å®Ÿè£…åˆ†æ
    ======================================== -->
    <h2>2. ç¾çŠ¶ã®å®Ÿè£…åˆ†æ</h2>

    <h3>2.1 shift_patterns ãƒ†ãƒ¼ãƒ–ãƒ«ã®è¨­è¨ˆ</h3>
    <pre>CREATE TABLE core.shift_patterns (
  pattern_id SERIAL PRIMARY KEY,        -- è‡ªå‹•æ¡ç•ª
  tenant_id INT NOT NULL,               -- ãƒ†ãƒŠãƒ³ãƒˆID
  pattern_code VARCHAR(50),             -- 'EARLY', 'LATE', 'MID', 'FULL'
  pattern_name VARCHAR(100),            -- 'æ—©ç•ª', 'é…ç•ª', 'ä¸­ç•ª', 'é€šã—'
  start_time TIME,                      -- æ¨™æº–ã®é–‹å§‹æ™‚åˆ»
  end_time TIME,                        -- æ¨™æº–ã®çµ‚äº†æ™‚åˆ»
  break_minutes INT,                    -- æ¨™æº–ã®ä¼‘æ†©æ™‚é–“
  is_active BOOLEAN
);</pre>

    <h3>2.2 ãƒ†ãƒŠãƒ³ãƒˆ3ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ‡ãƒ¼ã‚¿</h3>
    <table>
      <thead>
        <tr>
          <th>pattern_id</th>
          <th>pattern_code</th>
          <th>pattern_name</th>
          <th>start_time</th>
          <th>end_time</th>
          <th>break_minutes</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>5</td>
          <td>EARLY</td>
          <td>æ—©ç•ª</td>
          <td>09:00</td>
          <td>17:00</td>
          <td>60</td>
        </tr>
        <tr>
          <td>6</td>
          <td>MID</td>
          <td>ä¸­ç•ª</td>
          <td>12:00</td>
          <td>20:00</td>
          <td>60</td>
        </tr>
        <tr>
          <td>7</td>
          <td>LATE</td>
          <td>é…ç•ª</td>
          <td>15:00</td>
          <td>23:00</td>
          <td>60</td>
        </tr>
        <tr>
          <td>8</td>
          <td>FULL</td>
          <td>é€šã—</td>
          <td>09:00</td>
          <td>22:00</td>
          <td>90</td>
        </tr>
      </tbody>
    </table>

    <h3>2.3 ç¾çŠ¶ã®ã‚·ãƒ•ãƒˆä½œæˆãƒ•ãƒ­ãƒ¼</h3>
    <div class="flow-diagram">
      <pre>
ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ
  â†“
ã‚·ãƒ•ãƒˆä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
  â†“
ã‚¹ã‚¿ãƒƒãƒ•ãƒ»æ—¥ä»˜ãƒ»æ™‚é–“ã‚’å…¥åŠ›
  â†“
<span style="color: red; font-weight: bold;">pattern_id: 1 (ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰)</span>  â† âŒ å•é¡Œç®‡æ‰€
  â†“
ã‚·ãƒ•ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆ
  â†“
ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIé€ä¿¡
  â†“
âŒ ã‚¨ãƒ©ãƒ¼: pattern_id=1 ãŒå­˜åœ¨ã—ãªã„
      </pre>
    </div>

    <h3>2.4 pattern_id ã®çŸ›ç›¾</h3>
    <div class="problem">
      <p><strong>pattern_id ã¯æŒ‡å®šã•ã‚Œã¦ã„ã‚‹ãŒã€ãã®å®šç¾©ã¯ä½¿ã‚ã‚Œã¦ã„ãªã„</strong></p>
      <pre>const newShift = {
  pattern_id: 1,                          // ãƒ‘ã‚¿ãƒ¼ãƒ³IDã¯æŒ‡å®š
  start_time: shiftData.start_time,       // ã§ã‚‚æ™‚é–“ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›
  end_time: shiftData.end_time,           // ã§ã‚‚æ™‚é–“ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›
  break_minutes: shiftData.break_minutes, // ã§ã‚‚ä¼‘æ†©ã‚‚ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›
}</pre>
      <p>â†’ pattern ã® start_time, end_time, break_minutes ãŒå…¨ãæ´»ç”¨ã•ã‚Œã¦ã„ãªã„</p>
    </div>

    <!-- ========================================
         3. è§£æ±ºæ–¹é‡
    ======================================== -->
    <h2>3. è§£æ±ºæ–¹é‡</h2>

    <div class="solution">
      <h3>âœ… æ¡ç”¨ã™ã‚‹æ–¹é‡: pattern ã®å®šç¾©ã‚’æ´»ç”¨ã™ã‚‹</h3>
      <p>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é¸æŠ â†’ è‡ªå‹•çš„ã«æ™‚é–“ãŒè¨­å®šã•ã‚Œã‚‹ä»•çµ„ã¿ã‚’å®Ÿè£…</p>
    </div>

    <h3>3.1 æ–°ã—ã„ã‚·ãƒ•ãƒˆä½œæˆãƒ•ãƒ­ãƒ¼</h3>
    <div class="flow-diagram">
      <pre>
ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ
  â†“
ã‚·ãƒ•ãƒˆä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
  â†“
<span style="color: green; font-weight: bold;">ãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠ (æ—©ç•ª/ä¸­ç•ª/é…ç•ª/é€šã—)</span>  â† âœ… æ–°æ©Ÿèƒ½
  â†“
<span style="color: green; font-weight: bold;">è‡ªå‹•çš„ã«æ™‚é–“ãŒè¨­å®šã•ã‚Œã‚‹</span>
  - æ—©ç•ª â†’ 09:00-17:00, ä¼‘æ†©60åˆ†
  - ä¸­ç•ª â†’ 12:00-20:00, ä¼‘æ†©60åˆ†
  - é…ç•ª â†’ 15:00-23:00, ä¼‘æ†©60åˆ†
  - é€šã— â†’ 09:00-22:00, ä¼‘æ†©90åˆ†
  â†“
æ‰‹å‹•ã§æ™‚é–“ã‚’å¾®èª¿æ•´å¯èƒ½ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)
  â†“
ã‚·ãƒ•ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆ
  - pattern_id: é¸æŠã—ãŸãƒ‘ã‚¿ãƒ¼ãƒ³ã®ID (5,6,7,8)
  - start_time: ãƒ‘ã‚¿ãƒ¼ãƒ³ã® start_time
  - end_time: ãƒ‘ã‚¿ãƒ¼ãƒ³ã® end_time
  - break_minutes: ãƒ‘ã‚¿ãƒ¼ãƒ³ã® break_minutes
  â†“
ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIé€ä¿¡
  â†“
âœ… æˆåŠŸ: æ­£ã—ã„ pattern_id ãŒä½¿ç”¨ã•ã‚Œã‚‹
      </pre>
    </div>

    <h3>3.2 ãƒ¡ãƒªãƒƒãƒˆ</h3>
    <ul>
      <li>âœ… <strong>ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œ</strong>: ã©ã®ãƒ†ãƒŠãƒ³ãƒˆã§ã‚‚å‹•ä½œã™ã‚‹</li>
      <li>âœ… <strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®å‘ä¸Š</strong>: ãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠã§æ™‚é–“ã‚’è‡ªå‹•å…¥åŠ›ã€å…¥åŠ›ã®æ‰‹é–“å‰Šæ¸›</li>
      <li>âœ… <strong>ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§</strong>: pattern ã®å®šç¾©ãŒå®Ÿéš›ã«æ´»ç”¨ã•ã‚Œã‚‹</li>
      <li>âœ… <strong>ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§</strong>: ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒã‚¹ã‚¿ã§ä¸€æ‹¬ç®¡ç†ãƒ»å¤‰æ›´å¯èƒ½</li>
    </ul>

    <!-- ========================================
         4. å®Ÿè£…è©³ç´°
    ======================================== -->
    <h2>4. å®Ÿè£…è©³ç´°</h2>

    <h3>4.1 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…</h3>

    <h4>4.1.1 shift_patterns ãƒ‡ãƒ¼ã‚¿ã®å–å¾—</h4>
    <p><strong>å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«:</strong> <code>SecondPlanEditor.jsx</code>, <code>FirstPlanEditor.jsx</code></p>

    <pre>// â‘  state è¿½åŠ 
const [shiftPatterns, setShiftPatterns] = useState([])

// â‘¡ useEffect ã§ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—
useEffect(() => {
  const fetchShiftPatterns = async () => {
    try {
      const patterns = await masterRepository.getShiftPatterns(tenantId)
      setShiftPatterns(patterns)
    } catch (error) {
      console.error('ã‚·ãƒ•ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³å–å¾—ã‚¨ãƒ©ãƒ¼:', error)
    }
  }

  if (tenantId) {
    fetchShiftPatterns()
  }
}, [tenantId])</pre>

    <h4>4.1.2 ã‚·ãƒ•ãƒˆä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ«ã®æ”¹ä¿®</h4>
    <p><strong>è¿½åŠ ã™ã‚‹è¦ç´ :</strong></p>
    <ul>
      <li>ãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³</li>
      <li>é¸æŠã—ãŸãƒ‘ã‚¿ãƒ¼ãƒ³ã®è©³ç´°è¡¨ç¤ºï¼ˆæ™‚é–“ãƒ»ä¼‘æ†©ï¼‰</li>
      <li>æ™‚é–“ã®æ‰‹å‹•ç·¨é›†æ©Ÿèƒ½ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰</li>
    </ul>

    <pre>// â‘¢ ãƒ¢ãƒ¼ãƒ€ãƒ«ã® state è¿½åŠ 
const [modalState, setModalState] = useState({
  isOpen: false,
  mode: 'add',
  shift: null,
  <span style="color: green; font-weight: bold;">selectedPattern: null, // è¿½åŠ </span>
  position: { x: 0, y: 0 },
})</pre>

    <h4>4.1.3 ãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠæ™‚ã®å‡¦ç†</h4>
    <pre>// â‘£ ãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠãƒãƒ³ãƒ‰ãƒ©
const handlePatternSelect = (patternId) => {
  const pattern = shiftPatterns.find(p => p.pattern_id === patternId)

  if (pattern) {
    setModalState(prev => ({
      ...prev,
      selectedPattern: pattern,
      shift: {
        ...prev.shift,
        pattern_id: pattern.pattern_id,
        start_time: pattern.start_time,
        end_time: pattern.end_time,
        break_minutes: pattern.break_minutes,
      }
    }))
  }
}</pre>

    <h4>4.1.4 ã‚·ãƒ•ãƒˆä½œæˆæ™‚ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ </h4>
    <pre>// â‘¤ handleAddShift ã®ä¿®æ­£
const newShift = {
  shift_id: tempId,
  tenant_id: tenantId,
  store_id: shiftData.store_id,
  plan_id: planId,
  staff_id: shiftData.staff_id,
  shift_date: shiftData.date,
  <span style="color: green; font-weight: bold;">pattern_id: modalState.selectedPattern?.pattern_id || shiftPatterns[0]?.pattern_id,</span>
  <span style="color: green; font-weight: bold;">start_time: modalState.shift.start_time,</span>
  <span style="color: green; font-weight: bold;">end_time: modalState.shift.end_time,</span>
  <span style="color: green; font-weight: bold;">break_minutes: modalState.shift.break_minutes,</span>
  is_preferred: false,
  is_modified: true,
  year: year,
  month: month,
  plan_type: 'SECOND',
  staff_name: shiftData.staff_name,
  role: staffMap[shiftData.staff_id]?.role_name || 'ã‚¹ã‚¿ãƒƒãƒ•',
  modified_flag: true,
}</pre>

    <h3>4.2 UIè¨­è¨ˆ</h3>

    <h4>4.2.1 ãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³</h4>
    <pre>&lt;div className="pattern-select"&gt;
  &lt;label&gt;ã‚·ãƒ•ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³&lt;/label&gt;
  &lt;select
    value={modalState.selectedPattern?.pattern_id || ''}
    onChange={(e) => handlePatternSelect(Number(e.target.value))}
  &gt;
    &lt;option value=""&gt;ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é¸æŠ&lt;/option&gt;
    {shiftPatterns.map(pattern => (
      &lt;option key={pattern.pattern_id} value={pattern.pattern_id}&gt;
        {pattern.pattern_name} ({pattern.start_time}-{pattern.end_time})
      &lt;/option&gt;
    ))}
  &lt;/select&gt;
&lt;/div&gt;</pre>

    <h4>4.2.2 ãƒ‘ã‚¿ãƒ¼ãƒ³è©³ç´°è¡¨ç¤º</h4>
    <pre>&lt;div className="pattern-details"&gt;
  {modalState.selectedPattern && (
    &lt;&gt;
      &lt;p&gt;é–‹å§‹: {modalState.selectedPattern.start_time}&lt;/p&gt;
      &lt;p&gt;çµ‚äº†: {modalState.selectedPattern.end_time}&lt;/p&gt;
      &lt;p&gt;ä¼‘æ†©: {modalState.selectedPattern.break_minutes}åˆ†&lt;/p&gt;
    &lt;/&gt;
  )}
&lt;/div&gt;</pre>

    <!-- ========================================
         5. å½±éŸ¿ç¯„å›²
    ======================================== -->
    <h2>5. å½±éŸ¿ç¯„å›²</h2>

    <h3>5.1 ä¿®æ­£ãŒå¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«</h3>
    <table>
      <thead>
        <tr>
          <th>ãƒ•ã‚¡ã‚¤ãƒ«</th>
          <th>ä¿®æ­£å†…å®¹</th>
          <th>å„ªå…ˆåº¦</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>SecondPlanEditor.jsx</code></td>
          <td>
            - shift_patterns å–å¾—<br>
            - ãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠUIè¿½åŠ <br>
            - handleAddShift ä¿®æ­£
          </td>
          <td><span class="badge badge-red">HIGH</span></td>
        </tr>
        <tr>
          <td><code>FirstPlanEditor.jsx</code></td>
          <td>
            - shift_patterns å–å¾—<br>
            - ãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠUIè¿½åŠ <br>
            - handleAddShift ä¿®æ­£
          </td>
          <td><span class="badge badge-red">HIGH</span></td>
        </tr>
        <tr>
          <td><code>MasterRepository.js</code></td>
          <td>ç¢ºèªã®ã¿ï¼ˆæ—¢ã«å®Ÿè£…æ¸ˆã¿ï¼‰</td>
          <td><span class="badge badge-green">DONE</span></td>
        </tr>
      </tbody>
    </table>

    <h3>5.2 æ—¢å­˜æ©Ÿèƒ½ã¸ã®å½±éŸ¿</h3>
    <ul>
      <li>âœ… <strong>å½±éŸ¿ãªã—</strong>: æ—¢å­˜ã®ã‚·ãƒ•ãƒˆãƒ‡ãƒ¼ã‚¿ã¯å¤‰æ›´ä¸è¦</li>
      <li>âœ… <strong>å¾Œæ–¹äº’æ›æ€§</strong>: æ—¢å­˜ã®ã‚·ãƒ•ãƒˆã¯å¼•ãç¶šãè¡¨ç¤ºãƒ»ç·¨é›†å¯èƒ½</li>
      <li>âš ï¸ <strong>æ–°è¦ã‚·ãƒ•ãƒˆä½œæˆã®ã¿</strong>: å½±éŸ¿ç¯„å›²ã¯æ–°è¦ä½œæˆæ©Ÿèƒ½ã«é™å®š</li>
    </ul>

    <!-- ========================================
         6. ãƒ†ã‚¹ãƒˆè¨ˆç”»
    ======================================== -->
    <h2>6. ãƒ†ã‚¹ãƒˆè¨ˆç”»</h2>

    <h3>6.1 å˜ä½“ãƒ†ã‚¹ãƒˆ</h3>
    <table>
      <thead>
        <tr>
          <th>ãƒ†ã‚¹ãƒˆé …ç›®</th>
          <th>ç¢ºèªå†…å®¹</th>
          <th>æœŸå¾…çµæœ</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>shift_patterns å–å¾—</td>
          <td>APIå‘¼ã³å‡ºã—ãŒæˆåŠŸã™ã‚‹ã‹</td>
          <td>ãƒ†ãƒŠãƒ³ãƒˆ3ã®ãƒ‘ã‚¿ãƒ¼ãƒ³4ä»¶å–å¾—</td>
        </tr>
        <tr>
          <td>ãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠUIè¡¨ç¤º</td>
          <td>ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹</td>
          <td>4ã¤ã®é¸æŠè‚¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹</td>
        </tr>
        <tr>
          <td>ãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠæ™‚ã®è‡ªå‹•å…¥åŠ›</td>
          <td>æ™‚é–“ãŒè‡ªå‹•è¨­å®šã•ã‚Œã‚‹ã‹</td>
          <td>start_time, end_time, break_minutes ãŒè¨­å®šã•ã‚Œã‚‹</td>
        </tr>
        <tr>
          <td>ã‚·ãƒ•ãƒˆä½œæˆæˆåŠŸ</td>
          <td>æ­£ã—ã„ pattern_id ã§ä½œæˆã•ã‚Œã‚‹ã‹</td>
          <td>ã‚¨ãƒ©ãƒ¼ãªãä½œæˆå®Œäº†</td>
        </tr>
      </tbody>
    </table>

    <h3>6.2 çµ±åˆãƒ†ã‚¹ãƒˆ (STGç’°å¢ƒ)</h3>
    <ol>
      <li>âœ… ãƒ†ãƒŠãƒ³ãƒˆ3ã§ãƒ­ã‚°ã‚¤ãƒ³</li>
      <li>âœ… ã‚·ãƒ•ãƒˆä½œæˆç”»é¢ã‚’é–‹ã</li>
      <li>âœ… ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‹ã‚‰ã€Œæ—©ç•ªã€ã‚’é¸æŠ</li>
      <li>âœ… æ™‚é–“ãŒè‡ªå‹•å…¥åŠ›ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª (09:00-17:00, ä¼‘æ†©60åˆ†)</li>
      <li>âœ… ã‚¹ã‚¿ãƒƒãƒ•ãƒ»æ—¥ä»˜ã‚’é¸æŠ</li>
      <li>âœ… ä¿å­˜ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯</li>
      <li>âœ… ã‚·ãƒ•ãƒˆãŒæ­£å¸¸ã«ä½œæˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª</li>
      <li>âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ pattern_id=5 ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª</li>
    </ol>

    <h3>6.3 å›å¸°ãƒ†ã‚¹ãƒˆ (PRDç’°å¢ƒ)</h3>
    <ol>
      <li>âœ… ãƒ†ãƒŠãƒ³ãƒˆ1ã§ãƒ­ã‚°ã‚¤ãƒ³</li>
      <li>âœ… æ—¢å­˜ã®ã‚·ãƒ•ãƒˆãŒæ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‹</li>
      <li>âœ… æ–°è¦ã‚·ãƒ•ãƒˆä½œæˆãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã‹</li>
      <li>âœ… ãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠæ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã‹</li>
    </ol>

    <!-- ========================================
         7. ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³
    ======================================== -->
    <h2>7. å®Ÿè£…ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³</h2>

    <table>
      <thead>
        <tr>
          <th>ãƒ•ã‚§ãƒ¼ã‚º</th>
          <th>ä½œæ¥­å†…å®¹</th>
          <th>æ‹…å½“</th>
          <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Phase 1</td>
          <td>è¨­è¨ˆæ›¸ä½œæˆ</td>
          <td>Claude + User</td>
          <td><span class="badge badge-green">å®Œäº†</span></td>
        </tr>
        <tr>
          <td>Phase 2</td>
          <td>SecondPlanEditor.jsx å®Ÿè£…</td>
          <td>Claude</td>
          <td><span class="badge badge-blue">å¾…æ©Ÿä¸­</span></td>
        </tr>
        <tr>
          <td>Phase 3</td>
          <td>FirstPlanEditor.jsx å®Ÿè£…</td>
          <td>Claude</td>
          <td><span class="badge badge-blue">å¾…æ©Ÿä¸­</span></td>
        </tr>
        <tr>
          <td>Phase 4</td>
          <td>STGç’°å¢ƒã§ã®å‹•ä½œç¢ºèª</td>
          <td>User</td>
          <td><span class="badge badge-blue">å¾…æ©Ÿä¸­</span></td>
        </tr>
        <tr>
          <td>Phase 5</td>
          <td>PRDç’°å¢ƒã§ã®å›å¸°ãƒ†ã‚¹ãƒˆ</td>
          <td>User</td>
          <td><span class="badge badge-blue">å¾…æ©Ÿä¸­</span></td>
        </tr>
      </tbody>
    </table>

    <!-- ========================================
         8. å°†æ¥ã®æ”¹å–„æ¡ˆ
    ======================================== -->
    <h2>8. å°†æ¥ã®æ”¹å–„æ¡ˆ</h2>

    <h3>8.1 ãƒ‘ã‚¿ãƒ¼ãƒ³ç®¡ç†æ©Ÿèƒ½ã®å¼·åŒ–</h3>
    <ul>
      <li>ç®¡ç†ç”»é¢ã‹ã‚‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è¿½åŠ ãƒ»ç·¨é›†ãƒ»å‰Šé™¤</li>
      <li>åº—èˆ—ã”ã¨ã®ãƒ‘ã‚¿ãƒ¼ãƒ³è¨­å®š</li>
      <li>ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¸¦ã³é †è¨­å®š</li>
    </ul>

    <h3>8.2 UXæ”¹å–„</h3>
    <ul>
      <li>ãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆï¼ˆã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œï¼‰</li>
      <li>ã‚ˆãä½¿ã†ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä¸Šä½è¡¨ç¤º</li>
      <li>ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º</li>
    </ul>

    <h3>8.3 ãƒ‡ãƒ¼ã‚¿åˆ†æ</h3>
    <ul>
      <li>ãƒ‘ã‚¿ãƒ¼ãƒ³ã”ã¨ã®ä½¿ç”¨é »åº¦åˆ†æ</li>
      <li>ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ¥ã®åŠ´åƒã‚³ã‚¹ãƒˆåˆ†æ</li>
      <li>ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æœ€é©åŒ–ææ¡ˆ</li>
    </ul>

    <!-- ========================================
         9. å‚è€ƒæƒ…å ±
    ======================================== -->
    <h2>9. å‚è€ƒæƒ…å ±</h2>

    <h3>9.1 é–¢é€£Issue</h3>
    <ul>
      <li>Issue #71: Stagingç’°å¢ƒå¯¾å¿œ</li>
      <li>ç’°å¢ƒè¨­å®šãƒ¢ãƒ€ãƒŠã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå‰å›å¯¾å¿œæ¸ˆã¿ï¼‰</li>
    </ul>

    <h3>9.2 é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</h3>
    <ul>
      <li><a href="ENVIRONMENT_CONFIGURATION.html">ç’°å¢ƒè¨­å®šãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a></li>
      <li>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒå®šç¾© (schema.sql)</li>
    </ul>

    <h3>9.3 APIä»•æ§˜</h3>
    <div class="info">
      <p><strong>GET /api/master/shift-patterns</strong></p>
      <p>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿: <code>tenant_id</code> (å¿…é ˆ)</p>
      <p>ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:</p>
      <pre>{
  "success": true,
  "data": [
    {
      "pattern_id": 5,
      "pattern_code": "EARLY",
      "pattern_name": "æ—©ç•ª",
      "start_time": "09:00:00",
      "end_time": "17:00:00",
      "break_minutes": 60,
      "store_id": null
    }
  ]
}</pre>
    </div>

    <!-- ========================================
         10. ã¾ã¨ã‚
    ======================================== -->
    <h2>10. ã¾ã¨ã‚</h2>

    <div class="solution">
      <h3>âœ… ã“ã®è¨­è¨ˆã«ã‚ˆã‚Šè§£æ±ºã•ã‚Œã‚‹å•é¡Œ</h3>
      <ul>
        <li>âœ… pattern_id ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã®è§£æ¶ˆ</li>
        <li>âœ… ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œã®å®Ÿç¾</li>
        <li>âœ… STGç’°å¢ƒã§ã®å‹•ä½œä¿è¨¼</li>
        <li>âœ… pattern å®šç¾©ã®æœ‰åŠ¹æ´»ç”¨</li>
        <li>âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®å‘ä¸Š</li>
      </ul>
    </div>

    <div class="warning">
      <h3>âš ï¸ æ³¨æ„äº‹é …</h3>
      <ul>
        <li>æ—¢å­˜ã®ã‚·ãƒ•ãƒˆãƒ‡ãƒ¼ã‚¿ã«ã¯å½±éŸ¿ã—ãªã„ï¼ˆæ–°è¦ä½œæˆã®ã¿ï¼‰</li>
        <li>ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒ1ä»¶ã‚‚ç™»éŒ²ã•ã‚Œã¦ã„ãªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ãŒå¿…è¦</li>
        <li>FirstPlanEditor.jsx ã¨ SecondPlanEditor.jsx ã®ä¸¡æ–¹ã‚’ä¿®æ­£ã™ã‚‹å¿…è¦ãŒã‚ã‚‹</li>
      </ul>
    </div>

    <p style="text-align: center; margin-top: 40px; color: #7f8c8d;">
      <em>ã“ã®è¨­è¨ˆæ›¸ã«åŸºã¥ã„ã¦å®Ÿè£…ã‚’é€²ã‚ã¦ãã ã•ã„ã€‚</em>
    </p>
  </div>
</body>
</html>
