<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒæ§‹ç¯‰ - è©³ç´°è¨­è¨ˆæ›¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 8px;
        }

        h1 {
            color: #2c3e50;
            border-bottom: 4px solid #3498db;
            padding-bottom: 15px;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        h2 {
            color: #2c3e50;
            margin-top: 40px;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-left: 5px solid #3498db;
            padding-left: 15px;
        }

        h3 {
            color: #34495e;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .warning strong {
            color: #856404;
        }

        .env-diagram {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 30px;
            margin: 25px 0;
        }

        .env-title {
            background: #3498db;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 20px;
            text-align: center;
        }

        .env-title.current {
            background: #e74c3c;
        }

        .env-title.development {
            background: #2ecc71;
        }

        .env-title.staging {
            background: #f39c12;
        }

        .env-title.production {
            background: #9b59b6;
        }

        .component-flow {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .component {
            flex: 1;
            min-width: 200px;
            background: white;
            border: 2px solid #3498db;
            border-radius: 8px;
            padding: 20px;
            margin: 10px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .component.danger {
            border-color: #e74c3c;
            background: #fee;
        }

        .component-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .component-detail {
            color: #7f8c8d;
            font-size: 0.9em;
            margin: 5px 0;
        }

        .arrow {
            flex: 0 0 60px;
            text-align: center;
            font-size: 2em;
            color: #3498db;
            font-weight: bold;
        }

        .config-box {
            background: #ecf0f1;
            border-left: 4px solid #95a5a6;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        th {
            background: #3498db;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #dee2e6;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .code-block pre {
            margin: 0;
        }

        .file-tree {
            background: #2c3e50;
            border: 2px solid #34495e;
            padding: 30px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            border-radius: 8px;
            color: #ecf0f1;
            line-height: 2;
        }

        .file-tree-item {
            display: flex;
            align-items: center;
            padding: 5px 0;
            transition: background 0.2s;
        }

        .file-tree-item:hover {
            background: rgba(52, 152, 219, 0.1);
            border-radius: 4px;
        }

        .file-tree-icon {
            margin-right: 8px;
            font-size: 1.1em;
        }

        .file-tree-name {
            flex: 0 0 auto;
            min-width: 250px;
        }

        .file-tree-desc {
            color: #95a5a6;
            font-size: 0.9em;
            margin-left: 10px;
        }

        .indent-0 { padding-left: 0; }
        .indent-1 { padding-left: 20px; }
        .indent-2 { padding-left: 40px; }
        .indent-3 { padding-left: 60px; }
        .indent-4 { padding-left: 80px; }

        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.85em;
            font-weight: bold;
            margin-left: 5px;
        }

        .badge.gitignore {
            background: #e74c3c;
            color: white;
        }

        .badge.commit {
            background: #2ecc71;
            color: white;
        }

        .badge.new {
            background: #f39c12;
            color: white;
        }

        .step-list {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .step-list li {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-left: 4px solid #3498db;
            padding-left: 15px;
        }

        .step-list li.current {
            border-left-color: #2ecc71;
            background: #d5f4e6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒæ§‹ç¯‰ - è©³ç´°è¨­è¨ˆæ›¸</h1>

        <div class="warning">
            <strong>âš ï¸ ç¾åœ¨ã®å•é¡Œç‚¹:</strong> ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒãŒæœ¬ç•ªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šã—ã¦ã„ã‚‹ãŸã‚ã€é–‹ç™ºä½œæ¥­ä¸­ã«æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ã‚’èª¤ã£ã¦å¤‰æ›´ãƒ»å‰Šé™¤ã™ã‚‹ãƒªã‚¹ã‚¯ãŒã‚ã‚Šã¾ã™ã€‚
        </div>

        <h2>1. ç¾çŠ¶ã®ç’°å¢ƒæ§‹æˆï¼ˆå•é¡Œã®ã‚ã‚‹çŠ¶æ…‹ï¼‰</h2>

        <div class="env-diagram">
            <div class="env-title current">ç¾çŠ¶: ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºãŒæœ¬ç•ªDBã«æ¥ç¶šï¼ˆå±é™ºï¼ï¼‰</div>

            <div class="component-flow">
                <div class="component">
                    <div class="component-title">Frontend</div>
                    <div class="component-detail">localhost:5173</div>
                    <div class="component-detail">Vite Dev Server</div>
                </div>

                <div class="arrow">â†’</div>

                <div class="component">
                    <div class="component-title">Backend</div>
                    <div class="component-detail">localhost:3001</div>
                    <div class="component-detail">Node.js Express</div>
                </div>

                <div class="arrow">â†’</div>

                <div class="component danger">
                    <div class="component-title">âš ï¸ Database (PRD)</div>
                    <div class="component-detail">Railway Production</div>
                    <div class="component-detail">mainline:50142</div>
                </div>
            </div>

            <div class="config-box">
                ğŸ“ backend/.env â†’ DATABASE_URL=mainline:50142 (æœ¬ç•ªDB)<br>
                ğŸ“ frontend/.env.local â†’ VITE_API_URL=http://localhost:3001
            </div>
        </div>

        <h2>2. ç†æƒ³çš„ãªç’°å¢ƒæ§‹æˆï¼ˆ3ç’°å¢ƒåˆ†é›¢ï¼‰</h2>

        <h3>2-1. Local ç’°å¢ƒï¼ˆãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºï¼‰</h3>
        <div class="env-diagram">
            <div class="env-title development">Local ç’°å¢ƒ - ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º</div>

            <div class="component-flow">
                <div class="component">
                    <div class="component-title">Frontend</div>
                    <div class="component-detail">localhost:5173</div>
                    <div class="component-detail">Vite Dev Server</div>
                </div>

                <div class="arrow">â†’</div>

                <div class="component">
                    <div class="component-title">Backend</div>
                    <div class="component-detail">localhost:3001</div>
                    <div class="component-detail">Node.js Watch</div>
                </div>

                <div class="arrow">â†’</div>

                <div class="component">
                    <div class="component-title">Database (STG)</div>
                    <div class="component-detail">Railway Staging</div>
                    <div class="component-detail">switchyard:26491</div>
                </div>
            </div>

            <div class="config-box">
                ğŸ“ backend/.env.local â†’ DATABASE_URL=switchyard:26491 (ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°DB) + OPENAI_API_KEY=å€‹äººã®ã‚­ãƒ¼<br>
                ğŸ“ frontend/.env.local â†’ VITE_API_URL=http://localhost:3001
            </div>
        </div>

        <h3>2-2. Staging ç’°å¢ƒï¼ˆãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼ç”¨ï¼‰</h3>
        <div class="env-diagram">
            <div class="env-title staging">Staging ç’°å¢ƒ - ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼</div>

            <div class="component-flow">
                <div class="component">
                    <div class="component-title">Frontend</div>
                    <div class="component-detail">Vercel Preview</div>
                    <div class="component-detail">preview-*.vercel.app</div>
                </div>

                <div class="arrow">â†’</div>

                <div class="component">
                    <div class="component-title">Backend</div>
                    <div class="component-detail">Railway Staging</div>
                    <div class="component-detail">*-staging.railway.app</div>
                </div>

                <div class="arrow">â†’</div>

                <div class="component">
                    <div class="component-title">Database (STG)</div>
                    <div class="component-detail">Railway Staging</div>
                    <div class="component-detail">switchyard:26491</div>
                </div>
            </div>

            <div class="config-box">
                â˜ï¸ Railwayç’°å¢ƒå¤‰æ•°ï¼ˆstagingç’°å¢ƒï¼‰:<br>
                &nbsp;&nbsp;DATABASE_URL=switchyard:26491<br>
                &nbsp;&nbsp;RAILWAY_ENVIRONMENT_NAME=staging<br>
                <br>
                â˜ï¸ Vercelç’°å¢ƒå¤‰æ•°ï¼ˆPreviewç’°å¢ƒï¼‰:<br>
                &nbsp;&nbsp;VITE_API_URL=https://*-staging.railway.app
            </div>
        </div>

        <h3>2-3. Production ç’°å¢ƒï¼ˆæœ¬ç•ªé‹ç”¨ï¼‰</h3>
        <div class="env-diagram">
            <div class="env-title production">Production ç’°å¢ƒ - æœ¬ç•ªé‹ç”¨</div>

            <div class="component-flow">
                <div class="component">
                    <div class="component-title">Frontend</div>
                    <div class="component-detail">Vercel Production</div>
                    <div class="component-detail">shift-scheduler-ai.vercel.app</div>
                </div>

                <div class="arrow">â†’</div>

                <div class="component">
                    <div class="component-title">Backend</div>
                    <div class="component-detail">Railway Production</div>
                    <div class="component-detail">*-production.railway.app</div>
                </div>

                <div class="arrow">â†’</div>

                <div class="component">
                    <div class="component-title">Database (PRD)</div>
                    <div class="component-detail">Railway Production</div>
                    <div class="component-detail">mainline:50142</div>
                </div>
            </div>

            <div class="config-box">
                â˜ï¸ Railwayç’°å¢ƒå¤‰æ•°ï¼ˆproductionç’°å¢ƒï¼‰:<br>
                &nbsp;&nbsp;DATABASE_URL=mainline:50142<br>
                &nbsp;&nbsp;RAILWAY_ENVIRONMENT_NAME=production<br>
                <br>
                â˜ï¸ Vercelç’°å¢ƒå¤‰æ•°ï¼ˆProductionç’°å¢ƒï¼‰:<br>
                &nbsp;&nbsp;VITE_API_URL=https://*-production.railway.app
            </div>
        </div>

        <h2>3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæƒ…å ±ã®è©³ç´°</h2>

        <table>
            <thead>
                <tr>
                    <th>ç’°å¢ƒ</th>
                    <th>ãƒ›ã‚¹ãƒˆ</th>
                    <th>ãƒãƒ¼ãƒˆ</th>
                    <th>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹</th>
                    <th>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</th>
                    <th>ç”¨é€”</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>STG</strong></td>
                    <td>switchyard.proxy.rlwy.net</td>
                    <td>26491</td>
                    <td>railway</td>
                    <td>BWmHYBbE...</td>
                    <td>é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç”¨</td>
                </tr>
                <tr>
                    <td><strong>PRD</strong></td>
                    <td>mainline.proxy.rlwy.net</td>
                    <td>50142</td>
                    <td>railway</td>
                    <td>gkfRVoPv...</td>
                    <td>æœ¬ç•ªé‹ç”¨</td>
                </tr>
            </tbody>
        </table>

        <h2>4. ç’°å¢ƒå¤‰æ•°ã®è¨­å®šå ´æ‰€ãƒãƒˆãƒªã‚¯ã‚¹</h2>

        <h3>4-1. Backend</h3>
        <table>
            <thead>
                <tr>
                    <th>ç’°å¢ƒ</th>
                    <th>è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«/å ´æ‰€</th>
                    <th>DATABASE_URL</th>
                    <th>RAILWAY_ENVIRONMENT_NAME</th>
                    <th>NODE_ENV</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º</strong></td>
                    <td>.env.local</td>
                    <td>switchyard:26491</td>
                    <td>-</td>
                    <td>-</td>
                </tr>
                <tr>
                    <td><strong>Railway STG</strong></td>
                    <td>Railway Dashboardï¼ˆstagingç’°å¢ƒï¼‰</td>
                    <td>switchyard:26491</td>
                    <td>staging</td>
                    <td>production</td>
                </tr>
                <tr>
                    <td><strong>Railway PRD</strong></td>
                    <td>Railway Dashboardï¼ˆproductionç’°å¢ƒï¼‰</td>
                    <td>mainline:50142</td>
                    <td>production</td>
                    <td>production</td>
                </tr>
            </tbody>
        </table>

        <h3>4-2. Frontend</h3>
        <table>
            <thead>
                <tr>
                    <th>ç’°å¢ƒ</th>
                    <th>è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«/å ´æ‰€</th>
                    <th>VITE_API_URL</th>
                    <th>VITE_BACKEND_API_URL</th>
                    <th>MODE</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º</strong></td>
                    <td>.env.local</td>
                    <td>http://localhost:3001</td>
                    <td>http://localhost:3001</td>
                    <td>-</td>
                </tr>
                <tr>
                    <td><strong>Vercel Preview</strong></td>
                    <td>Vercel Dashboardï¼ˆPreviewï¼‰</td>
                    <td>https://stg.railway.app</td>
                    <td>https://stg.railway.app</td>
                    <td>staging</td>
                </tr>
                <tr>
                    <td><strong>Vercel Prod</strong></td>
                    <td>Vercel Dashboardï¼ˆProductionï¼‰</td>
                    <td>https://prd.railway.app</td>
                    <td>https://prd.railway.app</td>
                    <td>production</td>
                </tr>
            </tbody>
        </table>

        <h2>5. ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ</h2>

        <div class="file-tree">
            <div class="file-tree-item indent-0">
                <span class="file-tree-icon">ğŸ“</span>
                <span class="file-tree-name"><strong>shift-scheduler-ai/</strong></span>
            </div>

            <div class="file-tree-item indent-1">
                <span class="file-tree-icon">ğŸ“</span>
                <span class="file-tree-name"><strong>backend/</strong></span>
            </div>

            <div class="file-tree-item indent-2">
                <span class="file-tree-icon">ğŸ“„</span>
                <span class="file-tree-name">.env.local</span>
                <span class="badge gitignore">gitignoreå¿…é ˆ</span>
                <span class="file-tree-desc">ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨ï¼ˆDB: STG + OpenAI Keyç­‰ï¼‰</span>
            </div>

            <div class="file-tree-item indent-2">
                <span class="file-tree-icon">ğŸ“„</span>
                <span class="file-tree-name">.env.local.example</span>
                <span class="badge commit">ã‚³ãƒŸãƒƒãƒˆå¿…é ˆ</span>
                <span class="file-tree-desc">ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã®ã‚µãƒ³ãƒ—ãƒ«</span>
            </div>

            <div class="file-tree-item indent-2">
                <span class="file-tree-icon">ğŸ“„</span>
                <span class="file-tree-name">.env.staging</span>
                <span class="badge commit">ã‚³ãƒŸãƒƒãƒˆå¯</span>
                <span class="file-tree-desc">Railway STGç’°å¢ƒç”¨ï¼ˆå‚è€ƒï¼‰</span>
            </div>

            <div class="file-tree-item indent-2">
                <span class="file-tree-icon">ğŸ“„</span>
                <span class="file-tree-name">.env.production</span>
                <span class="badge commit">ã‚³ãƒŸãƒƒãƒˆå¯</span>
                <span class="file-tree-desc">Railway PRDç’°å¢ƒç”¨ï¼ˆå‚è€ƒï¼‰</span>
            </div>

            <div class="file-tree-item indent-2">
                <span class="file-tree-icon">ğŸ“</span>
                <span class="file-tree-name"><strong>src/</strong></span>
            </div>

            <div class="file-tree-item indent-3">
                <span class="file-tree-icon">ğŸ“</span>
                <span class="file-tree-name"><strong>config/</strong></span>
            </div>

            <div class="file-tree-item indent-4">
                <span class="file-tree-icon">ğŸ“„</span>
                <span class="file-tree-name">env.js</span>
                <span class="badge new">æ–°è¦ä½œæˆ</span>
                <span class="file-tree-desc">ç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿ãƒ­ã‚¸ãƒƒã‚¯</span>
            </div>

            <div class="file-tree-item indent-3">
                <span class="file-tree-icon">ğŸ“„</span>
                <span class="file-tree-name">server.js</span>
            </div>

            <div class="file-tree-item indent-1">
                <span class="file-tree-icon">ğŸ“</span>
                <span class="file-tree-name"><strong>frontend/</strong></span>
            </div>

            <div class="file-tree-item indent-2">
                <span class="file-tree-icon">ğŸ“„</span>
                <span class="file-tree-name">.env.local</span>
                <span class="badge gitignore">gitignoreå¿…é ˆ</span>
                <span class="file-tree-desc">ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨ï¼ˆAPI: localhost:3001ï¼‰</span>
            </div>

            <div class="file-tree-item indent-2">
                <span class="file-tree-icon">ğŸ“„</span>
                <span class="file-tree-name">.env.local.example</span>
                <span class="badge commit">ã‚³ãƒŸãƒƒãƒˆå¿…é ˆ</span>
                <span class="file-tree-desc">ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã®ã‚µãƒ³ãƒ—ãƒ«</span>
            </div>

            <div class="file-tree-item indent-2">
                <span class="file-tree-icon">ğŸ“„</span>
                <span class="file-tree-name">.env.staging</span>
                <span class="badge commit">ã‚³ãƒŸãƒƒãƒˆå¯</span>
                <span class="file-tree-desc">Vercel Previewç”¨ï¼ˆå‚è€ƒï¼‰</span>
            </div>

            <div class="file-tree-item indent-2">
                <span class="file-tree-icon">ğŸ“„</span>
                <span class="file-tree-name">.env.production</span>
                <span class="badge commit">ã‚³ãƒŸãƒƒãƒˆå¯</span>
                <span class="file-tree-desc">Vercel Prodç”¨ï¼ˆå‚è€ƒï¼‰</span>
            </div>

            <div class="file-tree-item indent-1">
                <span class="file-tree-icon">ğŸ“„</span>
                <span class="file-tree-name">.gitignore</span>
            </div>
        </div>

        <h2>6. ç’°å¢ƒå¤‰æ•°ã®èª­ã¿è¾¼ã¿ãƒ•ãƒ­ãƒ¼ï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰</h2>

        <h3>6-1. Backend</h3>
        <div class="code-block">
<pre>// backend/src/config/env.js (âœ… å®Ÿè£…å®Œäº†)

import dotenv from 'dotenv'
import { fileURLToPath } from 'url'
import { dirname, resolve } from 'path'

const __filename = fileURLToPath(import.meta.url)
const __dirname = dirname(__filename)

/**
 * ç’°å¢ƒå¤‰æ•°ã‚’èª­ã¿è¾¼ã‚€
 * èª­ã¿è¾¼ã¿å„ªå…ˆé †ä½:
 * 1. .env.local (ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨ã€gitignoreå¯¾è±¡)
 * 2. .env.{NODE_ENV} (ç’°å¢ƒåˆ¥è¨­å®š)
 * 3. .env (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š)
 */

const NODE_ENV = process.env.NODE_ENV || 'development'
const ROOT_DIR = resolve(__dirname, '../..')

console.log(`ğŸ”§ Loading environment: ${NODE_ENV}`)

// .env.local ã‚’æœ€å„ªå…ˆã§èª­ã¿è¾¼ã¿
const localEnvPath = resolve(ROOT_DIR, '.env.local')
const localResult = dotenv.config({ path: localEnvPath })

if (localResult.parsed) {
  console.log('âœ… Loaded .env.local')
} else {
  console.log('â„¹ï¸  .env.local not found (OK for cloud environments)')

  // .env.{NODE_ENV} ã‚’èª­ã¿è¾¼ã¿
  const envPath = resolve(ROOT_DIR, `.env.${NODE_ENV}`)
  const envResult = dotenv.config({ path: envPath })

  if (envResult.parsed) {
    console.log(`âœ… Loaded .env.${NODE_ENV}`)
  } else {
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã® .env ã‚’èª­ã¿è¾¼ã¿
    const defaultEnvPath = resolve(ROOT_DIR, '.env')
    const defaultResult = dotenv.config({ path: defaultEnvPath })

    if (defaultResult.parsed) {
      console.log('âœ… Loaded .env')
    } else {
      console.warn('âš ï¸  No .env files found')
    }
  }
}

// å¿…é ˆç’°å¢ƒå¤‰æ•°ã®ãƒã‚§ãƒƒã‚¯
const requiredEnvVars = ['DATABASE_URL', 'PORT']
const missingEnvVars = requiredEnvVars.filter(varName => !process.env[varName])

if (missingEnvVars.length > 0) {
  console.error('âŒ Missing required environment variables:', missingEnvVars.join(', '))
  console.error('ğŸ’¡ Please create .env.local file in backend/ directory')
  console.error('ğŸ’¡ You can copy from .env.local.example and fill in the values')
  process.exit(1)
}

console.log('âœ… All required environment variables are set')
console.log(`ğŸ“Š Environment: ${NODE_ENV}`)
console.log(`ğŸ—„ï¸  Database: ${process.env.DATABASE_URL?.replace(/:[^:@]+@/, ':****@')}`) // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒã‚¹ã‚¯

export default {
  NODE_ENV,
  PORT: process.env.PORT || 3001,
  DATABASE_URL: process.env.DATABASE_URL,
  OPENAI_API_KEY: process.env.OPENAI_API_KEY,
  CORS_ORIGIN: process.env.CORS_ORIGIN || 'http://localhost:5173',
}</pre>
        </div>

        <div class="code-block">
<pre>// backend/src/config/database.js (âœ… æ›´æ–°å®Œäº†)
import pkg from 'pg'
const { Pool } = pkg
import './env.js' // ç’°å¢ƒå¤‰æ•°ã‚’èª­ã¿è¾¼ã‚€ï¼ˆdotenv.config()å‰Šé™¤ï¼‰

const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false
})
// ... ä»¥ä¸‹æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰</pre>
        </div>

        <h3>6-2. Frontend (Vite)</h3>
        <p><strong>ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºï¼š</strong> Vite ã¯è‡ªå‹•çš„ã« <code>.env.local</code> ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚</p>
        <p><strong>ãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒï¼š</strong> Vercel ã®ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨ã—ã¾ã™ï¼ˆ.env ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä½¿ç”¨ã—ã¾ã›ã‚“ï¼‰ã€‚</p>

        <div class="code-block">
<pre># ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º
npm run dev  # .env.local ã‚’è‡ªå‹•èª­ã¿è¾¼ã¿

# ãƒ“ãƒ«ãƒ‰ï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤ç”¨ï¼‰
npm run build  # Vercelã®ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨</pre>
        </div>

        <h2>7. package.json ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æ›´æ–°</h2>

        <h3>7-1. Backend</h3>
        <div class="code-block">
<pre>{
  "scripts": {
    "dev": "node --watch src/server.js",
    "start": "node src/server.js"
  }
}</pre>
        </div>
        <p><strong>æ³¨:</strong> ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã¯ <code>.env.local</code> ã‚’è‡ªå‹•èª­ã¿è¾¼ã¿ã€‚ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã¯ Railway ã®ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨ã€‚</p>

        <h3>7-2. Frontend</h3>
        <div class="code-block">
<pre>{
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  }
}</pre>
        </div>
        <p><strong>æ³¨:</strong> ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã¯ <code>.env.local</code> ã‚’è‡ªå‹•èª­ã¿è¾¼ã¿ã€‚ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã¯ Vercel ã®ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨ã€‚</p>

        <h2>8. Railway/Vercel ã®ç’°å¢ƒè¨­å®š</h2>

        <h3>8-1. Railwayï¼ˆBackendï¼‰</h3>
        <div class="env-diagram">
            <div class="env-title">Railway Project: shift-scheduler-ai</div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                <div class="component">
                    <div class="component-title">Production ç’°å¢ƒï¼ˆæ—¢å­˜ï¼‰</div>
                    <div class="config-box" style="text-align: left; margin-top: 10px;">
                        DATABASE_URL=mainline:50142<br>
                        RAILWAY_ENVIRONMENT_NAME=production<br>
                        OPENAI_API_KEY=æœ¬ç•ªç”¨ã‚­ãƒ¼
                    </div>
                </div>

                <div class="component" style="border-color: #f39c12;">
                    <div class="component-title">Staging ç’°å¢ƒ ğŸ†•</div>
                    <div class="config-box" style="text-align: left; margin-top: 10px;">
                        DATABASE_URL=switchyard:26491<br>
                        RAILWAY_ENVIRONMENT_NAME=staging<br>
                        OPENAI_API_KEY=ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç”¨ã‚­ãƒ¼
                    </div>
                </div>
            </div>
        </div>

        <h3>8-2. Vercelï¼ˆFrontendï¼‰</h3>
        <div class="env-diagram">
            <div class="env-title">Vercel Project: shift-scheduler-ai</div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                <div class="component">
                    <div class="component-title">Production ç’°å¢ƒï¼ˆæ—¢å­˜ï¼‰</div>
                    <div class="config-box" style="text-align: left; margin-top: 10px;">
                        VITE_API_URL=https://*-production.railway.app<br>
                        VITE_BACKEND_API_URL=https://*-production.railway.app
                    </div>
                </div>

                <div class="component" style="border-color: #f39c12;">
                    <div class="component-title">Preview ç’°å¢ƒï¼ˆstagingï¼‰ ğŸ†•</div>
                    <div class="config-box" style="text-align: left; margin-top: 10px;">
                        VITE_API_URL=https://*-staging.railway.app<br>
                        VITE_BACKEND_API_URL=https://*-staging.railway.app
                    </div>
                </div>
            </div>
        </div>

        <h2>9. Vercelè¨­å®šï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰</h2>

        <h3>9-1. Backendç”¨vercel.json</h3>
        <div class="code-block">
<pre>// backend/vercel.json (âœ… ä½œæˆå®Œäº†)
{
  "version": 2,
  "builds": [
    {
      "src": "src/server.js",
      "use": "@vercel/node"
    }
  ],
  "routes": [
    {
      "src": "/(.*)",
      "dest": "src/server.js"
    }
  ],
  "env": {
    "NODE_ENV": "production"
  }
}</pre>
        </div>

        <h3>9-2. Frontendç”¨vercel.json</h3>
        <div class="code-block">
<pre>// frontend/vercel.json (âœ… ä½œæˆå®Œäº†)
{
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "framework": "vite",
  "rewrites": [
    {
      "source": "/(.*)",
      "destination": "/index.html"
    }
  ]
}</pre>
        </div>

        <h2>10. å®Ÿè£…ã®æ‰‹é †ã¨é€²æ—çŠ¶æ³</h2>

        <ol class="step-list">
            <li class="current">âœ… Phase 1: è¨­è¨ˆæ›¸ã®ä½œæˆãƒ»æ‰¿èª</li>
            <li class="current">âœ… Phase 2: Backendå®Ÿè£…
                <ul style="margin-left: 20px; margin-top: 5px;">
                    <li>âœ… <code>backend/src/config/env.js</code> è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ</li>
                    <li>âœ… <code>backend/.env.local</code> ä½œæˆï¼ˆSTG DBæ¥ç¶šï¼‰</li>
                    <li>âœ… <code>backend/.env.local.example</code> ä½œæˆï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰</li>
                    <li>âœ… <code>backend/.env.staging</code> ä½œæˆï¼ˆå‚è€ƒç”¨ï¼‰</li>
                    <li>âœ… <code>backend/.env.production</code> ä½œæˆï¼ˆå‚è€ƒç”¨ï¼‰</li>
                    <li>âœ… <code>backend/src/config/database.js</code> æ›´æ–°ï¼ˆdotenvå‰Šé™¤ï¼‰</li>
                    <li>âœ… <code>.gitignore</code> æ›´æ–°ï¼ˆ.env.staging/.env.productionã‚’ã‚³ãƒŸãƒƒãƒˆå¯¾è±¡ã«ï¼‰</li>
                    <li>âœ… ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®å‹•ä½œç¢ºèªï¼ˆSTGç’°å¢ƒDBã«æ¥ç¶šï¼‰</li>
                </ul>
            </li>
            <li class="current">âœ… Phase 3: Vercelè¨­å®šã¨ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †
                <ul style="margin-left: 20px; margin-top: 5px;">
                    <li>âœ… <code>backend/vercel.json</code> ä½œæˆ</li>
                    <li>âœ… <code>frontend/vercel.json</code> ä½œæˆ</li>
                    <li>âœ… <code>backend/README.md</code> æ›´æ–°ï¼ˆç’°å¢ƒè¨­å®šæ‰‹é †ã¨Vercelãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †ï¼‰</li>
                    <li>âœ… ãƒ«ãƒ¼ãƒˆ <code>vercel.json</code> å‰Šé™¤ï¼ˆfrontend/backendåˆ¥ã€…ã«ç®¡ç†ï¼‰</li>
                </ul>
            </li>
            <li>ğŸ“ Phase 4: ãƒ‡ãƒ—ãƒ­ã‚¤ã¨æ¤œè¨¼ï¼ˆæ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼‰
                <ul style="margin-left: 20px; margin-top: 5px;">
                    <li>â³ Vercelãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š</li>
                    <li>â³ stagingãƒ–ãƒ©ãƒ³ãƒã¸ãƒ—ãƒƒã‚·ãƒ¥ã—ã¦STGç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤</li>
                    <li>â³ STGç’°å¢ƒã§ã®å‹•ä½œç¢ºèª</li>
                    <li>â³ mainãƒ–ãƒ©ãƒ³ãƒã¸ãƒãƒ¼ã‚¸ã—ã¦PRDç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤</li>
                    <li>â³ PRDç’°å¢ƒã§ã®å‹•ä½œç¢ºèª</li>
                </ul>
            </li>
        </ol>

        <h2>11. å‹•ä½œç¢ºèªçµæœ</h2>

        <h3>11-1. ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒï¼ˆâœ… ç¢ºèªæ¸ˆã¿ï¼‰</h3>
        <div class="code-block">
<pre>$ npm run dev

ğŸ”§ Loading environment: development
âœ… Loaded .env.local
âœ… All required environment variables are set
ğŸ“Š Environment: development
ğŸ—„ï¸  Database: postgresql://postgres:****@switchyard.proxy.rlwy.net:26491/railway
ğŸš€ Backend server running on port 3001
âœ… Database connected successfully (timezone: Asia/Tokyo)</pre>
        </div>

        <div class="warning" style="background: #d4edda; border-left-color: #28a745;">
            <strong>âœ… ç¢ºèªäº‹é …:</strong>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>âœ… .env.localãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹</li>
                <li>âœ… STGç’°å¢ƒã®DBï¼ˆswitchyard:26491ï¼‰ã«æ¥ç¶šã—ã¦ã„ã‚‹</li>
                <li>âœ… ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒãƒ­ã‚°ã§ãƒã‚¹ã‚¯ã•ã‚Œã¦ã„ã‚‹</li>
                <li>âœ… å¿…é ˆç’°å¢ƒå¤‰æ•°ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå‹•ä½œã—ã¦ã„ã‚‹</li>
                <li>âœ… ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã‚’å‘¼ã³å‡ºã›ã‚‹</li>
            </ul>
        </div>

        <h2>12. ã¾ã¨ã‚</h2>

        <div class="warning" style="background: #d4edda; border-left-color: #28a745;">
            <strong>âœ… å®Ÿè£…å®Œäº†é …ç›®ï¼ˆPhase 2-3ï¼‰:</strong>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>âœ… ç’°å¢ƒå¤‰æ•°ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…ï¼ˆå„ªå…ˆé †ä½æ–¹å¼ï¼‰</li>
                <li>âœ… .env.local/.env.local.example/.env.staging/.env.productionãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ</li>
                <li>âœ… backend/src/config/env.jså®Ÿè£…</li>
                <li>âœ… database.jsæ›´æ–°ï¼ˆdotenvå‰Šé™¤ï¼‰</li>
                <li>âœ… .gitignoreæ›´æ–°</li>
                <li>âœ… ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã§ã®å‹•ä½œç¢ºèªï¼ˆSTG DBæ¥ç¶šï¼‰</li>
                <li>âœ… backend/vercel.jsonä½œæˆ</li>
                <li>âœ… frontend/vercel.jsonä½œæˆ</li>
                <li>âœ… README.mdæ›´æ–°ï¼ˆç’°å¢ƒè¨­å®šæ‰‹é †ã¨Vercelãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †ï¼‰</li>
            </ul>
        </div>

        <div class="warning" style="background: #d4edda; border-left-color: #28a745; margin-top: 20px;">
            <strong>âœ… ã“ã®è¨­è¨ˆã®ãƒ¡ãƒªãƒƒãƒˆ:</strong>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã§ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°DBã‚’ä½¿ç”¨ã—ã€æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ã‚’ä¿è­·</li>
                <li><code>.env.local</code> ã®ã¿ã§ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã‚’ç®¡ç†ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ï¼‰</li>
                <li><code>.env.local.example</code> ã§ã‚µãƒ³ãƒ—ãƒ«ã‚’æä¾›ã—ã€æ–°è¦é–‹ç™ºè€…ã®ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãŒå®¹æ˜“</li>
                <li>ç’°å¢ƒã”ã¨ã«è¨­å®šãŒæ˜ç¢ºã«åˆ†é›¢ã•ã‚Œã€ç®¡ç†ãŒå®¹æ˜“</li>
                <li>ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã§ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼å¾Œã€å®‰å…¨ã«æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤å¯èƒ½</li>
                <li>ãƒ•ãƒ­ãƒ³ãƒˆãƒ»ãƒãƒƒã‚¯ã¨ã‚‚ã« localhost ã§å‹•ä½œç¢ºèªã—ã¦ã‹ã‚‰ãƒ—ãƒƒã‚·ãƒ¥å¯èƒ½</li>
            </ul>
        </div>
    </div>
</body>
</html>