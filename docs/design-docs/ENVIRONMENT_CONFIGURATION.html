<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç’°å¢ƒè¨­å®šã®ä»•çµ„ã¿ - è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.7;
            color: #333;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 8px;
        }

        h1 {
            color: #2c3e50;
            border-bottom: 4px solid #3498db;
            padding-bottom: 15px;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        h2 {
            color: #2c3e50;
            margin-top: 50px;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-left: 5px solid #3498db;
            padding-left: 15px;
        }

        h3 {
            color: #34495e;
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        h4 {
            color: #555;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .flow-diagram {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin: 30px 0;
        }

        .flow-step {
            background: rgba(255,255,255,0.1);
            border-left: 4px solid #ffd700;
            padding: 20px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .flow-step h4 {
            color: #ffd700;
            margin-top: 0;
        }

        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        th {
            background: #3498db;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #dee2e6;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .env-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            margin: 0 5px;
        }

        .env-local {
            background: #2196f3;
            color: white;
        }

        .env-stg {
            background: #ff9800;
            color: white;
        }

        .env-prd {
            background: #4caf50;
            color: white;
        }

        .timeline {
            position: relative;
            padding-left: 40px;
            margin: 30px 0;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 4px;
            background: #3498db;
        }

        .timeline-item {
            position: relative;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -34px;
            top: 25px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #3498db;
            border: 4px solid white;
        }

        .component-box {
            background: #fff;
            border: 2px solid #3498db;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
        }

        .component-title {
            background: #3498db;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 1.1em;
            margin: -25px -25px 20px -25px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ç’°å¢ƒè¨­å®šã®ä»•çµ„ã¿ - è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</h1>

        <div class="info-box">
            <strong>ğŸ“‹ ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¤ã„ã¦</strong>
            <p style="margin-top: 10px;">
                ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆViteï¼‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆNode.jsï¼‰ã«ãŠã‘ã‚‹ç’°å¢ƒè¨­å®šã®ä»•çµ„ã¿ã‚’ã€<strong>ãƒ“ãƒ«ãƒ‰ â†’ ãƒ‡ãƒ—ãƒ­ã‚¤ â†’ èµ·å‹• â†’ å®Ÿè¡Œ</strong>ã¨ã„ã†æµã‚Œã«æ²¿ã£ã¦è©³ã—ãè§£èª¬ã—ã¾ã™ã€‚
            </p>
        </div>

        <h2>1. ç’°å¢ƒã®ç¨®é¡ã¨å®šç¾©</h2>

        <table>
            <thead>
                <tr>
                    <th>ç’°å¢ƒ</th>
                    <th>FE (Frontend)</th>
                    <th>BE (Backend)</th>
                    <th>DB (Database)</th>
                    <th>èª¬æ˜</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="env-badge env-local">LOCAL</span></td>
                    <td>localhost:5173</td>
                    <td>localhost:3001</td>
                    <td>STG ã¾ãŸã¯ PRD</td>
                    <td>é–‹ç™ºè€…ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³ã§å®Ÿè¡Œã€‚DBã¯ã‚¯ãƒ©ã‚¦ãƒ‰ã®STG/PRDã‚’ä½¿ç”¨</td>
                </tr>
                <tr>
                    <td><span class="env-badge env-stg">STG</span></td>
                    <td>Vercel (stg)</td>
                    <td>Railway (stg)</td>
                    <td>Railway (stg)</td>
                    <td>ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã€‚æœ¬ç•ªå‰ã®æ¤œè¨¼ç”¨</td>
                </tr>
                <tr>
                    <td><span class="env-badge env-prd">PRD</span></td>
                    <td>Vercel (prd)</td>
                    <td>Railway (prd)</td>
                    <td>Railway (prd)</td>
                    <td>æœ¬ç•ªç’°å¢ƒã€‚å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½¿ç”¨</td>
                </tr>
            </tbody>
        </table>

        <div class="warning-box">
            <strong>âš ï¸ é‡è¦ãªå‰æ</strong>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>ãƒ­ãƒ¼ã‚«ãƒ«DBã¯å­˜åœ¨ã—ãªã„ â†’ DBã¯å¸¸ã«STGã¾ãŸã¯PRD</li>
                <li>FE/BEã®ç’°å¢ƒã¯ã€Œå®Ÿè¡Œå ´æ‰€ã€ã‚’ç¤ºã™</li>
                <li>DBç’°å¢ƒã¯ã€Œæ¥ç¶šå…ˆã€ã‚’ç¤ºã™</li>
            </ul>
        </div>

        <h2>2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (Vite) ã®ç’°å¢ƒè¨­å®š</h2>

        <div class="flow-diagram">
            <h3 style="color: white; margin-top: 0;">ğŸ“¦ Vite ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼</h3>

            <div class="flow-step">
                <h4>STEP 1: ãƒ“ãƒ«ãƒ‰æ™‚ï¼ˆBuild Timeï¼‰</h4>
                <p><strong>å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°:</strong> <code>npm run build</code> ã¾ãŸã¯ <code>vite build</code></p>
                <p><strong>å‡¦ç†å†…å®¹:</strong></p>
                <ol style="margin-left: 20px; margin-top: 10px;">
                    <li>Vite ãŒç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ï¼ˆå„ªå…ˆé †ä½é †ï¼‰</li>
                    <li><code>.env.local</code> â†’ <code>.env.{MODE}</code> â†’ <code>.env</code></li>
                    <li><code>VITE_</code> ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã®å¤‰æ•°ã®ã¿ãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã«å…¬é–‹ã•ã‚Œã‚‹</li>
                    <li>ç’°å¢ƒå¤‰æ•°ã¯ <strong>ãƒ“ãƒ«ãƒ‰æ™‚ã«é™çš„ã«åŸ‹ã‚è¾¼ã¾ã‚Œã‚‹</strong>ï¼ˆãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã§ã¯å¤‰æ›´ä¸å¯ï¼‰</li>
                </ol>
            </div>

            <div class="flow-step">
                <h4>STEP 2: ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ï¼ˆDeploy Timeï¼‰</h4>
                <p><strong>å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°:</strong> Vercelã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤</p>
                <p><strong>å‡¦ç†å†…å®¹:</strong></p>
                <ol style="margin-left: 20px; margin-top: 10px;">
                    <li>Vercelã®ç’°å¢ƒå¤‰æ•°è¨­å®šã‚’èª­ã¿è¾¼ã‚€</li>
                    <li>ç’°å¢ƒã”ã¨ï¼ˆProduction / Previewï¼‰ã«ç•°ãªã‚‹å¤‰æ•°ã‚’è¨­å®šå¯èƒ½</li>
                    <li>ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œæ™‚ã«ç’°å¢ƒå¤‰æ•°ãŒé©ç”¨ã•ã‚Œã‚‹</li>
                </ol>
            </div>

            <div class="flow-step">
                <h4>STEP 3: èµ·å‹•ãƒ»å®Ÿè¡Œæ™‚ï¼ˆRuntimeï¼‰</h4>
                <p><strong>å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°:</strong> ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿</p>
                <p><strong>å‡¦ç†å†…å®¹:</strong></p>
                <ol style="margin-left: 20px; margin-top: 10px;">
                    <li><code>AppHeader.jsx</code> ã® <code>getEnvironment()</code> é–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã‚‹</li>
                    <li><code>import.meta.env.VITE_ENV</code> ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆãƒ“ãƒ«ãƒ‰æ™‚ã«åŸ‹ã‚è¾¼ã¾ã‚ŒãŸå€¤ï¼‰</li>
                    <li>å€¤ãŒã‚ã‚‹å ´åˆ â†’ ãã®ç’°å¢ƒã‚’è¡¨ç¤º</li>
                    <li>å€¤ãŒãªã„å ´åˆ â†’ <code>window.location.hostname</code> ã‹ã‚‰è‡ªå‹•åˆ¤å®š</li>
                    <li>ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã« <code>/api/health</code> ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¦BE/DBç’°å¢ƒã‚’å–å¾—</li>
                </ol>
            </div>
        </div>

        <div class="component-box">
            <div class="component-title">ğŸ“„ frontend/.env.local (LOCALç’°å¢ƒ)</div>
            <div class="code-block">
<pre># Environment (ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œ)
VITE_ENV=local

# Backend API URL - local development
VITE_API_URL=http://localhost:3001
VITE_BACKEND_API_URL=http://localhost:3001

# Frontend URL - local development
VITE_FRONTEND_URL=http://localhost:5173</pre>
            </div>
            <p><strong>èª­ã¿è¾¼ã¾ã‚Œã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°:</strong> <code>npm run dev</code> ã¾ãŸã¯ <code>vite build</code></p>
            <p><strong>å„ªå…ˆé †ä½:</strong> æœ€å„ªå…ˆï¼ˆ.env ã‚ˆã‚Šå„ªå…ˆã•ã‚Œã‚‹ï¼‰</p>
        </div>

        <div class="component-box">
            <div class="component-title">ğŸ“„ frontend/src/components/shared/AppHeader.jsx</div>
            <div class="code-block">
<pre>const getEnvironment = () => {
  // ç’°å¢ƒå¤‰æ•°ã§æ˜ç¤ºçš„ã«æŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ãã‚Œã‚’å„ªå…ˆ
  const envVar = import.meta.env.VITE_ENV

  if (envVar) {
    const envMap = {
      local: { name: 'LOCAL', label: 'ãƒ­ãƒ¼ã‚«ãƒ«', color: 'blue' },
      stg: { name: 'STG', label: 'ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°', color: 'yellow' },
      prd: { name: 'PRD', label: 'æœ¬ç•ª', color: 'green' }
    }
    return envMap[envVar.toLowerCase()] || envMap.local
  }

  // ãƒ›ã‚¹ãƒˆåã‹ã‚‰è‡ªå‹•åˆ¤å®š
  const hostname = window.location.hostname

  if (hostname === 'localhost' || hostname === '127.0.0.1') {
    return { name: 'LOCAL', label: 'ãƒ­ãƒ¼ã‚«ãƒ«', color: 'blue' }
  } else if (hostname.includes('shift-scheduler-ai-stg.vercel.app')) {
    return { name: 'STG', label: 'ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°', color: 'yellow' }
  } else if (hostname.includes('vercel.app') &&
             !hostname.includes('shift-scheduler-ai.vercel.app')) {
    return { name: 'DEV', label: 'é–‹ç™º', color: 'amber' }
  } else {
    return { name: 'PRD', label: 'æœ¬ç•ª', color: 'green' }
  }
}</pre>
            </div>
            <p><strong>å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°:</strong> ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ï¼ˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒã‚¦ãƒ³ãƒˆæ™‚ï¼‰</p>
            <p><strong>åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯:</strong></p>
            <ol style="margin-left: 20px; margin-top: 10px;">
                <li><code>VITE_ENV</code> ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ â†’ ãã®å€¤ã‚’ä½¿ç”¨</li>
                <li>è¨­å®šã•ã‚Œã¦ã„ãªã„ â†’ <code>hostname</code> ã‹ã‚‰è‡ªå‹•åˆ¤å®š</li>
            </ol>
        </div>

        <h2>3. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ (Node.js) ã®ç’°å¢ƒè¨­å®š</h2>

        <div class="flow-diagram">
            <h3 style="color: white; margin-top: 0;">ğŸ–¥ï¸ Node.js ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼</h3>

            <div class="flow-step">
                <h4>STEP 1: ãƒ“ãƒ«ãƒ‰æ™‚ï¼ˆBuild Timeï¼‰</h4>
                <p><strong>å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°:</strong> ãƒ‡ãƒ—ãƒ­ã‚¤æº–å‚™ï¼ˆTypeScriptã®å ´åˆã¯ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ï¼‰</p>
                <p><strong>å‡¦ç†å†…å®¹:</strong></p>
                <ol style="margin-left: 20px; margin-top: 10px;">
                    <li>Node.jsã¯ãƒ“ãƒ«ãƒ‰ä¸è¦ï¼ˆã¾ãŸã¯è»½å¾®ãªãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ï¼‰</li>
                    <li>ç’°å¢ƒå¤‰æ•°ã¯ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã§èª­ã¿è¾¼ã¾ã‚Œã‚‹</li>
                </ol>
            </div>

            <div class="flow-step">
                <h4>STEP 2: ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ï¼ˆDeploy Timeï¼‰</h4>
                <p><strong>å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°:</strong> Railwayã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤</p>
                <p><strong>å‡¦ç†å†…å®¹:</strong></p>
                <ol style="margin-left: 20px; margin-top: 10px;">
                    <li>Railwayã®ç’°å¢ƒå¤‰æ•°è¨­å®šã‚’èª­ã¿è¾¼ã‚€</li>
                    <li><code>RAILWAY_ENVIRONMENT_NAME</code> ãŒè‡ªå‹•è¨­å®šã•ã‚Œã‚‹</li>
                    <li>ç’°å¢ƒã”ã¨ï¼ˆproduction / stagingï¼‰ã«ç•°ãªã‚‹å¤‰æ•°ã‚’è¨­å®šå¯èƒ½</li>
                </ol>
            </div>

            <div class="flow-step">
                <h4>STEP 3: èµ·å‹•æ™‚ï¼ˆStartupï¼‰</h4>
                <p><strong>å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°:</strong> <code>npm run dev</code> ã¾ãŸã¯ <code>node src/server.js</code></p>
                <p><strong>å‡¦ç†å†…å®¹:</strong></p>
                <ol style="margin-left: 20px; margin-top: 10px;">
                    <li><code>dotenv</code> ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€</li>
                    <li>èª­ã¿è¾¼ã¿é †åºï¼ˆå„ªå…ˆé †ä½é †ï¼‰ï¼š<br>
                        <code>.env.local</code> â†’ <code>.env</code> â†’ ã‚·ã‚¹ãƒ†ãƒ ç’°å¢ƒå¤‰æ•°
                    </li>
                    <li><code>backend/src/config/env.js</code> ãŒç’°å¢ƒå¤‰æ•°ã‚’æ¤œè¨¼</li>
                    <li>å¿…é ˆç’°å¢ƒå¤‰æ•°ï¼ˆ<code>DATABASE_URL</code>, <code>PORT</code>ï¼‰ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼</li>
                </ol>
            </div>

            <div class="flow-step">
                <h4>STEP 4: å®Ÿè¡Œæ™‚ï¼ˆRuntimeï¼‰</h4>
                <p><strong>å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°:</strong> <code>/api/health</code> ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</p>
                <p><strong>å‡¦ç†å†…å®¹:</strong></p>
                <ol style="margin-left: 20px; margin-top: 10px;">
                    <li><code>getEnvironment()</code> é–¢æ•°ãŒ <code>APP_ENV</code> ã‚’ãƒã‚§ãƒƒã‚¯</li>
                    <li>å€¤ãŒã‚ã‚‹å ´åˆ â†’ ãã®ç’°å¢ƒã‚’è¿”ã™</li>
                    <li>å€¤ãŒãªã„å ´åˆ â†’ <code>RAILWAY_ENVIRONMENT_NAME</code> ã‹ã‚‰åˆ¤å®š</li>
                    <li><code>getDbEnvironment()</code> é–¢æ•°ãŒ <code>DB_ENV</code> ã‚’ãƒã‚§ãƒƒã‚¯</li>
                    <li>å€¤ãŒãªã„å ´åˆ â†’ <code>DATABASE_URL</code> ã‹ã‚‰åˆ¤å®š</li>
                </ol>
            </div>
        </div>

        <div class="component-box">
            <div class="component-title">ğŸ“„ backend/.env.local (LOCALç’°å¢ƒ)</div>
            <div class="code-block">
<pre># ç’°å¢ƒè¨­å®šï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œã€STG DBã«æ¥ç¶šï¼‰
NODE_ENV=development
APP_ENV=local
DB_ENV=stg

# Railway PostgreSQLæ¥ç¶šæƒ…å ±ï¼ˆSTG/é–‹ç™ºç’°å¢ƒï¼‰
DATABASE_URL=postgresql://postgres:****@switchyard.proxy.rlwy.net:26491/railway

# ã‚µãƒ¼ãƒãƒ¼è¨­å®š
PORT=3001

# CORSè¨­å®š
CORS_ORIGIN=http://localhost:5173</pre>
            </div>
            <p><strong>èª­ã¿è¾¼ã¾ã‚Œã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°:</strong> ã‚µãƒ¼ãƒãƒ¼èµ·å‹•æ™‚ï¼ˆ<code>npm run dev</code>ï¼‰</p>
            <p><strong>å„ªå…ˆé †ä½:</strong> æœ€å„ªå…ˆï¼ˆ.env ã‚ˆã‚Šå„ªå…ˆã•ã‚Œã‚‹ï¼‰</p>
        </div>

        <div class="component-box">
            <div class="component-title">ğŸ“„ backend/src/config/env.js</div>
            <div class="code-block">
<pre>const NODE_ENV = process.env.NODE_ENV || 'development'
const ROOT_DIR = resolve(__dirname, '../..')

// .env.local ã‚’æœ€å„ªå…ˆã§èª­ã¿è¾¼ã¿
const localEnvPath = resolve(ROOT_DIR, '.env.local')
const localResult = dotenv.config({ path: localEnvPath })

if (localResult.parsed) {
  console.log('âœ… Loaded .env.local')
} else {
  // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: .env.{NODE_ENV}
  const envPath = resolve(ROOT_DIR, `.env.${NODE_ENV}`)
  const envResult = dotenv.config({ path: envPath })

  if (envResult.parsed) {
    console.log(`âœ… Loaded .env.${NODE_ENV}`)
  } else {
    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: .env
    const defaultEnvPath = resolve(ROOT_DIR, '.env')
    dotenv.config({ path: defaultEnvPath })
    console.log('âœ… Loaded .env')
  }
}

// å¿…é ˆç’°å¢ƒå¤‰æ•°ã®æ¤œè¨¼
const requiredEnvVars = ['DATABASE_URL', 'PORT']
const missingEnvVars = requiredEnvVars.filter(varName => !process.env[varName])

if (missingEnvVars.length > 0) {
  console.error('âŒ Missing required environment variables:', missingEnvVars.join(', '))
  process.exit(1)
}</pre>
            </div>
            <p><strong>å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°:</strong> ã‚µãƒ¼ãƒãƒ¼èµ·å‹•æ™‚ã«æœ€åˆã«å®Ÿè¡Œã•ã‚Œã‚‹</p>
            <p><strong>å½¹å‰²:</strong> ç’°å¢ƒå¤‰æ•°ã®èª­ã¿è¾¼ã¿ã¨æ¤œè¨¼</p>
        </div>

        <div class="component-box">
            <div class="component-title">ğŸ“„ backend/src/server.js - /api/health ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ</div>
            <div class="code-block">
<pre>app.get('/api/health', (req, res) => {
  // ç’°å¢ƒå¤‰æ•°ã‚’å–å¾—
  const appEnv = process.env.APP_ENV // local/stg/prd
  const dbEnv = process.env.DB_ENV // stg/prd
  const railwayEnv = process.env.RAILWAY_ENVIRONMENT_NAME

  // BEç’°å¢ƒåˆ¤å®š
  const getEnvironment = () => {
    // APP_ENVãŒæ˜ç¤ºçš„ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ãã‚Œã‚’ä½¿ç”¨
    if (appEnv) {
      return appEnv.toUpperCase()
    }

    // Railwayã®ç’°å¢ƒå¤‰æ•°ã§åˆ¤å®š
    if (!railwayEnv) {
      return 'LOCAL'
    }

    if (railwayEnv === 'production') {
      return 'PRD'
    } else {
      return 'STG'
    }
  }

  // DBç’°å¢ƒåˆ¤å®š
  const getDbEnvironment = () => {
    // DB_ENVãŒæ˜ç¤ºçš„ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ãã‚Œã‚’ä½¿ç”¨
    if (dbEnv) {
      return dbEnv.toUpperCase()
    }

    const dbUrl = process.env.DATABASE_URL || ''

    // Railway DBã®å ´åˆ
    if (dbUrl.includes('railway.app') ||
        dbUrl.includes('railway') ||
        dbUrl.includes('rlwy.net')) {

      // æ˜ç¤ºçš„ã«æœ¬ç•ªDBç”¨ã®è­˜åˆ¥å­ãŒã‚ã‚‹å ´åˆ
      if (dbUrl.includes('-production-') || dbUrl.includes('production.')) {
        return 'PRD'
      }

      // RAILWAY_ENVIRONMENT_NAMEã§åˆ¤å®š
      if (railwayEnv === 'production') {
        return 'PRD'
      } else if (railwayEnv) {
        return 'STG'
      }

      // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯STG
      return 'STG'
    }

    return 'UNKNOWN'
  }

  res.json({
    success: true,
    backend: {
      environment: getEnvironment(),
      hostname: req.hostname,
      port: PORT,
      nodeEnv: process.env.NODE_ENV || 'development'
    },
    database: {
      environment: getDbEnvironment(),
      connected: true,
      host: process.env.PGHOST || 'unknown'
    }
  })
})</pre>
            </div>
            <p><strong>å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°:</strong> ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚</p>
            <p><strong>è¿”ã‚Šå€¤:</strong> BEç’°å¢ƒã¨DBç’°å¢ƒã®æƒ…å ±</p>
        </div>

        <h2>4. ç’°å¢ƒåˆ¤å®šã®å„ªå…ˆé †ä½</h2>

        <h3>4-1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (FE)</h3>

        <div class="timeline">
            <div class="timeline-item">
                <h4>å„ªå…ˆåº¦ 1: <code>VITE_ENV</code> ç’°å¢ƒå¤‰æ•°</h4>
                <p>ãƒ“ãƒ«ãƒ‰æ™‚ã«åŸ‹ã‚è¾¼ã¾ã‚ŒãŸæ˜ç¤ºçš„ãªç’°å¢ƒè¨­å®š</p>
                <div class="code-block">VITE_ENV=local â†’ LOCAL<br>VITE_ENV=stg â†’ STG<br>VITE_ENV=prd â†’ PRD</div>
            </div>

            <div class="timeline-item">
                <h4>å„ªå…ˆåº¦ 2: ãƒ›ã‚¹ãƒˆåï¼ˆhostnameï¼‰è‡ªå‹•åˆ¤å®š</h4>
                <p><code>window.location.hostname</code> ã‹ã‚‰åˆ¤å®š</p>
                <div class="code-block">localhost / 127.0.0.1 â†’ LOCAL<br>shift-scheduler-ai-stg.vercel.app â†’ STG<br>xxxxx-username.vercel.app â†’ DEV (Preview)<br>shift-scheduler-ai.vercel.app â†’ PRD</div>
            </div>
        </div>

        <h3>4-2. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ (BE)</h3>

        <div class="timeline">
            <div class="timeline-item">
                <h4>å„ªå…ˆåº¦ 1: <code>APP_ENV</code> ç’°å¢ƒå¤‰æ•°</h4>
                <p>æ˜ç¤ºçš„ã«è¨­å®šã•ã‚ŒãŸãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ç’°å¢ƒ</p>
                <div class="code-block">APP_ENV=local â†’ LOCAL<br>APP_ENV=stg â†’ STG<br>APP_ENV=prd â†’ PRD</div>
            </div>

            <div class="timeline-item">
                <h4>å„ªå…ˆåº¦ 2: <code>RAILWAY_ENVIRONMENT_NAME</code></h4>
                <p>RailwayãŒè‡ªå‹•è¨­å®šã™ã‚‹ç’°å¢ƒå¤‰æ•°</p>
                <div class="code-block">æœªè¨­å®š â†’ LOCAL<br>production â†’ PRD<br>ãã®ä»– â†’ STG</div>
            </div>
        </div>

        <h3>4-3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ (DB)</h3>

        <div class="timeline">
            <div class="timeline-item">
                <h4>å„ªå…ˆåº¦ 1: <code>DB_ENV</code> ç’°å¢ƒå¤‰æ•°</h4>
                <p>æ˜ç¤ºçš„ã«è¨­å®šã•ã‚ŒãŸDBç’°å¢ƒ</p>
                <div class="code-block">DB_ENV=stg â†’ STG<br>DB_ENV=prd â†’ PRD</div>
            </div>

            <div class="timeline-item">
                <h4>å„ªå…ˆåº¦ 2: <code>DATABASE_URL</code> è§£æ</h4>
                <p>æ¥ç¶šæ–‡å­—åˆ—ã‹ã‚‰ç’°å¢ƒã‚’æ¨æ¸¬</p>
                <div class="code-block">localhost / 127.0.0.1 â†’ LOCAL<br>-production- / production. å«ã‚€ â†’ PRD<br>railway.app / rlwy.net å«ã‚€ â†’ STG (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)</div>
            </div>

            <div class="timeline-item">
                <h4>å„ªå…ˆåº¦ 3: <code>RAILWAY_ENVIRONMENT_NAME</code></h4>
                <p>Railwayã®ç’°å¢ƒå¤‰æ•°ã‚’ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯</p>
                <div class="code-block">production â†’ PRD<br>ãã®ä»– â†’ STG</div>
            </div>
        </div>

        <h2>5. ç’°å¢ƒåˆ¥ã®è¨­å®šä¾‹</h2>

        <h3>5-1. LOCALç’°å¢ƒï¼ˆé–‹ç™ºè€…ã®ãƒã‚·ãƒ³ï¼‰</h3>

        <table>
            <thead>
                <tr>
                    <th>ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ</th>
                    <th>ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«</th>
                    <th>ä¸»è¦è¨­å®š</th>
                    <th>è¡¨ç¤º</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Frontend</strong></td>
                    <td><code>frontend/.env.local</code></td>
                    <td><code>VITE_ENV=local</code><br><code>VITE_API_URL=http://localhost:3001</code></td>
                    <td><span class="env-badge env-local">LOCAL</span></td>
                </tr>
                <tr>
                    <td><strong>Backend</strong></td>
                    <td><code>backend/.env.local</code></td>
                    <td><code>APP_ENV=local</code><br><code>DB_ENV=stg</code></td>
                    <td><span class="env-badge env-local">LOCAL</span></td>
                </tr>
                <tr>
                    <td><strong>Database</strong></td>
                    <td>ï¼ˆæ¥ç¶šå…ˆï¼‰</td>
                    <td><code>DATABASE_URL=postgresql://...@switchyard.proxy.rlwy.net:26491/railway</code></td>
                    <td><span class="env-badge env-stg">STG</span></td>
                </tr>
            </tbody>
        </table>

        <div class="success-box">
            <strong>âœ… LOCALç’°å¢ƒã®ç‰¹å¾´:</strong>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>FE/BEã¯ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³ã§å®Ÿè¡Œ â†’ è¡¨ç¤º: LOCAL</li>
                <li>DBã¯ã‚¯ãƒ©ã‚¦ãƒ‰ï¼ˆSTGï¼‰ã«æ¥ç¶š â†’ è¡¨ç¤º: STG</li>
                <li><code>.env.local</code> ã‚’ä½¿ã£ã¦æ˜ç¤ºçš„ã«ç’°å¢ƒã‚’æŒ‡å®š</li>
            </ul>
        </div>

        <h3>5-2. STGç’°å¢ƒï¼ˆVercel + Railwayï¼‰</h3>

        <table>
            <thead>
                <tr>
                    <th>ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ</th>
                    <th>ç’°å¢ƒå¤‰æ•°è¨­å®š</th>
                    <th>ä¸»è¦è¨­å®š</th>
                    <th>è¡¨ç¤º</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Frontend</strong></td>
                    <td>Vercelç’°å¢ƒå¤‰æ•°</td>
                    <td><code>VITE_ENV=stg</code><br><code>VITE_API_URL=https://api-stg.example.com</code></td>
                    <td><span class="env-badge env-stg">STG</span></td>
                </tr>
                <tr>
                    <td><strong>Backend</strong></td>
                    <td>Railwayç’°å¢ƒå¤‰æ•°</td>
                    <td><code>RAILWAY_ENVIRONMENT_NAME=staging</code><br><code>APP_ENV=stg</code></td>
                    <td><span class="env-badge env-stg">STG</span></td>
                </tr>
                <tr>
                    <td><strong>Database</strong></td>
                    <td>Railway DB</td>
                    <td><code>DATABASE_URL=postgresql://...@...rlwy.net:...</code></td>
                    <td><span class="env-badge env-stg">STG</span></td>
                </tr>
            </tbody>
        </table>

        <h3>5-3. PRDç’°å¢ƒï¼ˆVercel + Railwayï¼‰</h3>

        <table>
            <thead>
                <tr>
                    <th>ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ</th>
                    <th>ç’°å¢ƒå¤‰æ•°è¨­å®š</th>
                    <th>ä¸»è¦è¨­å®š</th>
                    <th>è¡¨ç¤º</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Frontend</strong></td>
                    <td>Vercelç’°å¢ƒå¤‰æ•°</td>
                    <td><code>VITE_ENV=prd</code><br><code>VITE_API_URL=https://api.example.com</code></td>
                    <td><span class="env-badge env-prd">PRD</span></td>
                </tr>
                <tr>
                    <td><strong>Backend</strong></td>
                    <td>Railwayç’°å¢ƒå¤‰æ•°</td>
                    <td><code>RAILWAY_ENVIRONMENT_NAME=production</code><br><code>APP_ENV=prd</code></td>
                    <td><span class="env-badge env-prd">PRD</span></td>
                </tr>
                <tr>
                    <td><strong>Database</strong></td>
                    <td>Railway DB</td>
                    <td><code>DATABASE_URL=postgresql://...-production-...</code></td>
                    <td><span class="env-badge env-prd">PRD</span></td>
                </tr>
            </tbody>
        </table>

        <h2>6. ç”»é¢è¡¨ç¤ºã®ä»•çµ„ã¿</h2>

        <div class="component-box">
            <div class="component-title">ğŸ–¥ï¸ AppHeader.jsx ã§ã®ç’°å¢ƒè¡¨ç¤º</div>

            <h4>è¡¨ç¤ºå†…å®¹</h4>
            <div class="code-block">
<pre>&lt;span className="font-semibold"&gt;{environment.name}&lt;/span&gt;  â† FEç’°å¢ƒ
&lt;span&gt;FE:{environment.name}&lt;/span&gt;                    â† FEç’°å¢ƒï¼ˆè©³ç´°ï¼‰
&lt;span&gt;BE:{backendEnv}&lt;/span&gt;                         â† BEç’°å¢ƒ
&lt;span&gt;DB:{dbEnv}&lt;/span&gt;                              â† DBç’°å¢ƒ</pre>
            </div>

            <h4>å–å¾—ãƒ•ãƒ­ãƒ¼</h4>
            <ol style="margin-left: 20px; margin-top: 15px;">
                <li><strong>FEç’°å¢ƒ:</strong> <code>getEnvironment()</code> ã§å–å¾—ï¼ˆ<code>VITE_ENV</code> ã¾ãŸã¯ hostnameï¼‰</li>
                <li><strong>BE/DBç’°å¢ƒ:</strong> <code>useEffect</code> ã§ <code>/api/health</code> ã‚’å‘¼ã³å‡ºã—ã¦å–å¾—</li>
            </ol>

            <div class="code-block">
<pre>useEffect(() => {
  const fetchHealthInfo = async () => {
    try {
      const response = await fetch(`${BACKEND_API_URL}/api/health`)
      const data = await response.json()

      if (data.success) {
        setBackendEnv(data.backend.environment)  // BEç’°å¢ƒã‚’è¨­å®š
        setDbEnv(data.database.environment)      // DBç’°å¢ƒã‚’è¨­å®š
      }
    } catch (error) {
      console.error('Failed to fetch health info:', error)
      setBackendEnv('ERROR')
      setDbEnv('ERROR')
    }
  }

  fetchHealthInfo()
}, [])</pre>
            </div>
        </div>

        <h2>7. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</h2>

        <h3>7-1. ã€ŒPRDã€ã¨è¡¨ç¤ºã•ã‚Œã¦ã—ã¾ã†</h3>

        <div class="warning-box">
            <strong>åŸå› :</strong>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>ç’°å¢ƒå¤‰æ•°ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ãªã„</li>
                <li>ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„</li>
                <li>ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯ã§PRDã«ãªã£ã¦ã„ã‚‹</li>
            </ul>
            <strong style="display: block; margin-top: 15px;">è§£æ±ºç­–:</strong>
            <ol style="margin-left: 20px; margin-top: 10px;">
                <li>FE: <code>VITE_ENV=local</code> ãŒ <code>.env.local</code> ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª</li>
                <li>BE: <code>APP_ENV=local</code> ã¨ <code>DB_ENV=stg</code> ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª</li>
                <li>ã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•ã—ã¦ç’°å¢ƒå¤‰æ•°ã‚’å†èª­ã¿è¾¼ã¿</li>
                <li>ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ãƒãƒ¼ãƒ‰ãƒªãƒ­ãƒ¼ãƒ‰ï¼ˆCtrl+Shift+R / Cmd+Shift+Rï¼‰</li>
            </ol>
        </div>

        <h3>7-2. BE/DB ãŒã€ŒERRORã€ã¨è¡¨ç¤ºã•ã‚Œã‚‹</h3>

        <div class="warning-box">
            <strong>åŸå› :</strong>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒèµ·å‹•ã—ã¦ã„ãªã„</li>
                <li><code>/api/health</code> ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„</li>
                <li>CORS ã‚¨ãƒ©ãƒ¼</li>
            </ul>
            <strong style="display: block; margin-top: 15px;">è§£æ±ºç­–:</strong>
            <ol style="margin-left: 20px; margin-top: 10px;">
                <li><code>curl http://localhost:3001/api/health</code> ã§ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ãƒ†ã‚¹ãƒˆ</li>
                <li>ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ­ã‚°ã‚’ç¢ºèªï¼ˆãƒãƒ¼ãƒˆ3001ãŒä½¿ç”¨ä¸­ã§ãªã„ã‹ï¼‰</li>
                <li><code>CORS_ORIGIN</code> ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª</li>
            </ol>
        </div>

        <h3>7-3. ç’°å¢ƒå¤‰æ•°ãŒåæ˜ ã•ã‚Œãªã„</h3>

        <div class="warning-box">
            <strong>Vite (Frontend):</strong>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>ç’°å¢ƒå¤‰æ•°ã¯<strong>ãƒ“ãƒ«ãƒ‰æ™‚ã«åŸ‹ã‚è¾¼ã¾ã‚Œã‚‹</strong> â†’ ãƒ“ãƒ«ãƒ‰å¾Œã¯å¤‰æ›´ä¸å¯</li>
                <li><code>.env.local</code> ã‚’å¤‰æ›´ã—ãŸã‚‰ <code>npm run dev</code> ã‚’å†èµ·å‹•</li>
                <li><code>VITE_</code> ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãŒå¿…è¦</li>
            </ul>
            <strong style="display: block; margin-top: 15px;">Node.js (Backend):</strong>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>ç’°å¢ƒå¤‰æ•°ã¯<strong>èµ·å‹•æ™‚ã«èª­ã¿è¾¼ã¾ã‚Œã‚‹</strong> â†’ ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•ãŒå¿…è¦</li>
                <li><code>.env.local</code> ãŒ <code>.gitignore</code> ã«å«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª</li>
                <li><code>dotenv</code> ãŒæ­£ã—ãã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª</li>
            </ul>
        </div>

        <h2>8. ã¾ã¨ã‚</h2>

        <div class="success-box">
            <h3 style="margin-top: 0;">ğŸ¯ é‡è¦ãƒã‚¤ãƒ³ãƒˆ</h3>
            <ol style="margin-left: 20px; margin-top: 15px; line-height: 2;">
                <li><strong>FEç’°å¢ƒå¤‰æ•°ã¯ãƒ“ãƒ«ãƒ‰æ™‚ã«åŸ‹ã‚è¾¼ã¾ã‚Œã‚‹</strong> â†’ å¤‰æ›´å¾Œã¯ãƒ“ãƒ«ãƒ‰ãŒå¿…è¦</li>
                <li><strong>BEç’°å¢ƒå¤‰æ•°ã¯èµ·å‹•æ™‚ã«èª­ã¿è¾¼ã¾ã‚Œã‚‹</strong> â†’ å¤‰æ›´å¾Œã¯å†èµ·å‹•ãŒå¿…è¦</li>
                <li><strong>æ˜ç¤ºçš„ãªç’°å¢ƒå¤‰æ•°ï¼ˆVITE_ENV, APP_ENV, DB_ENVï¼‰ãŒæœ€å„ªå…ˆ</strong></li>
                <li><strong>.env.local ã¯æœ€å„ªå…ˆã§èª­ã¿è¾¼ã¾ã‚Œã‚‹</strong> â†’ ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã«æœ€é©</li>
                <li><strong>ç’°å¢ƒè¡¨ç¤º = å®Ÿè¡Œå ´æ‰€</strong>ã€<strong>DBè¡¨ç¤º = æ¥ç¶šå…ˆ</strong></li>
                <li><strong>ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã§ã¯FE/BEã¯LOCALã€DBã¯STG</strong></li>
            </ol>
        </div>

        <div class="info-box" style="margin-top: 30px;">
            <strong>ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</strong>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li><a href="./STAGING_ENVIRONMENT_DESIGN.html">ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒæ§‹ç¯‰ - è©³ç´°è¨­è¨ˆæ›¸</a></li>
                <li><a href="https://vitejs.dev/guide/env-and-mode.html">Vite - Env Variables and Modes</a></li>
                <li><a href="https://github.com/motdotla/dotenv">dotenv - GitHub</a></li>
            </ul>
        </div>

    </div>
</body>
</html>

        <h2>9. å®Ÿè£…å®Œäº†çŠ¶æ³ï¼ˆ2025-11-25ï¼‰</h2>

        <div class="success-box">
            <h3 style="margin-top: 0;">âœ… ãƒ¢ãƒ€ãƒ³ãªç’°å¢ƒå¤‰æ•°ç®¡ç†ã¸ã®ç§»è¡Œå®Œäº†</h3>
            <p style="margin-top: 15px;"><strong>å®Ÿæ–½æ—¥:</strong> 2025å¹´11æœˆ25æ—¥</p>
        </div>

        <h3>9-1. å®Ÿæ–½ã—ãŸå¤‰æ›´</h3>

        <table>
            <thead>
                <tr>
                    <th>ã‚«ãƒ†ã‚´ãƒª</th>
                    <th>å¤‰æ›´å†…å®¹</th>
                    <th>ç†ç”±</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>ä¸è¦ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤</strong></td>
                    <td>
                        <code>backend/.env.staging</code><br>
                        <code>backend/.env.production</code><br>
                        <code>backend/.env.local.example</code>
                    </td>
                    <td>ãƒ¢ãƒ€ãƒ³ãªæ§‹æˆã§ã¯ã‚¯ãƒ©ã‚¦ãƒ‰UIã§ç®¡ç†ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ä¸è¦ã€‚</td>
                </tr>
                <tr>
                    <td><strong>.gitignore æ›´æ–°</strong></td>
                    <td>
                        <code>.env</code> ã¨ <code>.env.example</code> ã‚’ã‚³ãƒŸãƒƒãƒˆå¯èƒ½ã«<br>
                        <code>.env.local</code> ã¯å¼•ãç¶šãé™¤å¤–
                    </td>
                    <td>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯å…±æœ‰ã€ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¯å€‹äººç®¡ç†</td>
                </tr>
                <tr>
                    <td><strong>ç’°å¢ƒåˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯</strong></td>
                    <td>
                        <code>APP_ENV</code>, <code>DB_ENV</code> ç’°å¢ƒå¤‰æ•°ã‚’å„ªå…ˆ<br>
                        <code>VITE_ENV</code> ã§FEç’°å¢ƒã‚’æ˜ç¤º
                    </td>
                    <td>æ˜ç¤ºçš„ãªè¨­å®šã§ç’°å¢ƒã‚’ç¢ºå®Ÿã«åˆ¤åˆ¥</td>
                </tr>
                <tr>
                    <td><strong>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ</strong></td>
                    <td>
                        <code>ENVIRONMENT_CONFIGURATION.html</code><br>
                        ç’°å¢ƒè¨­å®šã®ä»•çµ„ã¿ã‚’è©³ç´°ã«è¨˜è¼‰
                    </td>
                    <td>é–‹ç™ºè€…ãŒç†è§£ã—ã‚„ã™ã„ã‚ˆã†ã«</td>
                </tr>
            </tbody>
        </table>

        <h3>9-2. ç¾åœ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ</h3>

        <div class="component-box">
            <div class="component-title">ğŸ“‚ Backend</div>
            <div class="code-block">
<pre>backend/
â”œâ”€â”€ .env               âœ… ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆã‚³ãƒŸãƒƒãƒˆæ¸ˆã¿ï¼‰
â”œâ”€â”€ .env.example       âœ… ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆã‚³ãƒŸãƒƒãƒˆæ¸ˆã¿ï¼‰
â”œâ”€â”€ .env.local         ğŸ”’ ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨ï¼ˆ.gitignoreï¼‰
â”œâ”€â”€ .gitignore         âœ… ãƒ¢ãƒ€ãƒ³ãªè¨­å®šã«æ›´æ–°
â””â”€â”€ src/
    â”œâ”€â”€ config/
    â”‚   â””â”€â”€ env.js     âœ… ç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿ãƒ»æ¤œè¨¼
    â””â”€â”€ server.js      âœ… /api/health ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ</pre>
            </div>
        </div>

        <div class="component-box">
            <div class="component-title">ğŸ“‚ Frontend</div>
            <div class="code-block">
<pre>frontend/
â”œâ”€â”€ .env               âœ… ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆã‚³ãƒŸãƒƒãƒˆæ¸ˆã¿ï¼‰
â”œâ”€â”€ .env.example       âœ… ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆã‚³ãƒŸãƒƒãƒˆæ¸ˆã¿ï¼‰
â”œâ”€â”€ .env.local         ğŸ”’ ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨ï¼ˆ.gitignoreï¼‰
â””â”€â”€ src/
    â””â”€â”€ components/
        â””â”€â”€ shared/
            â””â”€â”€ AppHeader.jsx  âœ… ç’°å¢ƒè¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯</pre>
            </div>
        </div>

        <h3>9-3. LOCALç’°å¢ƒã®è¨­å®šå€¤</h3>

        <div class="component-box">
            <div class="component-title">ğŸ“„ backend/.env.local (ç¾åœ¨ã®è¨­å®š)</div>
            <div class="code-block">
<pre># ç’°å¢ƒè¨­å®šï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œã€STG DBã«æ¥ç¶šï¼‰
NODE_ENV=development
APP_ENV=local
DB_ENV=stg

# Railway PostgreSQLæ¥ç¶šæƒ…å ±ï¼ˆSTG/é–‹ç™ºç’°å¢ƒï¼‰
DATABASE_URL=postgresql://postgres:****@switchyard.proxy.rlwy.net:26491/railway

# ã‚µãƒ¼ãƒãƒ¼è¨­å®š
PORT=3001

# CORSè¨­å®š
CORS_ORIGIN=http://localhost:5173</pre>
            </div>
        </div>

        <div class="component-box">
            <div class="component-title">ğŸ“„ frontend/.env.local (ç¾åœ¨ã®è¨­å®š)</div>
            <div class="code-block">
<pre># Environment (ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œ)
VITE_ENV=local

# Backend API URL - local development
VITE_API_URL=http://localhost:3001
VITE_BACKEND_API_URL=http://localhost:3001

# Frontend URL - local development
VITE_FRONTEND_URL=http://localhost:5173</pre>
            </div>
        </div>

        <h3>9-4. STGç’°å¢ƒã§ã®å‹•ä½œç¢ºèªæº–å‚™</h3>

        <div class="info-box">
            <h4 style="margin-top: 0;">ğŸ¯ STGç’°å¢ƒã¨ã¯</h4>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li><strong>Frontend:</strong> Vercel ã«ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆ<code>shift-scheduler-ai-stg.vercel.app</code>ï¼‰</li>
                <li><strong>Backend:</strong> Railway ã«ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆSTGç’°å¢ƒï¼‰</li>
                <li><strong>Database:</strong> Railway PostgreSQLï¼ˆSTGï¼‰</li>
            </ul>
        </div>

        <h4>æº–å‚™çŠ¶æ³ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</h4>

        <table>
            <thead>
                <tr>
                    <th>é …ç›®</th>
                    <th>çŠ¶æ…‹</th>
                    <th>ç¢ºèªæ–¹æ³•</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ</strong></td>
                    <td><span class="env-badge env-local">LOCAL</span></td>
                    <td>
                        âœ… FE: <code>npm run dev</code> â†’ http://localhost:5173<br>
                        âœ… BE: <code>npm run dev</code> â†’ http://localhost:3001<br>
                        âœ… DB: STGç’°å¢ƒã«æ¥ç¶š
                    </td>
                </tr>
                <tr>
                    <td><strong>ç’°å¢ƒè¡¨ç¤º</strong></td>
                    <td>ç¢ºèªä¸­</td>
                    <td>
                        ç”»é¢å³ä¸Šã«<br>
                        FE:LOCAL â†’ BE:LOCAL â†’ DB:STG<br>
                        ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã¯ãš
                    </td>
                </tr>
                <tr>
                    <td><strong>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹</strong></td>
                    <td>âœ… æ§‹ç¯‰æ¸ˆã¿</td>
                    <td>
                        <code>node scripts/run-ddl-dml-stg.mjs</code> å®Ÿè¡Œæ¸ˆã¿<br>
                        - ãƒ†ãƒŠãƒ³ãƒˆ3: Stand Banh Mi<br>
                        - ã‚¹ã‚¿ãƒƒãƒ•: 51å<br>
                        - åº—èˆ—: 5åº—èˆ—<br>
                        - ã‚·ãƒ•ãƒˆ: 3,077ä»¶
                    </td>
                </tr>
                <tr>
                    <td><strong>Vercelè¨­å®š</strong></td>
                    <td>â³ æœªå®Ÿæ–½</td>
                    <td>
                        STGç’°å¢ƒã®ç’°å¢ƒå¤‰æ•°è¨­å®š:<br>
                        - <code>VITE_ENV=stg</code><br>
                        - <code>VITE_API_URL=https://api-stg.railway.app</code>
                    </td>
                </tr>
                <tr>
                    <td><strong>Railwayè¨­å®š</strong></td>
                    <td>â³ æœªå®Ÿæ–½</td>
                    <td>
                        STGç’°å¢ƒã®ç’°å¢ƒå¤‰æ•°è¨­å®š:<br>
                        - <code>APP_ENV=stg</code><br>
                        - <code>DB_ENV=stg</code><br>
                        - <code>DATABASE_URL</code> (STG DB)
                    </td>
                </tr>
            </tbody>
        </table>

        <h3>9-5. å‹•ä½œç¢ºèªæ‰‹é †ï¼ˆLOCALç’°å¢ƒï¼‰</h3>

        <div class="timeline">
            <div class="timeline-item">
                <h4>STEP 1: ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ç¢ºèª</h4>
                <div class="code-block">
<pre># Backend
cd backend
npm run dev
# â†’ ğŸš€ Backend server running on port 3001

# Frontend (åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«)
cd frontend
npm run dev
# â†’ Local: http://localhost:5173/</pre>
                </div>
            </div>

            <div class="timeline-item">
                <h4>STEP 2: Health Endpointç¢ºèª</h4>
                <div class="code-block">
<pre>curl http://localhost:3001/api/health | jq .

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
{
  "success": true,
  "backend": {
    "environment": "LOCAL",
    "hostname": "localhost",
    "port": "3001",
    "nodeEnv": "development"
  },
  "database": {
    "environment": "STG",
    "connected": true,
    "host": "mainline.proxy.rlwy.net"
  }
}</pre>
                </div>
            </div>

            <div class="timeline-item">
                <h4>STEP 3: ç”»é¢è¡¨ç¤ºç¢ºèª</h4>
                <p>ãƒ–ãƒ©ã‚¦ã‚¶ã§ <code>http://localhost:5173</code> ã‚’é–‹ã</p>
                <p><strong>ç¢ºèªãƒã‚¤ãƒ³ãƒˆ:</strong></p>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>ç”»é¢å³ä¸Šã®ç’°å¢ƒãƒãƒƒã‚¸: <span class="env-badge env-local">LOCAL</span></li>
                    <li>è©³ç´°è¡¨ç¤º: FE:LOCAL â†’ BE:LOCAL â†’ DB:STG</li>
                </ul>
            </div>

            <div class="timeline-item">
                <h4>STEP 4: ãƒ‡ãƒ¼ã‚¿å–å¾—ç¢ºèª</h4>
                <p>ãƒ†ãƒŠãƒ³ãƒˆ3ã®ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª</p>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹</li>
                    <li>åº—èˆ—ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹</li>
                    <li>ã‚·ãƒ•ãƒˆãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹</li>
                </ul>
            </div>
        </div>

        <h3>9-6. æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆSTGç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤ï¼‰</h3>

        <div class="warning-box">
            <strong>â³ STGç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤æº–å‚™</strong>
            <p style="margin-top: 10px;">LOCALç’°å¢ƒã§ã®å‹•ä½œç¢ºèªãŒå®Œäº†ã—ãŸã‚‰ã€ä»¥ä¸‹ã®æ‰‹é †ã§STGç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ï¼š</p>
            <ol style="margin-left: 20px; margin-top: 10px;">
                <li><strong>Railwayã«ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤</strong>
                    <ul style="margin-left: 20px;">
                        <li>ç’°å¢ƒå¤‰æ•°è¨­å®šï¼ˆAPP_ENV=stg, DB_ENV=stgï¼‰</li>
                        <li>DATABASE_URLã‚’STG DBã«è¨­å®š</li>
                    </ul>
                </li>
                <li><strong>Vercelã«ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤</strong>
                    <ul style="margin-left: 20px;">
                        <li>ç’°å¢ƒå¤‰æ•°è¨­å®šï¼ˆVITE_ENV=stgï¼‰</li>
                        <li>VITE_API_URLã‚’Railway URLã«è¨­å®š</li>
                    </ul>
                </li>
                <li><strong>STGç’°å¢ƒã§å‹•ä½œç¢ºèª</strong>
                    <ul style="margin-left: 20px;">
                        <li>https://shift-scheduler-ai-stg.vercel.app ã«ã‚¢ã‚¯ã‚»ã‚¹</li>
                        <li>ç’°å¢ƒè¡¨ç¤ºãŒ FE:STG â†’ BE:STG â†’ DB:STG ã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª</li>
                    </ul>
                </li>
            </ol>
        </div>

    </div>
</body>
</html>
