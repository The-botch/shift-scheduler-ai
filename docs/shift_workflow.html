<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>シフト登録業務フロー図</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8fafc;
            border-bottom: 2px solid #e2e8f0;
            padding: 0 40px;
        }

        .tab {
            padding: 20px 30px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            color: #64748b;
            transition: all 0.3s;
            font-size: 1.05em;
        }

        .tab:hover {
            background: #e0e7ff;
            color: #3b82f6;
        }

        .tab.active {
            color: #1e3a8a;
            border-bottom-color: #3b82f6;
            background: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .workflow-container {
            padding: 40px;
            overflow-x: auto;
        }

        .swimlane-table {
            width: 100%;
            min-width: 1600px;
            border-collapse: collapse;
            table-layout: fixed;
        }

        .swimlane-table th {
            background: #1e3a8a;
            color: white;
            padding: 15px;
            font-weight: 600;
            border: 2px solid #1e40af;
            text-align: center;
        }

        .swimlane-table th:first-child {
            width: 150px;
        }

        .swimlane-table td {
            border: 2px solid #e2e8f0;
            padding: 20px;
            vertical-align: top;
            position: relative;
        }

        .swimlane-table td:first-child {
            background: #f8fafc;
            font-weight: 700;
            color: #1e3a8a;
            text-align: center;
            font-size: 1.1em;
            width: 150px;
        }

        .phase-header {
            padding: 10px;
            font-size: 1.1em;
        }

        .sub-header {
            padding: 12px;
            font-size: 0.95em;
            font-weight: 500;
        }

        .process-box {
            background: white;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .process-box.staff {
            border-color: #10b981;
            background: #f0fdf4;
        }

        .process-box.manager {
            border-color: #f59e0b;
            background: #fffbeb;
        }

        .process-box.decision {
            border-color: #ec4899;
            background: #fdf2f8;
            border-style: dashed;
        }

        .process-box h4 {
            color: #1e3a8a;
            margin-bottom: 8px;
            font-size: 1em;
        }

        .process-box p {
            color: #475569;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .process-box ul {
            color: #475569;
            font-size: 0.9em;
            line-height: 1.6;
            margin-left: 20px;
        }

        .empty-cell {
            background: #fafafa;
        }

        .legend {
            padding: 30px 40px;
            background: #f8fafc;
            border-top: 2px solid #e2e8f0;
        }

        .legend h3 {
            color: #1e3a8a;
            margin-bottom: 15px;
        }

        .legend-items {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-box {
            width: 40px;
            height: 40px;
            border-radius: 5px;
            border: 2px solid;
        }

        .legend-box.staff {
            border-color: #10b981;
            background: #f0fdf4;
        }

        .legend-box.manager {
            border-color: #f59e0b;
            background: #fffbeb;
        }

        .legend-box.decision {
            border-color: #ec4899;
            background: #fdf2f8;
            border-style: dashed;
        }

        @media print {
            body {
                background: white;
            }
            .container {
                box-shadow: none;
            }
        }

        .note {
            background: #dbeafe;
            border-left: 4px solid #3b82f6;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .note h4 {
            color: #1e3a8a;
            margin-bottom: 8px;
        }

        .note p {
            color: #1e40af;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>シフト登録業務フロー図</h1>
            <p>スタッフ・管理者の役割別プロセス</p>
            <p style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">作成日：2025年11月19日</p>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('workflow')">業務フロー</div>
            <div class="tab" onclick="showTab('status')">ステータス遷移</div>
            <div class="tab" onclick="showTab('change')">シフト変更</div>
        </div>

        <div id="workflow" class="tab-content active">
            <div class="workflow-container">
                <div class="note" style="margin-bottom: 30px;">
                    <h4>📖 より詳しい情報について</h4>
                    <p>業務フローの詳細な説明や技術的な実装については、<strong><a href="docs/ai_shift_flow_mvp.html" style="color: #1e3a8a; text-decoration: underline;">docs/ai_shift_flow_mvp.html</a></strong> をご参照ください。</p>
                </div>
            <table class="swimlane-table">
                <thead>
                    <tr>
                        <th rowspan="2">役割</th>
                        <th class="phase-header" colspan="3">フェーズ1<br/><small style="font-weight: normal; font-size: 0.85em;">シフト希望提出・第1案作成</small></th>
                        <th class="phase-header" colspan="3">フェーズ2<br/><small style="font-weight: normal; font-size: 0.85em;">第2案作成・希望反映</small></th>
                        <th class="phase-header" colspan="1">フェーズ3<br/><small style="font-weight: normal; font-size: 0.85em;">シフト確定</small></th>
                    </tr>
                    <tr>
                        <th class="sub-header">シフト希望募集</th>
                        <th class="sub-header">第1案作成</th>
                        <th class="sub-header">第1案承認</th>
                        <th class="sub-header">第2案作成</th>
                        <th class="sub-header">希望照合・調整</th>
                        <th class="sub-header">第2案承認</th>
                        <th class="sub-header">確定シフト閲覧</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- シフト作成者の行 -->
                    <tr>
                        <td>👔<br/>シフト作成者<br/><small>(店長・<br/>管理者)</small></td>
                        <td class="empty-cell"></td>
                        <td>
                            <div class="process-box manager">
                                <h4>第1案作成</h4>
                                <ul>
                                    <li>前月コピー<br/>または</li>
                                    <li>CSVアップロード</li>
                                    <li>シフト編集</li>
                                </ul>
                            </div>
                        </td>
                        <td>
                            <div class="process-box manager">
                                <h4>第1案承認</h4>
                                <ul>
                                    <li>内容確認</li>
                                    <li>労働時間確認</li>
                                    <li>承認ボタン</li>
                                </ul>
                            </div>
                        </td>
                        <td>
                            <div class="process-box manager">
                                <h4>第2案作成</h4>
                                <p>第1案をベースにコピーして作成開始</p>
                            </div>
                        </td>
                        <td>
                            <div class="process-box decision">
                                <h4>希望との衝突確認</h4>
                                <p><strong>衝突がある場合:</strong></p>
                                <ul>
                                    <li>Conflictリスト確認</li>
                                    <li>AI修正アシスタント起動</li>
                                    <li>修正提案を適用</li>
                                    <li>手動で微調整</li>
                                </ul>
                                <p style="margin-top:10px;"><strong>衝突がない場合:</strong></p>
                                <ul>
                                    <li>そのまま次へ</li>
                                </ul>
                            </div>
                        </td>
                        <td>
                            <div class="process-box manager">
                                <h4>第2案承認</h4>
                                <ul>
                                    <li>最終確認</li>
                                    <li>全体バランス確認</li>
                                    <li>承認ボタン</li>
                                    <li>シフト確定</li>
                                </ul>
                            </div>
                        </td>
                        <td>
                            <div class="process-box manager">
                                <h4>全スタッフシフト閲覧</h4>
                                <p>History画面で全体スケジュールを確認</p>
                            </div>
                        </td>
                    </tr>

                    <!-- スタッフの行 -->
                    <tr>
                        <td>👤<br/>スタッフ<br/><small>(社員・<br/>アルバイト)</small></td>
                        <td colspan="3">
                            <div class="process-box staff">
                                <h4>シフト希望提出</h4>
                                <ul>
                                    <li>希望日を選択</li>
                                    <li>時間帯を選択</li>
                                    <li>提出ボタン</li>
                                </ul>
                                <p style="margin-top: 10px; font-size: 0.85em; color: #059669;">
                                    ※ フェーズ1の期間中、随時提出可能
                                </p>
                                <p style="margin-top: 10px; font-size: 0.85em; color: #dc2626;">
                                    ⚠️ 募集開始のタイミング：検討中
                                </p>
                            </div>
                        </td>
                        <td class="empty-cell"></td>
                        <td class="empty-cell"></td>
                        <td class="empty-cell"></td>
                        <td>
                            <div class="process-box staff">
                                <h4>自分のシフトを閲覧</h4>
                                <p>History画面で確定シフトを確認</p>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>

            <div class="note">
                <h4>💡 業務フローのポイント</h4>
                <p>
                    <strong>フェーズ1（シフト希望提出・第1案作成）</strong>: 管理者がシフト希望募集を開始し、スタッフが希望を提出しながら、管理者は前月ベースで第1案を作成・承認<br/>
                    <strong>フェーズ2（第2案作成・希望反映）</strong>: 第1案をベースに、スタッフの希望を反映させて調整し、承認<br/>
                    <strong>フェーズ3（シフト確定）</strong>: 第2案が承認されたシフトをスタッフが閲覧<br/>
                    <strong>AI活用</strong>: 希望との衝突を自動検出し、修正案をAIが提案
                </p>
            </div>

            <div class="legend">
                <h3>凡例</h3>
                <div class="legend-items">
                    <div class="legend-item">
                        <div class="legend-box staff"></div>
                        <span>スタッフのアクション</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box manager"></div>
                        <span>シフト作成者のアクション</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box decision"></div>
                        <span>判断・分岐ポイント</span>
                    </div>
                </div>
            </div>
        </div>
        </div>

        <!-- ステータス遷移タブ -->
        <div id="status" class="tab-content">
            <div class="workflow-container">
                <h2 style="color: #1e3a8a; margin-bottom: 30px;">シフト計画のステータス遷移</h2>

                <div class="note">
                    <h4>ステータス遷移の概要</h4>
                    <p>シフト計画は「DRAFT（下書き）」→「APPROVED（承認済み）」の2つのステータスを持ち、承認ボタンをクリックすることで遷移します。</p>
                </div>

                <table style="width: 100%; border-collapse: collapse; margin: 30px 0;">
                    <thead>
                        <tr style="background: #1e3a8a; color: white;">
                            <th style="padding: 15px; border: 2px solid #1e40af;">シフト種別</th>
                            <th style="padding: 15px; border: 2px solid #1e40af;">ステータス</th>
                            <th style="padding: 15px; border: 2px solid #1e40af;">編集可否</th>
                            <th style="padding: 15px; border: 2px solid #1e40af;">削除可否</th>
                            <th style="padding: 15px; border: 2px solid #1e40af;">システム制約</th>
                            <th style="padding: 15px; border: 2px solid #1e40af;">遷移トリガー</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td rowspan="2" style="padding: 15px; border: 2px solid #e2e8f0; background: #fffbeb; font-weight: bold; vertical-align: middle;">第1案<br/>(plan_type='FIRST')</td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0; text-align: center;">
                                <span style="background: #fef3c7; color: #92400e; padding: 5px 15px; border-radius: 5px; font-weight: bold;">DRAFT</span>
                            </td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0; text-align: center;">
                                <span style="color: #10b981; font-weight: bold; font-size: 1.2em;">✓</span><br/>
                                <small>全ての編集が可能</small>
                            </td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0; text-align: center;">
                                <span style="color: #10b981; font-weight: bold; font-size: 1.2em;">✓</span><br/>
                                <small>プラン削除可能</small>
                            </td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0;">
                                <ul style="margin: 0; padding-left: 20px; line-height: 1.8;">
                                    <li>シフトの追加・更新・削除が自由</li>
                                    <li>スタッフの配置変更可能</li>
                                    <li>時間帯の調整可能</li>
                                </ul>
                            </td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0;">
                                <strong>手動承認</strong><br/>
                                管理者が「第1案承認」ボタンをクリック
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 15px; border: 2px solid #e2e8f0; text-align: center;">
                                <span style="background: #dcfce7; color: #166534; padding: 5px 15px; border-radius: 5px; font-weight: bold;">APPROVED</span>
                            </td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0; text-align: center;">
                                <span style="color: #ef4444; font-weight: bold; font-size: 1.2em;">✗</span><br/>
                                <small>編集不可</small>
                            </td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0; text-align: center;">
                                <span style="color: #ef4444; font-weight: bold; font-size: 1.2em;">✗</span><br/>
                                <small>削除不可</small>
                            </td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0;">
                                <ul style="margin: 0; padding-left: 20px; line-height: 1.8;">
                                    <li><strong style="color: #dc2626;">シフト内容の変更不可</strong></li>
                                    <li>第2案作成の前提条件となる</li>
                                    <li>読み取り専用で表示のみ</li>
                                </ul>
                            </td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0; color: #64748b;">
                                <em>最終ステータス（遷移なし）</em>
                            </td>
                        </tr>
                        <tr style="border-top: 3px solid #cbd5e1;">
                            <td rowspan="2" style="padding: 15px; border: 2px solid #e2e8f0; background: #fdf2f8; font-weight: bold; vertical-align: middle;">第2案<br/>(plan_type='SECOND')</td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0; text-align: center;">
                                <span style="background: #fef3c7; color: #92400e; padding: 5px 15px; border-radius: 5px; font-weight: bold;">DRAFT</span>
                            </td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0; text-align: center;">
                                <span style="color: #10b981; font-weight: bold; font-size: 1.2em;">✓</span><br/>
                                <small>全ての編集が可能</small>
                            </td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0; text-align: center;">
                                <span style="color: #10b981; font-weight: bold; font-size: 1.2em;">✓</span><br/>
                                <small>プラン削除可能</small>
                            </td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0;">
                                <ul style="margin: 0; padding-left: 20px; line-height: 1.8;">
                                    <li><strong style="color: #dc2626;">第1案がAPPROVED必須</strong></li>
                                    <li>希望シフトとの照合機能あり</li>
                                    <li>AI修正アシスタント利用可能</li>
                                    <li>シフトの追加・更新・削除が自由</li>
                                </ul>
                            </td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0;">
                                <strong>手動承認</strong><br/>
                                管理者が「第2案承認」ボタンをクリック
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 15px; border: 2px solid #e2e8f0; text-align: center;">
                                <span style="background: #dcfce7; color: #166534; padding: 5px 15px; border-radius: 5px; font-weight: bold;">APPROVED</span>
                            </td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0; text-align: center;">
                                <span style="color: #ef4444; font-weight: bold; font-size: 1.2em;">✗</span><br/>
                                <small>編集不可</small>
                            </td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0; text-align: center;">
                                <span style="color: #ef4444; font-weight: bold; font-size: 1.2em;">✗</span><br/>
                                <small>削除不可</small>
                            </td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0;">
                                <ul style="margin: 0; padding-left: 20px; line-height: 1.8;">
                                    <li><strong style="color: #166534;">シフト確定</strong></li>
                                    <li>スタッフへの公開が可能</li>
                                    <li>History画面で閲覧可能</li>
                                    <li><strong style="color: #dc2626;">変更・削除不可</strong></li>
                                </ul>
                            </td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0; color: #64748b;">
                                <em>最終ステータス（遷移なし）</em>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <h2 style="color: #1e3a8a; margin: 50px 0 30px 0;">ステータス遷移フロー</h2>

                <div style="background: #f8fafc; padding: 40px; border-radius: 10px; border: 2px solid #e2e8f0;">
                    <div style="display: flex; align-items: center; justify-content: space-around; flex-wrap: wrap; gap: 20px;">
                        <!-- 第1案作成 -->
                        <div style="text-align: center;">
                            <div style="background: white; border: 3px solid #f59e0b; border-radius: 10px; padding: 20px; min-width: 200px;">
                                <h3 style="color: #1e3a8a; margin-bottom: 10px;">第1案作成</h3>
                                <p style="font-size: 0.9em; color: #64748b;">前月コピー or CSV</p>
                            </div>
                        </div>

                        <div style="font-size: 30px; color: #3b82f6;">→</div>

                        <!-- DRAFT状態 -->
                        <div style="text-align: center;">
                            <div style="background: #fef3c7; border: 3px solid #f59e0b; border-radius: 10px; padding: 20px; min-width: 200px;">
                                <h3 style="color: #92400e; margin-bottom: 10px;">DRAFT</h3>
                                <p style="font-size: 0.9em; color: #78350f;">編集・調整可能</p>
                            </div>
                        </div>

                        <div style="font-size: 30px; color: #3b82f6;">→</div>

                        <!-- 承認トリガー -->
                        <div style="text-align: center;">
                            <div style="background: white; border: 3px dashed #ec4899; border-radius: 10px; padding: 20px; min-width: 200px;">
                                <h3 style="color: #1e3a8a; margin-bottom: 10px;">承認ボタン</h3>
                                <p style="font-size: 0.9em; color: #64748b;">管理者が手動実行</p>
                            </div>
                        </div>

                        <div style="font-size: 30px; color: #10b981;">→</div>

                        <!-- APPROVED状態 -->
                        <div style="text-align: center;">
                            <div style="background: #dcfce7; border: 3px solid #10b981; border-radius: 10px; padding: 20px; min-width: 200px;">
                                <h3 style="color: #166534; margin-bottom: 10px;">APPROVED</h3>
                                <p style="font-size: 0.9em; color: #166534;">第1案確定</p>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 50px; border-top: 3px solid #cbd5e1; padding-top: 50px;">
                        <div style="display: flex; align-items: center; justify-content: space-around; flex-wrap: wrap; gap: 20px;">
                            <!-- 第2案作成 -->
                            <div style="text-align: center;">
                                <div style="background: white; border: 3px solid #ec4899; border-radius: 10px; padding: 20px; min-width: 200px;">
                                    <h3 style="color: #1e3a8a; margin-bottom: 10px;">第2案作成</h3>
                                    <p style="font-size: 0.9em; color: #64748b;">第1案をコピー</p>
                                </div>
                            </div>

                            <div style="font-size: 30px; color: #3b82f6;">→</div>

                            <!-- DRAFT状態 -->
                            <div style="text-align: center;">
                                <div style="background: #fef3c7; border: 3px solid #ec4899; border-radius: 10px; padding: 20px; min-width: 200px;">
                                    <h3 style="color: #92400e; margin-bottom: 10px;">DRAFT</h3>
                                    <p style="font-size: 0.9em; color: #78350f;">希望反映・調整</p>
                                </div>
                            </div>

                            <div style="font-size: 30px; color: #3b82f6;">→</div>

                            <!-- 承認トリガー -->
                            <div style="text-align: center;">
                                <div style="background: white; border: 3px dashed #ec4899; border-radius: 10px; padding: 20px; min-width: 200px;">
                                    <h3 style="color: #1e3a8a; margin-bottom: 10px;">承認ボタン</h3>
                                    <p style="font-size: 0.9em; color: #64748b;">管理者が手動実行</p>
                                </div>
                            </div>

                            <div style="font-size: 30px; color: #10b981;">→</div>

                            <!-- APPROVED状態 -->
                            <div style="text-align: center;">
                                <div style="background: #dcfce7; border: 3px solid #10b981; border-radius: 10px; padding: 20px; min-width: 200px;">
                                    <h3 style="color: #166534; margin-bottom: 10px;">APPROVED</h3>
                                    <p style="font-size: 0.9em; color: #166534; font-weight: bold;">シフト確定</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <h2 style="color: #1e3a8a; margin: 50px 0 30px 0;">ステータスごとのシステム制約まとめ</h2>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; margin: 30px 0;">
                    <!-- DRAFT状態 -->
                    <div style="background: #fef3c7; border: 3px solid #f59e0b; border-radius: 10px; padding: 25px;">
                        <h3 style="color: #92400e; margin-bottom: 15px; font-size: 1.3em;">
                            <span style="background: #fef3c7; color: #92400e; padding: 5px 15px; border-radius: 5px; font-weight: bold;">DRAFT</span>
                        </h3>
                        <h4 style="color: #78350f; margin-bottom: 10px;">許可される操作</h4>
                        <ul style="margin: 0 0 15px 20px; line-height: 1.8; color: #78350f;">
                            <li>✓ シフトの新規作成</li>
                            <li>✓ シフトの更新・編集</li>
                            <li>✓ シフトの削除</li>
                            <li>✓ スタッフの配置変更</li>
                            <li>✓ 時間帯の調整</li>
                            <li>✓ プラン全体の削除</li>
                        </ul>
                        <h4 style="color: #78350f; margin-bottom: 10px;">システム制約</h4>
                        <ul style="margin: 0 0 0 20px; line-height: 1.8; color: #78350f;">
                            <li>第2案DRAFTは第1案がAPPROVED必須</li>
                            <li>承認するまで他のユーザーには非公開</li>
                        </ul>
                    </div>

                    <!-- APPROVED状態 -->
                    <div style="background: #dcfce7; border: 3px solid #10b981; border-radius: 10px; padding: 25px;">
                        <h3 style="color: #166534; margin-bottom: 15px; font-size: 1.3em;">
                            <span style="background: #dcfce7; color: #166534; padding: 5px 15px; border-radius: 5px; font-weight: bold;">APPROVED</span>
                        </h3>
                        <h4 style="color: #166534; margin-bottom: 10px;">許可される操作</h4>
                        <ul style="margin: 0 0 15px 20px; line-height: 1.8; color: #166534;">
                            <li>✓ 読み取り・表示</li>
                            <li>✓ History画面での閲覧</li>
                            <li>✓ スタッフへの公開（第2案のみ）</li>
                        </ul>
                        <h4 style="color: #dc2626; margin-bottom: 10px;">禁止される操作</h4>
                        <ul style="margin: 0 0 0 20px; line-height: 1.8; color: #dc2626;">
                            <li>✗ シフトの編集・更新</li>
                            <li>✗ シフトの削除</li>
                            <li>✗ プランの削除</li>
                            <li>✗ ステータスの変更（DRAFTに戻せない）</li>
                        </ul>
                    </div>
                </div>

                <div class="note" style="margin-top: 40px;">
                    <h4>重要なポイント</h4>
                    <ul style="margin-left: 20px; line-height: 2;">
                        <li><strong>ステータス更新は全て手動</strong>: 日付による自動更新はなく、管理者の承認操作が必須です</li>
                        <li><strong>第2案作成の前提条件</strong>: 第1案がAPPROVEDになってから第2案の作成が可能になります</li>
                        <li><strong>一方向のステータス遷移</strong>: DRAFT → APPROVED の一方向のみで、APPROVEDからDRAFTには戻せません</li>
                        <li><strong>承認後の変更不可</strong>: APPROVEDステータスになったシフトは編集・削除できません（データの整合性保護）</li>
                        <li><strong>プラン削除の制限</strong>: APPROVEDステータスのプランは削除できません</li>
                        <li><strong>APIエンドポイント</strong>: PUT /api/shifts/plans/{planId}/status でステータス更新</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- シフト変更タブ -->
        <div id="change" class="tab-content">
            <div class="workflow-container">
                <h2 style="color: #1e3a8a; margin-bottom: 30px;">シフト変更</h2>

                <div class="note">
                    <h4>シフト変更の概要</h4>
                    <p>各フェーズ・ステータスごとのシフト変更方法と制約をまとめています。</p>
                </div>

                <h3 style="color: #1e3a8a; margin: 40px 0 20px 0;">フェーズ・ステータス別シフト変更方法</h3>

                <table style="width: 100%; border-collapse: collapse; margin: 30px 0;">
                    <thead>
                        <tr style="background: #1e3a8a; color: white;">
                            <th style="padding: 15px; border: 2px solid #1e40af; width: 50px;">#</th>
                            <th style="padding: 15px; border: 2px solid #1e40af;">フェーズ</th>
                            <th style="padding: 15px; border: 2px solid #1e40af;">プラン種別</th>
                            <th style="padding: 15px; border: 2px solid #1e40af;">ステータス</th>
                            <th style="padding: 15px; border: 2px solid #1e40af;">変更方法フロー</th>
                            <th style="padding: 15px; border: 2px solid #1e40af;">制約事項</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- フェーズ1: 第1案 DRAFT -->
                        <tr>
                            <td style="padding: 15px; border: 2px solid #e2e8f0; text-align: center; font-weight: bold; background: #f8fafc;">1</td>
                            <td rowspan="2" style="padding: 15px; border: 2px solid #e2e8f0; background: #fffbeb; font-weight: bold; vertical-align: middle;">フェーズ1<br/><small>シフト希望募集<br/>第1案作成</small></td>
                            <td rowspan="2" style="padding: 15px; border: 2px solid #e2e8f0; background: #fffbeb; font-weight: bold; vertical-align: middle;">第1案<br/>(FIRST)</td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0; text-align: center;">
                                <span style="background: #fef3c7; color: #92400e; padding: 5px 15px; border-radius: 5px; font-weight: bold;">DRAFT</span>
                            </td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0;">
                                <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                                    <div style="background: #fffbeb; border: 2px solid #f59e0b; border-radius: 8px; padding: 12px; min-width: 150px; text-align: center;">
                                        <div style="font-weight: bold; color: #f59e0b; margin-bottom: 5px;">👔 店側</div>
                                        <div style="font-size: 0.9em;">シフトを編集</div>
                                    </div>
                                    <div style="font-size: 24px; color: #3b82f6;">→</div>
                                    <div style="background: #fffbeb; border: 2px solid #f59e0b; border-radius: 8px; padding: 12px; min-width: 150px; text-align: center;">
                                        <div style="font-weight: bold; color: #f59e0b; margin-bottom: 5px;">👔 店側</div>
                                        <div style="font-size: 0.9em;">「下書き保存」</div>
                                    </div>
                                    <div style="font-size: 24px; color: #3b82f6;">→</div>
                                    <div style="background: #fffbeb; border: 2px solid #f59e0b; border-radius: 8px; padding: 12px; min-width: 150px; text-align: center;">
                                        <div style="font-weight: bold; color: #f59e0b; margin-bottom: 5px;">👔 店側</div>
                                        <div style="font-size: 0.9em;">「承認」ボタン</div>
                                    </div>
                                </div>
                            </td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0;">
                                <ul style="margin: 0; padding-left: 20px; line-height: 1.8;">
                                    <li>編集・削除・追加すべて可能</li>
                                    <li>プラン全体の削除可能</li>
                                    <li>過去月のプラン削除は不可</li>
                                </ul>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 15px; border: 2px solid #e2e8f0; text-align: center; font-weight: bold; background: #f8fafc;">2</td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0; text-align: center;">
                                <span style="background: #dcfce7; color: #166534; padding: 5px 15px; border-radius: 5px; font-weight: bold;">APPROVED</span>
                            </td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0;">
                                <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                                    <div style="background: #fffbeb; border: 2px solid #f59e0b; border-radius: 8px; padding: 12px; min-width: 130px; text-align: center;">
                                        <div style="font-weight: bold; color: #f59e0b; margin-bottom: 5px;">👔 店側</div>
                                        <div style="font-size: 0.9em;">「承認解除」</div>
                                    </div>
                                    <div style="font-size: 24px; color: #3b82f6;">→</div>
                                    <div style="background: #fffbeb; border: 2px solid #f59e0b; border-radius: 8px; padding: 12px; min-width: 130px; text-align: center;">
                                        <div style="font-weight: bold; color: #f59e0b; margin-bottom: 5px;">👔 店側</div>
                                        <div style="font-size: 0.9em;">編集</div>
                                    </div>
                                    <div style="font-size: 24px; color: #3b82f6;">→</div>
                                    <div style="background: #fffbeb; border: 2px solid #f59e0b; border-radius: 8px; padding: 12px; min-width: 130px; text-align: center;">
                                        <div style="font-weight: bold; color: #f59e0b; margin-bottom: 5px;">👔 店側</div>
                                        <div style="font-size: 0.9em;">「下書き保存」</div>
                                    </div>
                                    <div style="font-size: 24px; color: #3b82f6;">→</div>
                                    <div style="background: #fffbeb; border: 2px solid #f59e0b; border-radius: 8px; padding: 12px; min-width: 130px; text-align: center;">
                                        <div style="font-weight: bold; color: #f59e0b; margin-bottom: 5px;">👔 店側</div>
                                        <div style="font-size: 0.9em;">「承認」</div>
                                    </div>
                                </div>
                            </td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0;">
                                <ul style="margin: 0; padding-left: 20px; line-height: 1.8;">
                                    <li>編集・削除・追加すべて可能</li>
                                    <li>プラン全体の削除可能</li>
                                    <li>過去月のプラン削除は不可</li>
                                </ul>
                                <p style="margin-top: 10px; color: #dc2626; font-weight: 600;">
                                    ⚠️ UIレベルの制約のみ（API制約なし）
                                </p>
                            </td>
                        </tr>

                        <!-- フェーズ2: 第2案 -->
                        <tr style="border-top: 3px solid #cbd5e1;">
                            <td style="padding: 15px; border: 2px solid #e2e8f0; text-align: center; font-weight: bold; background: #f8fafc;">3</td>
                            <td rowspan="2" style="padding: 15px; border: 2px solid #e2e8f0; background: #fdf2f8; font-weight: bold; vertical-align: middle;">フェーズ2<br/><small>第2案作成<br/>希望反映</small></td>
                            <td rowspan="2" style="padding: 15px; border: 2px solid #e2e8f0; background: #fdf2f8; font-weight: bold; vertical-align: middle;">第2案<br/>(SECOND)</td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0; text-align: center;">
                                <span style="background: #fef3c7; color: #92400e; padding: 5px 15px; border-radius: 5px; font-weight: bold;">DRAFT</span>
                            </td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0;">
                                <div style="margin-bottom: 20px;">
                                    <div style="font-weight: bold; color: #10b981; margin-bottom: 10px;">👤 従業員側フロー</div>
                                    <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                                        <div style="background: #f0fdf4; border: 2px solid #10b981; border-radius: 8px; padding: 12px; min-width: 150px; text-align: center;">
                                            <div style="font-size: 0.9em;">希望シフト変更・追加<br/>(LINE LIFF)</div>
                                        </div>
                                        <div style="font-size: 24px; color: #3b82f6;">→</div>
                                        <div style="background: #f0fdf4; border: 2px solid #10b981; border-radius: 8px; padding: 12px; min-width: 150px; text-align: center;">
                                            <div style="font-size: 0.9em;">提出ボタン</div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <div style="font-weight: bold; color: #f59e0b; margin-bottom: 10px;">👔 店側フロー</div>
                                    <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                                        <div style="background: #fffbeb; border: 2px solid #f59e0b; border-radius: 8px; padding: 12px; min-width: 150px; text-align: center;">
                                            <div style="font-size: 0.9em;">シフト編集<br/>(即座に保存)</div>
                                        </div>
                                        <div style="font-size: 24px; color: #3b82f6;">→</div>
                                        <div style="background: #fffbeb; border: 2px solid #f59e0b; border-radius: 8px; padding: 12px; min-width: 150px; text-align: center;">
                                            <div style="font-size: 0.9em;">「承認」ボタン</div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0;">
                                <ul style="margin: 0; padding-left: 20px; line-height: 1.8;">
                                    <li>編集・削除・追加すべて可能</li>
                                    <li>第1案がAPPROVED必須</li>
                                    <li>希望照合機能あり</li>
                                    <li>AI修正アシスタント利用可能</li>
                                </ul>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 15px; border: 2px solid #e2e8f0; text-align: center; font-weight: bold; background: #f8fafc;">4</td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0; text-align: center;">
                                <span style="background: #dcfce7; color: #166534; padding: 5px 15px; border-radius: 5px; font-weight: bold;">APPROVED</span>
                            </td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0;">
                                <div style="margin-bottom: 20px;">
                                    <div style="font-weight: bold; color: #10b981; margin-bottom: 10px;">👤 従業員側フロー</div>
                                    <div style="background: #f0fdf4; border: 2px dashed #94a3b8; border-radius: 8px; padding: 12px; text-align: center; color: #64748b;">
                                        <div style="font-size: 0.9em;">（なし - 変更不可）</div>
                                    </div>
                                </div>
                                <div>
                                    <div style="font-weight: bold; color: #f59e0b; margin-bottom: 10px;">👔 店側フロー</div>
                                    <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                                        <div style="background: #fffbeb; border: 2px solid #f59e0b; border-radius: 8px; padding: 12px; min-width: 120px; text-align: center;">
                                            <div style="font-size: 0.9em;">「承認解除」</div>
                                        </div>
                                        <div style="font-size: 24px; color: #3b82f6;">→</div>
                                        <div style="background: #fffbeb; border: 2px solid #f59e0b; border-radius: 8px; padding: 12px; min-width: 120px; text-align: center;">
                                            <div style="font-size: 0.9em;">編集<br/>(即座に保存)</div>
                                        </div>
                                        <div style="font-size: 24px; color: #3b82f6;">→</div>
                                        <div style="background: #fffbeb; border: 2px solid #f59e0b; border-radius: 8px; padding: 12px; min-width: 120px; text-align: center;">
                                            <div style="font-size: 0.9em;">「承認」</div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                            <td rowspan="2" style="padding: 15px; border: 2px solid #e2e8f0;">
                                <ul style="margin: 0; padding-left: 20px; line-height: 1.8;">
                                    <li>編集・削除・追加すべて可能</li>
                                    <li>第1案がAPPROVED必須</li>
                                    <li>希望照合機能あり</li>
                                    <li>AI修正アシスタント利用可能</li>
                                </ul>
                                <p style="margin-top: 10px; color: #dc2626; font-weight: 600;">
                                    ⚠️ UIレベルの制約のみ（API制約なし）
                                </p>
                            </td>
                        </tr>

                        <!-- フェーズ3: シフト確定 -->
                        <tr style="border-top: 3px solid #cbd5e1;">
                            <td style="padding: 15px; border: 2px solid #e2e8f0; text-align: center; font-weight: bold; background: #f8fafc;">5</td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0; background: #f0fdf4; font-weight: bold; vertical-align: middle;">フェーズ3<br/><small>シフト確定</small></td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0; background: #f0fdf4; font-weight: bold; vertical-align: middle;">第2案<br/>(SECOND)</td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0; text-align: center;">
                                <span style="background: #dcfce7; color: #166534; padding: 5px 15px; border-radius: 5px; font-weight: bold;">APPROVED</span>
                            </td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0;">
                                <p style="margin-bottom: 15px; color: #dc2626; font-weight: 600;">
                                    ⚠️ 基本的に公開後のシフト変更は推奨されません
                                </p>
                                <div style="margin-bottom: 20px;">
                                    <div style="font-weight: bold; color: #10b981; margin-bottom: 10px;">👤 従業員側フロー</div>
                                    <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                                        <div style="background: #f0fdf4; border: 2px solid #10b981; border-radius: 8px; padding: 12px; min-width: 200px; text-align: center;">
                                            <div style="font-size: 0.9em;">急な変更希望を店に連絡<br/>(店側が判断)</div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <div style="font-weight: bold; color: #f59e0b; margin-bottom: 10px;">👔 店側フロー</div>
                                    <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                                        <div style="background: #fffbeb; border: 2px solid #f59e0b; border-radius: 8px; padding: 12px; min-width: 120px; text-align: center;">
                                            <div style="font-size: 0.9em;">「承認解除」</div>
                                        </div>
                                        <div style="font-size: 24px; color: #3b82f6;">→</div>
                                        <div style="background: #fffbeb; border: 2px solid #f59e0b; border-radius: 8px; padding: 12px; min-width: 120px; text-align: center;">
                                            <div style="font-size: 0.9em;">編集<br/>(即座に保存)</div>
                                        </div>
                                        <div style="font-size: 24px; color: #3b82f6;">→</div>
                                        <div style="background: #fffbeb; border: 2px solid #f59e0b; border-radius: 8px; padding: 12px; min-width: 120px; text-align: center;">
                                            <div style="font-size: 0.9em;">「承認」</div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <h3 style="color: #1e3a8a; margin: 50px 0 20px 0;">シフト変更API詳細</h3>

                <div style="background: #f8fafc; padding: 25px; border-radius: 10px; border: 2px solid #e2e8f0; margin: 20px 0;">
                    <h4 style="color: #1e3a8a; margin-bottom: 15px;">PUT /api/shifts/:id</h4>

                    <h5 style="color: #475569; margin: 20px 0 10px 0;">更新可能なフィールド</h5>
                    <ul style="margin: 0 0 20px 20px; line-height: 1.8; color: #475569;">
                        <li><code>start_time</code> - 開始時刻（HH:MM:SS）</li>
                        <li><code>end_time</code> - 終了時刻（HH:MM:SS）</li>
                        <li><code>break_minutes</code> - 休憩時間（分）</li>
                        <li><code>shift_date</code> - シフト日付（YYYY-MM-DD）</li>
                        <li><code>staff_id</code> - スタッフID</li>
                        <li><code>pattern_id</code> - シフトパターンID</li>
                        <li><code>notes</code> - メモ</li>
                    </ul>

                    <h5 style="color: #475569; margin: 20px 0 10px 0;">自動処理</h5>
                    <ul style="margin: 0 0 20px 20px; line-height: 1.8; color: #475569;">
                        <li><strong>is_modifiedフラグ</strong>: 時間変更時に自動的にtrueに設定</li>
                        <li><strong>total_hours</strong>: 開始・終了時刻と休憩時間から自動計算</li>
                        <li><strong>labor_cost</strong>: スタッフ時給 × 勤務時間で自動計算</li>
                    </ul>

                    <h5 style="color: #475569; margin: 20px 0 10px 0;">バリデーション</h5>
                    <ul style="margin: 0 0 0 20px; line-height: 1.8; color: #475569;">
                        <li>休憩時間が負の値の場合はエラー</li>
                        <li>休憩時間が勤務時間を超える場合はエラー</li>
                        <li>外部キー制約（staff_id、store_id、plan_id）のチェック</li>
                    </ul>
                </div>

                <div style="background: #fef2f2; border-left: 4px solid #dc2626; padding: 20px; margin: 30px 0; border-radius: 4px;">
                    <h4 style="color: #991b1b; margin-bottom: 10px;">⚠️ 重要な注意事項</h4>
                    <ul style="margin: 0 0 0 20px; line-height: 2; color: #7f1d1d;">
                        <li><strong>APIレベルのステータス制約なし</strong>: バックエンドAPIでは、ステータス（DRAFT/APPROVED）による変更制限が実装されていません</li>
                        <li><strong>UIレベルの制約のみ</strong>: フロントエンドのUI表示で制約を実装していますが、APIを直接呼び出せば制約を回避できます</li>
                        <li><strong>過去月の制約</strong>: プラン削除時のみ過去月のチェックがあります（シフト個別の編集・削除には過去月チェックなし）</li>
                    </ul>
                </div>

                <h3 style="color: #1e3a8a; margin: 50px 0 20px 0;">変更履歴の記録</h3>

                <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                    <thead>
                        <tr style="background: #1e3a8a; color: white;">
                            <th style="padding: 15px; border: 2px solid #1e40af;">項目</th>
                            <th style="padding: 15px; border: 2px solid #1e40af;">説明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="padding: 15px; border: 2px solid #e2e8f0; font-weight: bold;">is_modifiedフラグ</td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0;">
                                時間関連フィールド（start_time、end_time、break_minutes）の変更時に自動的にtrueに設定される。変更履歴として活用可能。
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 15px; border: 2px solid #e2e8f0; font-weight: bold;">ローカル変更トラッキング<br/><small>(FirstPlanEditor)</small></td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0;">
                                <code>modifiedShifts</code>、<code>deletedShiftIds</code>、<code>addedShifts</code> のローカルステートで変更を追跡。保存ボタン押下時に一括送信。
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 15px; border: 2px solid #e2e8f0; font-weight: bold;">即時更新<br/><small>(SecondPlanEditor)</small></td>
                            <td style="padding: 15px; border: 2px solid #e2e8f0;">
                                編集操作ごとに即座にAPIを呼び出してDB更新。変更履歴はis_modifiedフラグで記録。
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        function showTab(tabName) {
            // すべてのタブコンテンツを非表示
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => {
                content.classList.remove('active');
            });

            // すべてのタブボタンを非アクティブ
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });

            // 選択されたタブを表示
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }
    </script>
</body>
</html>